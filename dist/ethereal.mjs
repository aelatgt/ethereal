import{Box3Helper as t,Box3 as e,Vector3 as i,Matrix4 as n,Sphere as o,Line3 as r,Triangle as s,Vector2 as a,Plane as u,DoubleSide as c,BackSide as l,Face3 as h,BufferGeometry as p,Mesh as f,Object3D as d,Geometry as m,Quaternion as y,Math as x,Color as g,Vector4 as v,Matrix3 as b,Ray as w,Float32BufferAttribute as F,BufferAttribute as _,LineBasicMaterial as T}from"three";var M=Object.freeze(new a),z=Object.freeze(new a),B=Object.freeze(new i),C=Object.freeze(new i(1,0,0)),P=Object.freeze(new i(0,1,0)),I=Object.freeze(new i(0,0,1)),A=Object.freeze(new i(1,1,1)),j=Object.freeze(new y),E=Promise.resolve(),O=function(t,e){var i=this;this._factory=t,this._reset=e,this._pool=[],this._unpooled=new Set,this._autoPool=function(){i._nextAutoPool=void 0,i._poolAll()}};O.prototype.get=function(){var t=this._pool.pop()||this._reset(this._factory());return this._unpooled.add(t),this._nextAutoPool||(this._nextAutoPool=E.then(this._autoPool)),t},O.prototype.pool=function(t){this._pool.push(t),this._unpooled.delete(t),this._reset(t)},O.prototype._poolAll=function(){if(0!==this._unpooled.size)for(var t=0,e=this._unpooled;t<e.length;t+=1)this.pool(e[t])};var S=new O(function(){return new a},function(t){return t.set(0,0)}),D=new O(function(){return new i},function(t){return t.set(0,0,0)}),W=new O(function(){return new v},function(t){return t.set(0,0,0,1)}),V=new O(function(){return new y},function(t){return t.set(0,0,0,1)}),N=new O(function(){return new b},function(t){return t.identity()}),U=new O(function(){return new n},function(t){return t.identity()});function G(t,e,i){if(e.call(i,t))for(var n=0,o=t.children;n<o.length;n+=1)G(o[n],e,i)}var R,q,k,H,L=0,Q=new i;function X(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new J,this.unassigned=new J,this.vertices=[]}function Y(){this.normal=new i,this.midpoint=new i,this.area=0,this.constant=0,this.outside=null,this.mark=L,this.edge=null}function Z(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function $(t){this.point=t,this.prev=null,this.next=null,this.face=null}function J(){this.head=null,this.tail=null}Object.assign(X.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.QuickHull: Points parameter is not an array."),t.length<4&&console.error("THREE.QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.vertices.push(new $(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse(function(t){var n,o,r,s=t.geometry;if(void 0!==s)if(s.isGeometry){var a=s.vertices;for(n=0,o=a.length;n<o;n++)(r=a[n].clone()).applyMatrix4(t.matrixWorld),e.push(r)}else if(s.isBufferGeometry){var u=s.attributes.position;if(void 0!==u)for(n=0,o=u.count;n<o;n++)(r=new i).fromBufferAttribute(u,n).applyMatrix4(t.matrixWorld),e.push(r)}}),this.setFromPoints(e)},containsPoint:function(t){for(var e=this.faces,i=0,n=e.length;i<n;i++)if(e[i].distanceToPoint(t)>this.tolerance)return!1;return!0},intersectRay:function(t,e){for(var i=this.faces,n=-Infinity,o=Infinity,r=0,s=i.length;r<s;r++){var a=i[r],u=a.distanceToPoint(t.origin),c=a.normal.dot(t.direction);if(u>0&&c>=0)return null;var l=0!==c?-u/c:0;if(!(l<=0)&&(c>0?o=Math.min(l,o):n=Math.max(l,n),n>o))return null}return t.at(-Infinity!==n?n:o,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,Q)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(e.outside=null!==t.next&&t.next.face===e?t.next:null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,i=t.outside;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{var n=i;do{var o=n.next;e.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,e):this.unassigned.append(n),n=o}while(null!==n)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var i=e.next,n=this.tolerance,o=null,r=0;r<t.length;r++){var s=t[r];if(s.mark===L){var a=s.distanceToPoint(e.point);if(a>n&&(n=a,o=s),n>1e3*this.tolerance)break}}null!==o&&this.addVertexToFace(e,o),e=i}while(null!==e)}return this},computeExtremes:function(){var t,e,n,o=new i,r=new i,s=[],a=[];for(t=0;t<3;t++)s[t]=a[t]=this.vertices[0];for(o.copy(this.vertices[0].point),r.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var u=this.vertices[t],c=u.point;for(n=0;n<3;n++)c.getComponent(n)<o.getComponent(n)&&(o.setComponent(n,c.getComponent(n)),s[n]=u);for(n=0;n<3;n++)c.getComponent(n)>r.getComponent(n)&&(r.setComponent(n,c.getComponent(n)),a[n]=u)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(o.x),Math.abs(r.x))+Math.max(Math.abs(o.y),Math.abs(r.y))+Math.max(Math.abs(o.z),Math.abs(r.z))),{min:s,max:a}},computeInitialHull:function(){void 0===R&&(R=new r,q=new u,k=new i);var t,e,n,o,s,a,c,l,h,p=this.vertices,f=this.computeExtremes(),d=f.min,m=f.max,y=0,x=0;for(a=0;a<3;a++)(h=m[a].point.getComponent(a)-d[a].point.getComponent(a))>y&&(y=h,x=a);for(y=0,R.set((e=d[x]).point,(n=m[x]).point),a=0,c=this.vertices.length;a<c;a++)(t=p[a])!==e&&t!==n&&(R.closestPointToPoint(t.point,!0,k),(h=k.distanceToSquared(t.point))>y&&(y=h,o=t));for(y=-1,q.setFromCoplanarPoints(e.point,n.point,o.point),a=0,c=this.vertices.length;a<c;a++)(t=p[a])!==e&&t!==n&&t!==o&&(h=Math.abs(q.distanceToPoint(t.point)))>y&&(y=h,s=t);var g=[];if(q.distanceToPoint(s.point)<0)for(g.push(Y.create(e,n,o),Y.create(s,n,e),Y.create(s,o,n),Y.create(s,e,o)),a=0;a<3;a++)l=(a+1)%3,g[a+1].getEdge(2).setTwin(g[0].getEdge(l)),g[a+1].getEdge(1).setTwin(g[l+1].getEdge(0));else for(g.push(Y.create(e,o,n),Y.create(s,e,n),Y.create(s,n,o),Y.create(s,o,e)),a=0;a<3;a++)l=(a+1)%3,g[a+1].getEdge(2).setTwin(g[0].getEdge((3-a)%3)),g[a+1].getEdge(0).setTwin(g[l+1].getEdge(1));for(a=0;a<4;a++)this.faces.push(g[a]);for(a=0,c=p.length;a<c;a++)if((t=p[a])!==e&&t!==n&&t!==o&&t!==s){y=this.tolerance;var v=null;for(l=0;l<4;l++)(h=this.faces[l].distanceToPoint(t.point))>y&&(y=h,v=this.faces[l]);null!==v&&this.addVertexToFace(t,v)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var i=this.faces[e];i.mark===L&&t.push(i)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,i=this.assigned.first().face,n=i.outside;do{var o=i.distanceToPoint(n.point);o>e&&(e=o,t=n),n=n.next}while(null!==n&&n.face===i);return t}},computeHorizon:function(t,e,i,n){var o;this.deleteFaceVertices(i),i.mark=1,o=null===e?e=i.getEdge(0):e.next;do{var r=o.twin,s=r.face;s.mark===L&&(s.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,r,s,n):n.push(o)),o=o.next}while(o!==e);return this},addAdjoiningFace:function(t,e){var i=Y.create(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var i=null,n=null,o=0;o<e.length;o++){var r=this.addAdjoiningFace(t,e[o]);null===i?i=r:r.next.setTwin(n),this.newFaces.push(r.face),n=r}return i.next.setTwin(n),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Y,{create:function(t,e,i){var n=new Y,o=new Z(t,n),r=new Z(e,n),s=new Z(i,n);return o.next=s.prev=r,r.next=o.prev=s,s.next=r.prev=o,n.edge=o,n.compute()}}),Object.assign(Y.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===H&&(H=new s);var t=this.edge.tail(),e=this.edge.head(),i=this.edge.next.head();return H.set(t.point,e.point,i.point),H.getNormal(this.normal),H.getMidpoint(this.midpoint),this.area=H.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(Z.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(J.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}});var K=function(t){function e(e){t.call(this),this.points=e,this.fromBufferGeometry(new tt(e)),this.mergeVertices()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(m),tt=function(t){function e(e){t.call(this),this.points=e;var i=[],n=[];void 0===X&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on THREE.QuickHull");for(var o=(new X).setFromPoints(e).faces,r=0;r<o.length;r++){var s=o[r],a=s.edge;do{var u=a.head().point;i.push(u.x,u.y,u.z),n.push(s.normal.x,s.normal.y,s.normal.z),a=a.next}while(a!==s.edge)}this.addAttribute("position",new F(i,3)),this.addAttribute("normal",new F(n,3))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(p),et=function(){};!function(){var t=new i,e=new i;function n(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}function o(t,e){var i,n,o=e.position.distanceTo(t.position),r=0,s=[],a=t.faces.length;for(i=0;i<a;i++)(n=t.faces[i]).hasVertex(e)&&s.push(n);for(i=0;i<a;i++){var u=1;n=t.faces[i];for(var c=0;c<s.length;c++){var l=n.normal.dot(s[c].normal);u=Math.min(u,(1.001-l)/2)}r=Math.max(r,u)}return s.length<2&&(r=1),o*r+0}function r(t){if(0===t.neighbors.length)return t.collapseNeighbor=null,void(t.collapseCost=-.01);t.collapseCost=1e5,t.collapseNeighbor=null;for(var e=0;e<t.neighbors.length;e++){var i=o(t,t.neighbors[e]);t.collapseNeighbor||(t.collapseNeighbor=t.neighbors[e],t.collapseCost=i,t.minCost=i,t.totalCost=0,t.costCount=0),t.costCount++,t.totalCost+=i,i<t.minCost&&(t.collapseNeighbor=t.neighbors[e],t.minCost=i)}t.collapseCost=t.totalCost/t.costCount}function s(t,e){for(console.assert(0===t.faces.length);t.neighbors.length;)n(t.neighbors.pop().neighbors,t);n(e,t)}function a(t,e){n(e,t),t.v1&&n(t.v1.faces,t),t.v2&&n(t.v2.faces,t),t.v3&&n(t.v3.faces,t);for(var i,o,r=[t.v1,t.v2,t.v3],s=0;s<3;s++)o=r[(s+1)%3],(i=r[s])&&o&&(i.removeIfNonNeighbor(o),o.removeIfNonNeighbor(i))}function u(t,e,i,n){if(n){var o,u=[];for(o=0;o<i.neighbors.length;o++)u.push(i.neighbors[o]);for(o=i.faces.length-1;o>=0;o--)i.faces[o].hasVertex(n)&&a(i.faces[o],e);for(o=i.faces.length-1;o>=0;o--)i.faces[o].replaceVertex(i,n);for(s(i,t),o=0;o<u.length;o++)r(u[o])}else s(i,t)}function c(t){for(var e=t[0],i=0;i<t.length;i++)t[i].collapseCost<e.collapseCost&&(e=t[i]);return e}function l(t,e,n,o,r,s){this.a=o,this.b=r,this.c=s,this.v1=t,this.v2=e,this.v3=n,this.normal=new i,this.computeNormal(),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(t),n.addUniqueNeighbor(e)}function h(t,e){this.position=t,this.id=e,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}l.prototype.computeNormal=function(){var i=this.v1.position,n=this.v2.position;t.subVectors(this.v3.position,n),e.subVectors(i,n),t.cross(e).normalize(),this.normal.copy(t)},l.prototype.hasVertex=function(t){return t===this.v1||t===this.v2||t===this.v3},l.prototype.replaceVertex=function(t,e){t===this.v1?this.v1=e:t===this.v2?this.v2=e:t===this.v3&&(this.v3=e),n(t.faces,this),e.faces.push(this),t.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(t),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},h.prototype.addUniqueNeighbor=function(t){var e,i;-1===(e=this.neighbors).indexOf(i=t)&&e.push(i)},h.prototype.removeIfNonNeighbor=function(t){var e=this.neighbors,i=this.faces,n=e.indexOf(t);if(-1!==n){for(var o=0;o<i.length;o++)if(i[o].hasVertex(t))return;e.splice(n,1)}},et.prototype.modify=function(t,e){t.isBufferGeometry&&(t=(new m).fromBufferGeometry(t)),t.mergeVertices();var i,n,o,s=t.vertices,a=t.faces,f=[],d=[];for(i=0,n=s.length;i<n;i++){var y=new h(s[i],i);f.push(y)}for(i=0,n=a.length;i<n;i++){var x=new l(f[T=(_=a[i]).a],f[M=_.b],f[z=_.c],T,M,z);d.push(x)}for(i=0,n=f.length;i<n;i++)r(f[i]);for(var g=e;g--;){if(!(o=c(f))){console.log("THREE.SimplifyModifier: No next vertex");break}u(f,d,o,o.collapseNeighbor)}var v=new p,b=[],w=[];for(i=0;i<f.length;i++)b.push((y=f[i].position).x,y.y,y.z);for(i=0;i<d.length;i++){var _,T=f.indexOf((_=d[i]).v1),M=f.indexOf(_.v2),z=f.indexOf(_.v3);w.push(T,M,z)}return v.addAttribute("position",new F(b,3)),v.setIndex(w),v}}();var it=function(){};it.compute=function(t,e){void 0===e&&(e=30);var i="BufferGeometry"===t.type?t:null,n=i?(new m).fromBufferGeometry(i):t;if(n.vertices.length<e)return this.hulls.set(t,n),n;var o=new et,r=new K(n.vertices);if(r.vertices.length>e){var s=o.modify(r,r.vertices.length-e);r=(new m).fromBufferGeometry(s)}return this.hulls.set(t,r),r},it.get=function(t){return this.hulls.get(t)||t},it.hulls=new WeakMap;var nt=function(t){function o(){t.apply(this,arguments),this.objectFilter=at.objectFilter,this.objectExpansion="box",this.coordinateSystem=void 0,this._vector=new i,this._mat4=new n,this._box=new e,this._center=new i,this._size=new i}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._onObjectTraverse=function(t){return!(this.objectFilter&&!this.objectFilter(t)||(this._objectExpandFunction.call(this,t),0))},o.prototype.setFromObject=function(t){switch(this.makeEmpty(),this.objectExpansion){case"geometry":this._objectExpandFunction=this.expandByObjectGeometry;break;case"hull":this._objectExpandFunction=this.expandByObjectHull;break;case"box":default:this._objectExpandFunction=this.expandByObjectBox}this._objectExpandFunction.call(this,t);for(var e=0,i=t.children;e<i.length;e+=1)G(i[e],this._onObjectTraverse,this);return this},o.prototype.expandByObjectGeometry=function(t){var e,i,n=this._vector,o=t;t.updateWorldMatrix(!1,!1);var r=o.geometry;if(void 0!==r){var s=this._getCoordinateSystemTransform(t);if(r.isGeometry){var a=r.vertices;for(e=0,i=a.length;e<i;e++)n.copy(a[e]),n.applyMatrix4(s),this.expandByPoint(n)}else if(r.isBufferGeometry){var u=r.attributes.position;if(void 0!==u)for(e=0,i=u.count;e<i;e++)n.fromBufferAttribute(u,e).applyMatrix4(s),this.expandByPoint(n)}}return this},o.prototype.expandByObjectHull=function(t){var e=this._vector,i=t.geometry;if(!i)return this;var n=this._getCoordinateSystemTransform(t);if((i=it.get(i))&&"vertices"in i)for(var o=i.vertices,r=0;r<o.length;++r)e.copy(o[r]).applyMatrix4(n),this.expandByPoint(e);else for(var s=i.getAttribute("position"),a=0;a<s.count;a+=s.itemSize)e.set(s.getX(a),s.getY(a),s.getZ(a)).applyMatrix4(n),this.expandByPoint(e);return this},o.prototype.expandByObjectBox=function(t){var e=this._box,i=t.geometry;return i?(null===i.boundingBox&&i.computeBoundingBox(),e.copy(i.boundingBox),e.applyMatrix4(this._getCoordinateSystemTransform(t)),this.union(e),this):this},o.prototype._getCoordinateSystemTransform=function(t){var e=this._mat4;return this.coordinateSystem?e.getInverse(this.coordinateSystem.transitioner.matrixWorldTarget).multiply(t.transitioner.matrixWorldTarget):e.copy(t.transitioner.matrixWorldTarget),e},o.prototype.relativeToAbsolute=function(t,e){if(void 0===e&&(e=t),this.isEmpty())e.copy(t).multiplyScalar(0);else{var i=this._center,n=this._size;this.getCenter(i),this.getSize(n),e.copy(t).multiplyScalar(.5).multiply(n).add(i)}return e},o.prototype.absoluteToRelative=function(t,e){if(void 0===e&&(e=t),this.isEmpty())e.copy(t).multiplyScalar(0);else{var i=this._center,n=this._size;this.getCenter(i),this.getSize(n),e.copy(t).sub(i).divide(n).multiplyScalar(2)}return e},o.prototype.isEmpty=function(){return!(isFinite(this.min.x)||isFinite(this.min.y)||isFinite(this.min.z)||isFinite(this.max.x)||isFinite(this.max.y)||isFinite(this.max.z))},o}(e),ot=(new y).setFromAxisAngle(P,Math.PI),rt=function(t){this.coordinateSystem=t,this.objectFilter=at.objectFilter,this.objectExpansion="box",this.min=new i(Infinity,Infinity,Infinity),this.max=new i(-Infinity,-Infinity,-Infinity),this.minClamped=new i,this.maxClamped=new i,this._vec3=new i,this._mat4=new n,this._boxPoints=[new i,new i,new i,new i,new i,new i,new i,new i]},st={left:{configurable:!0},leftClamped:{configurable:!0},top:{configurable:!0},topClamped:{configurable:!0},right:{configurable:!0},rightClamped:{configurable:!0},bottom:{configurable:!0},bottomClamped:{configurable:!0},near:{configurable:!0},nearClamped:{configurable:!0},far:{configurable:!0},farClamped:{configurable:!0},horizontal:{configurable:!0},horizontalClamped:{configurable:!0},vertical:{configurable:!0},verticalClamped:{configurable:!0},depth:{configurable:!0},depthClamped:{configurable:!0},diagonal:{configurable:!0},diagonalClamped:{configurable:!0}};st.left.get=function(){return this.isEmpty()?0:this.min.x},st.leftClamped.get=function(){return this.isEmpty()?0:this.minClamped.x},st.top.get=function(){return this.isEmpty()?0:this.max.y},st.topClamped.get=function(){return this.isEmpty()?0:this.maxClamped.y},st.right.get=function(){return this.isEmpty()?0:this.max.x},st.rightClamped.get=function(){return this.isEmpty()?0:this.maxClamped.x},st.bottom.get=function(){return this.isEmpty()?0:this.min.y},st.bottomClamped.get=function(){return this.isEmpty()?0:this.minClamped.y},st.near.get=function(){return this.isEmpty()?0:this.min.z},st.nearClamped.get=function(){return this.isEmpty()?0:this.minClamped.z},st.far.get=function(){return this.isEmpty()?0:this.max.z},st.farClamped.get=function(){return this.isEmpty()?0:this.maxClamped.z},st.horizontal.get=function(){return this.isEmpty()?0:this.right-this.left},st.horizontalClamped.get=function(){return this.isEmpty()?0:this.rightClamped-this.leftClamped},st.vertical.get=function(){return this.isEmpty()?0:this.top-this.bottom},st.verticalClamped.get=function(){return this.isEmpty()?0:this.topClamped-this.bottomClamped},st.depth.get=function(){return this.isEmpty()?0:this.far-this.near},st.depthClamped.get=function(){return this.isEmpty()?0:this.farClamped-this.nearClamped},st.diagonal.get=function(){if(this.isEmpty())return 0;var t=at.getCartesianForSphericalDirection(this.min,D.get()),e=at.getCartesianForSphericalDirection(this.max,D.get()),i=t.angleTo(e);return D.pool(t),D.pool(e),i*x.RAD2DEG},st.diagonalClamped.get=function(){if(this.isEmpty())return 0;var t=at.getCartesianForSphericalDirection(this.minClamped,D.get()),e=at.getCartesianForSphericalDirection(this.maxClamped,D.get()),i=t.angleTo(e);return D.pool(t),D.pool(e),i*x.RAD2DEG},rt.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},rt.prototype.getCenter=function(t){return t.set(this.right-this.horizontal/2,this.top-this.vertical/2,this.far-this.depth/2)},rt.prototype.getClampedCenter=function(t){return t.set(this.rightClamped-this.horizontalClamped/2,this.topClamped-this.verticalClamped/2,this.farClamped-this.depthClamped/2)},rt.prototype.getSize=function(t){return t.set(this.horizontal,this.vertical,this.depth)},rt.prototype.getClampedSize=function(t){return t.set(this.horizontalClamped,this.verticalClamped,this.depthClamped)},rt.prototype.getPositionForOffset=function(t,e){var i=this.getCenter(D.get()),n=this.getSize(D.get());return e.copy(t).multiplyScalar(.5).multiply(n).add(i),D.pool(i),D.pool(n),e},rt.prototype.getClampedPositionForOffset=function(t,e){var i=this.getClampedCenter(D.get()),n=this.getClampedSize(D.get());return e.copy(t).multiplyScalar(.5).multiply(n).add(i),D.pool(i),D.pool(n),e},rt.prototype.setFromPerspectiveProjectionMatrix=function(t){var e=U.get().getInverse(t),i=D.get();this.min.x=-i.set(-1,0,-1).applyMatrix4(e).angleTo(I)*x.RAD2DEG,this.max.x=i.set(1,0,-1).applyMatrix4(e).angleTo(I)*x.RAD2DEG,this.min.y=-i.set(0,-1,-1).applyMatrix4(e).angleTo(I)*x.RAD2DEG,this.max.y=i.set(0,1,-1).applyMatrix4(e).angleTo(I)*x.RAD2DEG,this.min.z=-i.set(0,0,-1).applyMatrix4(e).z,this.max.z=-i.set(0,0,1).applyMatrix4(e).z,U.pool(e),D.pool(i),this._applyClamping()},rt.prototype.makeEmpty=function(){this.min.set(Infinity,Infinity,Infinity),this.max.set(-Infinity,-Infinity,-Infinity)},rt.prototype.setFromObject=function(t){switch(this.makeEmpty(),this.objectExpansion){case"geometry":case"hull":this._objectExpandFunction=this.expandByObjectHull;break;case"box":default:this._objectExpandFunction=this.expandByObjectBox}this._objectExpandFunction.call(this,t);for(var e=0,i=t.children;e<i.length;e+=1)G(i[e],this._onObjectTraverse,this);return this},rt.prototype._onObjectTraverse=function(t){return!(this.objectFilter&&!this.objectFilter(t)||(this._objectExpandFunction.call(this,t),0))},rt.prototype.expandByObjectHull=function(t){var e=t;if(e.isMesh){var i=this.coordinateSystem,n=this._vec3,o=this._mat4.getInverse(i.matrixWorld).multiply(e.matrixWorld),r=it.get(e.geometry),s=at.get(i);if("vertices"in r)for(var a=0,u=r.vertices;a<u.length;a+=1){n.copy(u[a]).applyMatrix4(o);var c=s.getVisualPositionForCartesianPosition(n,n);this.min.min(c),this.max.max(c)}else for(var l=r.getAttribute("position"),h=0;h<l.count;h+=l.itemSize){n.set(l.getX(h),l.getY(h),l.getZ(h)).applyMatrix4(o);var p=s.getVisualPositionForCartesianPosition(n,n);this.min.min(p),this.max.max(p)}this._applyClamping()}},rt.prototype.expandByObjectBox=function(t){var e=this._mat4,i=t,n=i.geometry;if(!n)return this;null===n.boundingBox&&n.computeBoundingBox();var o=n.boundingBox,r=this._boxPoints;r[0].set(o.min.x,o.min.y,o.min.z),r[1].set(o.min.x,o.min.y,o.max.z),r[2].set(o.min.x,o.max.y,o.min.z),r[3].set(o.min.x,o.max.y,o.max.z),r[4].set(o.max.x,o.min.y,o.min.z),r[5].set(o.max.x,o.min.y,o.max.z),r[6].set(o.max.x,o.max.y,o.min.z),r[7].set(o.max.x,o.max.y,o.max.z);for(var s=this.coordinateSystem,a=at.get(s),u=e.getInverse(s.matrixWorld).multiply(i.matrixWorld),c=0,l=r;c<l.length;c+=1){var h=l[c];h.applyMatrix4(u);var p=a.getVisualPositionForCartesianPosition(h,h);this.min.min(p),this.max.max(p)}this._applyClamping()},rt.prototype._applyClamping=function(){this.minClamped.copy(this.min),this.maxClamped.copy(this.max),this.minClamp&&this.minClamped.min(this.minClamp),this.maxClamp&&this.maxClamped.max(this.maxClamp)},Object.defineProperties(rt.prototype,st);var at=function(t){this.object=t,this.matrixWorldGetter="target",this._box=new nt,this._visualFrustum=new rt(this.object)};at.get=function(t){return this._metrics.has(t)?this._metrics.get(t):(this._metrics.set(t,new at(t)),this._metrics.get(t))},at.getCartesianForSphericalDirection=function(t,e){var i=x.DEG2RAD*t.y,n=x.DEG2RAD*t.x,o=Math.sin(i),r=Math.cos(i)*Math.sin(n),s=-Math.cos(i)*Math.cos(n);return e.set(r,o,s).normalize(),e},at.getSphericalDirectionForCartesian=function(t,e){var i=D.get().copy(t).normalize();return e.y=Math.asin(i.y)*x.RAD2DEG,e.x=Math.atan2(i.x,-i.z)*x.RAD2DEG,D.pool(i),e},at.getSphericalPositionForCartesian=function(t,e){var i=t.length(),n=e.copy(t).normalize();return e.y=Math.asin(n.y)*x.RAD2DEG,e.x=Math.atan2(n.x,-n.z)*x.RAD2DEG,e.z=i,e},at.getCartesianForSphericalPosition=function(t,e){var i=t.z,n=S.get().set(t.x,t.y);return at.getCartesianForSphericalDirection(n,e).multiplyScalar(i),S.pool(n),e},at.prototype.getMatrixWorld=function(t){return"current"===this.matrixWorldGetter?t.matrixWorld:t.transitioner.matrixWorldTarget},at.prototype.getCartesianForVisualDirection=function(t,e){return at.getCartesianForSphericalDirection(t,e),this.object.isCamera||e.applyQuaternion(ot),e},at.prototype.getVisualDirectionForCartesian=function(t,e){var i=D.get().copy(t);return this.object.isCamera||i.applyQuaternion(ot),at.getSphericalDirectionForCartesian(i,e),D.pool(i),e},at.prototype.getVisualPositionForCartesianPosition=function(t,e){var i=e.copy(t);return this.object.isCamera||i.applyQuaternion(ot),at.getSphericalPositionForCartesian(i,e),e},at.prototype.getCartesianForVisualPosition=function(t,e){var i=t.z,n=S.get().set(t.x,t.y);return this.getCartesianForVisualDirection(n,e).multiplyScalar(i),S.pool(n),e},at.prototype.getPositionOf=function(t,e){e.setFromMatrixPosition(this.getMatrixWorld(t));var i=U.get().getInverse(this.getMatrixWorld(this.object));return e.applyMatrix4(i),U.pool(i),e},at.prototype.getDistanceOf=function(t){var e=D.get(),i=this.getPositionOf(t,e).length();return D.pool(e),i},at.prototype.getDirectionOf=function(t,e){var i=this.getPositionOf(t,e),n=i.lengthSq();return 0!==n&&isFinite(n)?i.normalize():e.set(0,0,this.object.isCamera?-1:1)},at.prototype.getWorldDirectionOf=function(t,e){return this.getDirectionOf(t,e).transformDirection(this.getMatrixWorld(this.object))},at.prototype.getClosestOrthogonalOrientationOf=function(t,e){for(var i,n,o=this.object,r=(o?U.get().getInverse(this.getMatrixWorld(o)):U.get()).multiply(this.getMatrixWorld(t)),s=r.extractRotation(r),a=e.setFromRotationMatrix(s),u=D.get().set(0,0,1).applyQuaternion(a),c=D.get().set(0,1,0).applyQuaternion(a),l=Infinity,h=Infinity,p=0,f=ut;p<f.length;p+=1){var d=f[p],m=c.distanceToSquared(d);m<h&&(h=m,n=d)}for(var y=0,x=ut;y<x.length;y+=1){var g=x[y];if(!(g.x&&n.x||g.y&&n.y||g.z&&n.z)){var v=u.distanceToSquared(g);v<l&&(l=v,i=g)}}s.identity(),s.lookAt(i,B,n),a.setFromRotationMatrix(s),U.pool(s),o.updateMatrixWorld()},at.prototype.getOrientationOf=function(t,e){var i=U.get(),n=V.get().setFromRotationMatrix(i.extractRotation(this.getMatrixWorld(t))),o=V.get().setFromRotationMatrix(i.extractRotation(this.getMatrixWorld(this.object))).inverse();return e.multiplyQuaternions(o,n),V.pool(n),V.pool(o),U.pool(i),e},at.prototype.getVisualDirectionOf=function(t,e){var i=this.getDirectionOf(t,D.get()),n=this.getVisualDirectionForCartesian(i,e);return D.pool(i),n},at.prototype.getVisualAngleOf=function(t,e){var i=this.getDirectionOf(t,D.get()),n=this.getVisualDirectionForCartesian(i,e);return D.pool(i),n},at.prototype.getBoundsOf=function(t,e){return void 0===e&&(e=this._box),e===this._box&&(e.objectFilter=at.objectFilter,e.objectExpansion="box"),e.coordinateSystem=this.object,e.setFromObject(t)},at.prototype.getVisualFrustumOf=function(t,e){return void 0===t&&(t=this.object),void 0===e&&(e=this._visualFrustum),e===this._visualFrustum&&(e.objectFilter=at.objectFilter),t.isCamera?e.setFromPerspectiveProjectionMatrix(t.projectionMatrix):e.setFromObject(t),e},at.prototype.getVisualOffsetOf=function(t){var e=this.getDirectionOf(t,D.get());this.object.isCamera||e.applyQuaternion(ot);var i=I.angleTo(e)*x.RAD2DEG;return D.pool(e),i},at._metrics=new WeakMap,at.objectFilter=function(t){return!t.layout.isBoundingContext()};var ut=[new i(1,0,0),new i(0,1,0),new i(0,0,1),new i(-1,0,0),new i(0,-1,0),new i(0,0,-1)],ct={contain:"contain",contain3d:"contain3d",cover:"cover",cover3d:"cover3d",fill:"fill",fill3d:"fill3d"},lt=function(t){this.object=t,this.forceBoundsExclusion=!1,this.weight=1,this.absolute=new nt,this.relative=new nt,this.orientation=new y,this.minRelativeSize=new i,this.minAbsoluteSize=new i,this._fit="contain",this.fitTargets={contain:1,contain3d:0,cover:0,cover3d:0,fill:0,fill3d:0},this.fitAlign=new i,this.clip=new nt,this.inner=new nt,this.innerAutoUpdate=!0,this.computedBounds=new nt,this.computedInnerBounds=new nt,this.computedOuterBounds=new nt,this.computedClipBounds=new nt,this.matrix=new n,this._boundsValid=!1,this.computedInnerBounds.objectFilter=at.objectFilter,this.computedInnerBounds.objectExpansion="box",this.computedInnerBounds.coordinateSystem=t},ht={fit:{configurable:!0}};ht.fit.set=function(t){for(var e in this._fit=t,this.fitTargets)this.fitTargets[e]=0;this.fitTargets[t]=1},ht.fit.get=function(){return this._fit},lt.prototype.invalidateBounds=function(){this._boundsValid=!1},lt.prototype.resetLayout=function(){this.fit="contain",this.absolute.makeEmpty(),this.relative.makeEmpty()},lt.prototype.resetPose=function(){this.object.position.setScalar(0),this.object.quaternion.set(0,0,0,1),this.object.scale.setScalar(1)},lt.prototype.reset=function(){this.resetLayout(),this.resetPose()},lt.prototype.isPassive=function(){return this.absolute.isEmpty()&&this.relative.isEmpty()},lt.prototype.isBoundingContext=function(){return!!this.forceBoundsExclusion||!this.isPassive()&&(this.forceBoundsExclusion=!0,!0)},lt.prototype.updateMatrix=function(){var t=this.computedBounds;if(this.isPassive())this.matrix.identity();else{this._boundsValid||(lt.updateInnerBounds(this.object),lt.updateOuterBounds(this.object),this.computedInnerBounds.isEmpty()&&this.computedInnerBounds.copy(this.computedOuterBounds),this._boundsValid=!0);var e=this.absolute,i=this.relative,n=this.fitTargets,o=this.orientation,r=this.computedInnerBounds,s=this.computedOuterBounds,a=this.clip;if(t.makeEmpty(),s.relativeToAbsolute(i.min,t.min),s.relativeToAbsolute(i.max,t.max),isFinite(e.min.x)&&(t.min.x=(isFinite(t.min.x)?t.min.x:0)+e.min.x),isFinite(e.min.y)&&(t.min.y=(isFinite(t.min.y)?t.min.y:0)+e.min.y),isFinite(e.min.z)&&(t.min.z=(isFinite(t.min.z)?t.min.z:0)+e.min.z),isFinite(e.max.x)&&(t.max.x=(isFinite(t.max.x)?t.max.x:0)+e.max.x),isFinite(e.max.y)&&(t.max.y=(isFinite(t.max.y)?t.max.y:0)+e.max.y),isFinite(e.max.z)&&(t.max.z=(isFinite(t.max.z)?t.max.z:0)+e.max.z),!a.isEmpty()){var u=r.absoluteToRelative(a.max,D.get()),c=r.absoluteToRelative(a.min,D.get());t.relativeToAbsolute(u,u),t.relativeToAbsolute(c,c),isFinite(u.x)||(u.x=Infinity),isFinite(u.y)||(u.y=Infinity),isFinite(u.z)||(u.z=Infinity),isFinite(c.x)||(c.x=-Infinity),isFinite(c.y)||(c.y=-Infinity),isFinite(c.z)||(c.z=-Infinity),t.max.min(u),t.min.max(c),D.pool(u),D.pool(c)}var l=s.getSize(D.get()).multiply(this.minRelativeSize).max(this.minAbsoluteSize),h=r.getSize(D.get()),p=t.getSize(D.get()).max(l).divide(h);lt.adjustScaleForFit(n,p);var f=D.get().multiplyVectors(h,p);f.x=Math.abs(f.x),f.y=Math.abs(f.y),f.z=Math.abs(f.z),isFinite(t.min.x)||isFinite(t.max.x)||(t.max.x=f.x/2,t.min.x=-t.max.x),isFinite(t.min.y)||isFinite(t.max.y)||(t.max.y=f.y/2,t.min.y=-t.max.y),isFinite(t.min.z)||isFinite(t.max.z)||(t.max.z=f.z/2,t.min.z=-t.max.z),isFinite(t.max.x)||(t.max.x=t.min.x+f.x),isFinite(t.max.y)||(t.max.y=t.min.y+f.y),isFinite(t.max.z)||(t.max.z=t.min.z+f.z),isFinite(t.min.x)||(t.min.x=t.max.x-f.x),isFinite(t.min.y)||(t.min.y=t.max.y-f.y),isFinite(t.min.z)||(t.min.z=t.max.z-f.z);var d=U.get().makeRotationFromQuaternion(o),m=f.divideScalar(2),y=t.relativeToAbsolute(this.fitAlign,D.get());t.min.copy(y).sub(m),t.max.copy(y).add(m),t.applyMatrix4(d);var x=r.relativeToAbsolute(this.fitAlign,D.get());x.multiply(p).applyMatrix4(d),t.min.sub(x),t.max.sub(x);var g=t.getCenter(D.get());this.matrix.compose(g,o,p),D.pool(h),D.pool(l),D.pool(f),D.pool(g),D.pool(p),D.pool(y)}},lt.updateInnerBounds=function(t){var e=t.layout,i=e.computedInnerBounds;return e._boundsValid?i:(i.coordinateSystem=t,i.setFromObject(t).union(e.inner),i.min.x===i.max.x&&(i.max.x+=1e-10),i.min.y===i.max.y&&(i.max.y+=1e-10),i.min.z===i.max.z&&(i.max.z+=1e-10),i)},lt.updateOuterBounds=function(t){var e=t.layout,i=e.computedOuterBounds;if(e._boundsValid)return i;var n=t.parent,o=n;if(o&&o.isCamera){var r=D.get().setFromMatrixPosition(t.matrix),s=U.get().getInverse(o.projectionMatrix),a=i.min.set(0,0,-1).applyMatrix4(s).z,u=i.min.set(0,0,1).applyMatrix4(s).z,c=i.min.set(0,0,r.z).applyMatrix4(o.projectionMatrix).z;i.min.set(-1,-1,c),i.max.set(1,1,c),i.min.applyMatrix4(s),i.max.applyMatrix4(s),i.min.z=u,i.max.z=a,D.pool(r),U.pool(s)}else n?i.copy(n.layout.computedInnerBounds):i.makeEmpty();var l=U.get().makeRotationFromQuaternion(e.orientation);return i.applyMatrix4(l.getInverse(l)),U.pool(l),i},lt.adjustScaleForFit=function(t,e){var i=this._fitScale,n=e,o=1e-10,r=1e10;if(!isFinite(n.x)&&!isFinite(n.y)&&!isFinite(n.z))return n.setScalar(1),n;isFinite(n.x)||(n.x=r),isFinite(n.y)||(n.y=r),isFinite(n.z)||(n.z=r),n.x=n.x<0?x.clamp(n.x,-r,-o):x.clamp(n.x,o,r),n.y=n.y<0?x.clamp(n.y,-r,-o):x.clamp(n.y,o,r),n.z=n.z<0?x.clamp(n.z,-r,-o):x.clamp(n.z,o,r);var s=n.x,a=n.y,u=n.z,c=Math.abs(s),l=Math.abs(a),h=Math.abs(u);return t.fill&&(i.set(s,a,s+a/2),n.lerp(i,t.fill)),t.contain&&(c<l?i.set(s,s,s):i.set(a,a,a),n.lerp(i,t.contain)),t.contain3d&&(c<l&&c<h?i.set(s,s,s):l<c&&l<h?i.set(a,a,a):i.set(u,u,u),n.lerp(i,t.contain3d)),t.cover&&(c>l?i.set(s,s,s):i.set(a,a,a),n.lerp(i,t.cover)),t.cover3d&&(c>l&&c>h?i.set(s,s,s):l>c&&l>h?i.set(a,a,a):i.set(u,u,u),n.lerp(i,t.cover3d)),isFinite(n.x)||(n.x=o),isFinite(n.y)||(n.y=o),isFinite(n.z)||(n.z=o),n.x=n.x<0?x.clamp(n.x,-r,-o):x.clamp(n.x,o,r),n.y=n.y<0?x.clamp(n.y,-r,-o):x.clamp(n.y,o,r),n.z=n.z<0?x.clamp(n.z,-r,-o):x.clamp(n.z,o,r),n},Object.defineProperties(lt.prototype,ht),lt._fitScale=new i;var pt=function(t){return function(e){return 1-t(1-e)}},ft=function(t){return function(e){return e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2}},dt=pt,mt=ft,yt=function(t){return function(e){return Math.pow(e,t)}},xt=function(t){return function(e){return e*e*((t+1)*e-t)}},gt=function(t){var e=xt(t);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},vt=yt(2),bt=pt(vt),wt=ft(vt),Ft=function(t){return 1-Math.sin(Math.acos(t))},_t=pt(Ft),Tt=ft(_t),Mt=xt(1.525),zt=function(t){var e=t*t;return t<4/11?7.5625*e:t<8/11?9.075*e-9.9*t+3.4:t<.9?4356/361*e-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},Bt="undefined"!=typeof Float32Array,Ct=function(t,e){return 1-3*e+3*t},Pt=function(t,e){return 3*e-6*t},It=function(t){return 3*t},At=function(t,e,i){return 3*Ct(e,i)*t*t+2*Pt(e,i)*t+It(e)},jt=function(t,e,i){return((Ct(e,i)*t+Pt(e,i))*t+It(e))*t},Et={reversed:pt,mirrored:ft,createReversedEasing:dt,createMirroredEasing:mt,createExpoIn:yt,createBackIn:xt,createAnticipateEasing:gt,linear:function(t){return t},easeIn:vt,easeOut:bt,easeInOut:wt,circIn:Ft,circOut:_t,circInOut:Tt,backIn:Mt,backOut:pt(Mt),backInOut:ft(Mt),anticipate:gt(1.525),bounceOut:zt,bounceIn:function(t){return 1-zt(1-t)},bounceInOut:function(t){return t<.5?.5*(1-zt(1-2*t)):.5*zt(2*t-1)+.5},cubicBezier:function(t,e,i,n){var o=Bt?new Float32Array(11):new Array(11);return function(){for(var e=0;e<11;++e)o[e]=jt(.1*e,t,i)}(),function(r){return t===e&&i===n?r:0===r?0:1===r?1:jt(function(e){for(var n,r,s=0,a=1;10!==a&&o[a]<=e;++a)s+=.1;return(r=At(n=s+(e-o[--a])/(o[a+1]-o[a])*.1,t,i))>=.001?function(e,n){for(var o=0,r=0;o<8;++o){if(0===(r=At(n,t,i)))return n;n-=(jt(n,t,i)-e)/r}return n}(e,n):0===r?n:function(e,n,o){var r,s,a=0;do{(r=jt(s=n+(o-n)/2,t,i)-e)>0?o=s:n=s}while(Math.abs(r)>1e-7&&++a<10);return s}(e,s,s+.1)}(r),e,n)}}};function Ot(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var i=0,n=t;i<n.length;i+=1){var o=n[i];if(void 0!==o)return o}}var St=function(t,e,i){this.value=t,this.duration=e,this.easing=i},Dt=function(t){this.multiplier=void 0,this.duration=void 0,this.easing=void 0,this.threshold=void 0,this.delay=void 0,this.debounce=void 0,this.maxWait=void 0,this.targetQueue=[],this._delayTime=0,this._debounceTime=0,this._waitTime=0,this._changePercent=0,this._config={},Object.assign(this,t);var e=this.target;void 0===this.current&&(this.current="number"==typeof e?e:e.clone()),void 0===this.start&&(this.start="number"==typeof e?e:e.clone())};Dt.prototype.update=function(t,e,i){var n=this._updateConfig(e),o=this.targetQueue,r=this.target;for(this._changePercent=i="number"==typeof i?i:this._computePercentChange(),t*=n.multiplier,i>n.threshold?(this._delayTime>n.delay&&("number"==typeof r?this.committedTarget=r:this.committedTarget?this.committedTarget.copy(r):this.committedTarget=r.clone(),this._delayTime=0,this._debounceTime=0),this._delayTime+=t):(void 0!==this.committedTarget&&(this._delayTime=0),this._debounceTime+=t),this.committedTarget&&(this._waitTime+=t),this.committedTarget&&(this._debounceTime>n.debounce||this._waitTime>n.maxWait)&&(o.push({value:this.committedTarget,easing:n.easing,duration:n.duration,elapsed:0}),this.committedTarget=void 0,this._waitTime=0);o.length&&o[0].elapsed>o[0].duration;)this.start=o.shift().value;this._setCurrent(this.start);for(var s=this.start,a=0,u=o;a<u.length;a+=1){var c=u[a];c.elapsed+=t,this._addTargetInfluence(s,c),s=c.value}},Dt.prototype._addTargetInfluence=function(t,e){var i=e.duration>0?e.easing(Math.min(e.elapsed,e.duration)/e.duration):1;if("number"!=typeof e.value&&"isMatrix4"in e.value){var n=this.current,o=t,r=e.value,s=D.get(),a=V.get(),u=D.get();n.decompose(s,a,u);var c=D.get(),l=V.get(),h=D.get();o.decompose(c,l,h);var p=D.get(),f=V.get(),d=D.get();return r.decompose(p,f,d),s.add(p.sub(c).lerp(B,1-i)),a.multiply(l.inverse().multiply(f).slerp(j,1-i)).normalize(),u.add(d.sub(h).lerp(B,1-i)),D.pool(s),V.pool(a),D.pool(u),D.pool(c),V.pool(l),D.pool(h),D.pool(p),V.pool(f),void D.pool(d)}if("number"!=typeof e.value){if("isVector3"in e.value){var m=this.current,y=t,g=e.value,v=D.get().copy(g).sub(y).lerp(B,1-i);return m.add(v),void D.pool(v)}if("isVector2"in e.value){var b=this.current,w=t,F=e.value,_=S.get().copy(F).sub(w).lerp(M,1-i);return b.add(_),void S.pool(_)}if("isQuaternion"in e.value){var T=this.current,z=t,C=e.value,P=V.get().copy(z).inverse().multiply(C).slerp(j,1-i);return T.multiply(P).normalize(),void V.pool(P)}if("isColor"in e.value){var I=this.current,A=t,E=Dt._c.copy(e.value).sub(A).lerp(Dt._cBlack,1-i);I.add(E)}else if("isBox3"in e.value){var O=this.current,W=t,N=e.value,U=D.get().copy(N.min).sub(W.min).lerp(B,1-i),G=D.get().copy(N.max).sub(W.max).lerp(B,1-i);return isFinite(O.min.x)&&(O.min.x=0),isFinite(O.min.y)&&(O.min.y=0),isFinite(O.min.z)&&(O.min.z=0),isFinite(O.max.x)&&(O.max.x=0),isFinite(O.max.y)&&(O.max.y=0),isFinite(O.max.z)&&(O.max.z=0),O.min.add(U),void O.max.add(G)}}else this.current+=x.lerp(0,e.value-t,i)},Dt.prototype._setCurrent=function(t){"number"==typeof t?this.current=t:this.current.copy(t)},Dt.prototype._computePercentChange=function(){var t=this.target,e=this.committedTarget||this.targetQueue[0]&&this.targetQueue[0].value||this.current;if("number"==typeof e)return Math.abs(t-e/(this.range||1));if("isMatrix4"in e){var i=e,n=t,o=D.get(),r=V.get(),s=D.get();i.decompose(o,r,s);var a=D.get(),u=V.get(),c=D.get();n.decompose(a,u,c);var l=o.equals(a)?0:Infinity,h=Math.abs(r.angleTo(u)/Math.PI),p=s.equals(c)?0:Infinity;return D.pool(o),V.pool(r),D.pool(s),D.pool(a),V.pool(u),D.pool(c),Math.max(l,h,p)}if("isVector3"in e){var f=e,d=t;if(!this.range)return d.equals(f)?0:Infinity;var m=D.get().subVectors(d,f).divide(this.range),y=m.x,x=m.y,g=m.z;return D.pool(m),Math.max(Math.abs(y||0),Math.abs(x||0),Math.abs(g||0))}if("isVector2"in e){var v=e,b=t;if(!this.range)return b.equals(v)?0:Infinity;var w=S.get().subVectors(b,v).divide(this.range),F=w.x,_=w.y;return S.pool(w),Math.max(Math.abs(F||0),Math.abs(_||0))}if("isQuaternion"in e)return Math.abs(e.angleTo(t)/Math.PI);if("isColor"in e){var T=e,M=t;return Math.max(Math.abs(M.r-T.r),Math.abs(M.g-T.r),Math.abs(M.b-T.r))}if("isBox3"in e){var z=e,B=t;if(!this.range)return B.equals(z)?0:Infinity;var C=this.range,P=D.get().subVectors(B.min,z.min).divide(C),I=D.get().subVectors(B.max,z.max).divide(C),A=Math.max(Math.abs(P.x||0),Math.abs(P.y||0),Math.abs(P.z||0)),j=Math.max(Math.abs(I.x||0),Math.abs(I.y||0),Math.abs(I.z||0));return D.pool(P),D.pool(I),Math.max(A,j)}return Infinity},Dt.prototype._updateConfig=function(t){return this._config.multiplier=Ot(this.multiplier,t&&t.multiplier,Vt.DEFAULT_CONFIG.multiplier),this._config.duration=Ot(this.duration,t&&t.duration,Vt.DEFAULT_CONFIG.duration),this._config.easing=Ot(this.easing,t&&t.easing,Vt.DEFAULT_CONFIG.easing),this._config.threshold=Ot(this.threshold,t&&t.threshold,Vt.DEFAULT_CONFIG.threshold),this._config.delay=Ot(this.delay,t&&t.delay,Vt.DEFAULT_CONFIG.delay),this._config.debounce=Ot(this.debounce,t&&t.debounce,Vt.DEFAULT_CONFIG.debounce),this._config.maxWait=Ot(this.maxWait,t&&t.maxWait,Vt.DEFAULT_CONFIG.maxWait),this._config},Dt._c=new g,Dt._cBlack=new g(0,0,0);var Wt=function(t){function e(e){t.call(this,{target:new n}),this.object=e,this.position=new t({target:new i}),this.quaternion=new t({target:new y}),this.scale=new t({target:new i(1,1,1)}),this.autoRange=!0,this.synchronizeComponents=!0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.update=function(t,e){this._updateConfig(e);var n=this.position,o=this.quaternion,r=this.scale,s=this._config;this.autoRange&&(n.range||(n.range=new i),r.range||(r.range=new i),this.object.layout.computedOuterBounds.getSize(n.range),this.object.layout.computedOuterBounds.getSize(r.range).divide(n.range),isFinite(r.range.x)&&0!==r.range.x||(r.range.x=1),isFinite(r.range.y)&&0!==r.range.y||(r.range.y=1),isFinite(r.range.z)&&0!==r.range.z||(r.range.z=1)),this.target.decompose(n.target,o.target,r.target),this.current.decompose(n.current,o.current,r.current);var a=void 0;this.synchronizeComponents&&(a=Math.max(n._computePercentChange(),o._computePercentChange(),r._computePercentChange())),n.update(t,s,a),o.update(t,s,a),r.update(t,s,a),this.current.compose(n.current,o.current,r.current)},e}(Dt),Vt=function(t){this.object=t,this._active=!1,this.parentTarget=null,this.matrixWorldTarget=new n,this.multiplier=void 0,this.duration=void 0,this.easing=void 0,this.threshold=void 0,this.delay=void 0,this.debounce=void 0,this.maxWait=void 0,this.customTransitionables=[],this.matrixLocal=new Wt(this.object)},Nt={active:{configurable:!0}};Nt.active.set=function(t){this._active=t},Nt.active.get=function(){return this._active&&!Vt.disableAllTransitions},Vt.prototype.add=function(t){var e=t instanceof Dt?t:new Dt(t);return this.customTransitionables.push(e),e},Vt.prototype.update=function(t,e){if(void 0===e&&(e=!0),!this.active&&e&&(this.active=!0),this.active){e&&this.object.updateWorldMatrix(!0,!0),this._setParent(),t=Math.max(t,1e-10),this.matrixLocal.update(t,this);for(var i=0,n=this.customTransitionables;i<n.length;i+=1)n[i].update(t,this);this.object.updateWorldMatrix(!1,!0)}else{this.matrixLocal.current.copy(this.matrixLocal.target);for(var o=0,r=this.customTransitionables;o<r.length;o+=1){var s=r[o];s._setCurrent(s.target)}}},Vt.prototype._setParent=function(){var t=this.parentTarget,e=this.object;if(t&&e.parent!==t){e.updateWorldMatrix(!0,!0);var i=U.get().copy(e.matrixWorld);e.parent&&e.parent.remove(e),t&&t.add(e),t.updateWorldMatrix(!0,!0);var n=t?U.get().getInverse(t.matrixWorld):U.get().identity();e.matrix.copy(n.multiply(i)),e.matrix.decompose(e.position,e.quaternion,e.scale),U.pool(i),U.pool(n)}},Object.defineProperties(Vt.prototype,Nt),Vt.disableAllTransitions=!1,Vt.DEFAULT_CONFIG={multiplier:1,duration:1.5,easing:wt,threshold:.01,delay:0,debounce:0,maxWait:10},Vt.NATURAL_DURATION=-Math.log(1-.95);var Ut=new i,Gt=new i,Rt=new i,qt=new a,kt=new a,Ht=new a,Lt=new i,Qt=new i;function Xt(t,e,n,o,r,u){const p=3*r,f=e.index.getX(p),d=e.index.getX(p+1),m=e.index.getX(p+2),y=function(t,e,n,o,r,u,p,f){Ut.fromBufferAttribute(o,u),Gt.fromBufferAttribute(o,p),Rt.fromBufferAttribute(o,f);var d=function(t,e,i,n,o,r,s,a){if(null===(e.side===l?n.intersectTriangle(s,r,o,!0,a):n.intersectTriangle(o,r,s,e.side!==c,a)))return null;Qt.copy(a),Qt.applyMatrix4(t.matrixWorld);var u=i.ray.origin.distanceTo(Qt);return u<i.near||u>i.far?null:{distance:u,point:Qt.clone(),object:t}}(t,t.material,e,n,Ut,Gt,Rt,Lt);if(d){r&&(qt.fromBufferAttribute(r,u),kt.fromBufferAttribute(r,p),Ht.fromBufferAttribute(r,f),d.uv=s.getUV(Lt,Ut,Gt,Rt,qt,kt,Ht,new a));var m=new i;d.face=new h(u,p,f,s.getNormal(Ut,Gt,Rt,m)),d.faceIndex=u}return d}(t,n,o,e.attributes.position,e.attributes.uv,f,d,m);return y?(y.faceIndex=r,u&&u.push(y),y):null}function Yt(t,e){return e.min.x=t[0],e.min.y=t[1],e.min.z=t[2],e.max.x=t[3],e.max.y=t[4],e.max.z=t[5],e}function Zt(t){let e=-1,i=-Infinity;for(let n=0;n<3;n++){const o=t[n+3]-t[n];o>i&&(i=o,e=n)}return e}class $t{constructor(){this.min=Infinity,this.max=-Infinity}setFromPointsField(t,e){let i=Infinity,n=-Infinity;for(let o=0,r=t.length;o<r;o++){const r=t[o][e];i=Math.min(r,i),n=Math.max(r,n)}this.min=i,this.max=n}setFromPoints(t,e){let i=Infinity,n=-Infinity;for(let o=0,r=e.length;o<r;o++){const r=t.dot(e[o]);i=Math.min(r,i),n=Math.max(r,n)}this.min=i,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}}$t.prototype.setFromBox=function(){const t=new i;return function(e,i){const n=i.min,o=i.max;let r=Infinity,s=-Infinity;for(let i=0;i<=1;i++)for(let a=0;a<=1;a++)for(let u=0;u<=1;u++){t.x=n.x*i+o.x*(1-i),t.y=n.y*a+o.y*(1-a),t.z=n.z*u+o.z*(1-u);const c=e.dot(t);r=Math.min(c,r),s=Math.max(c,s)}this.min=r,this.max=s}}();const Jt=function(){const t=new i,e=new i,n=new i;return function(i,o,r){const s=t,a=e;n.subVectors(i.start,o.start),t.subVectors(i.end,o.start),e.subVectors(o.end,o.start);const u=n.dot(a),c=a.dot(s),l=a.dot(a),h=n.dot(s),p=s.dot(s)*l-c*c;let f,d;d=(u+(f=0!==p?(u*c-h*l)/p:0)*c)/l,r.x=f,r.y=d}}(),Kt=function(){const t=new a,e=new i,n=new i;return function(i,o,r,s){Jt(i,o,t);let a=t.x,u=t.y;if(a>=0&&a<=1&&u>=0&&u<=1)return i.at(a,r),void o.at(u,s);if(a>=0&&a<=1)return o.at(u<0?0:1,s),void i.closestPointToPoint(s,!0,r);if(u>=0&&u<=1)return i.at(a<0?0:1,r),void o.closestPointToPoint(r,!0,s);{let t,c;t=a<0?i.start:i.end;const l=e,h=n;return i.closestPointToPoint(c=u<0?o.start:o.end,!0,e),o.closestPointToPoint(t,!0,n),l.distanceToSquared(c)<=h.distanceToSquared(t)?(r.copy(l),void s.copy(c)):(r.copy(t),void s.copy(h))}}}(),te=function(){const t=new i,e=new i,n=new u,o=new r;return function(i,r){const{radius:s,center:a}=i,{a:u,b:c,c:l}=r;if(o.start=u,o.end=c,o.closestPointToPoint(a,!0,t).distanceTo(a)<=s)return!0;if(o.start=u,o.end=l,o.closestPointToPoint(a,!0,t).distanceTo(a)<=s)return!0;if(o.start=c,o.end=l,o.closestPointToPoint(a,!0,t).distanceTo(a)<=s)return!0;const h=r.getPlane(n);if(Math.abs(h.distanceToPoint(a))<=s){const t=h.projectPoint(a,e);if(r.containsPoint(t))return!0}return!1}}();class ee extends s{constructor(...t){super(...t),this.isSeparatingAxisTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new i),this.satBounds=new Array(4).fill().map(()=>new $t),this.points=[this.a,this.b,this.c],this.sphere=new o}}ee.prototype.update=function(){const t=new Array(3);return function(){const e=this.a,i=this.b,n=this.c;t[0]=this.a,t[1]=this.b,t[2]=this.c;const o=this.satAxes,r=this.satBounds,s=o[0],a=r[0];this.getNormal(s),a.setFromPoints(s,t);const u=o[1],c=r[1];u.subVectors(e,i),c.setFromPoints(u,t);const l=o[2],h=r[2];l.subVectors(i,n),h.setFromPoints(l,t);const p=o[3],f=r[3];p.subVectors(n,e),f.setFromPoints(p,t),this.sphere.setFromPoints(this.points)}}(),ee.prototype.intersectsTriangle=function(){const t=new ee,e=new Array(3),n=new Array(3),o=new $t,r=new $t,s=new i;return function(i){i.isSeparatingAxisTriangle||(t.copy(i),t.update(),i=t);const a=this.satBounds,u=this.satAxes;n[0]=i.a,n[1]=i.b,n[2]=i.c;for(let t=0;t<4;t++){const e=a[t];if(o.setFromPoints(u[t],n),e.isSeparated(o))return!1}const c=i.satBounds,l=i.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const i=c[t];if(o.setFromPoints(l[t],e),i.isSeparated(o))return!1}for(let t=0;t<4;t++){const i=u[t];for(let t=0;t<4;t++)if(s.crossVectors(i,l[t]),o.setFromPoints(s,e),r.setFromPoints(s,n),o.isSeparated(r))return!1}return!0}}(),ee.prototype.distanceToPoint=function(){const t=new i;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),ee.prototype.distanceToTriangle=function(){const t=new i,e=new i,n=["a","b","c"],o=new r,s=new r;return function(i,r=null,a=null){if(this.intersectsTriangle(i))return(r||a)&&(this.getMidpoint(t),i.closestPointToPoint(t,e),this.closestPointToPoint(e,t),r&&r.copy(t),a&&a.copy(e)),0;let u=Infinity;for(let e=0;e<3;e++){let o;const s=n[e],c=i[s];this.closestPointToPoint(c,t),(o=c.distanceToSquared(t))<u&&(u=o,r&&r.copy(t),a&&a.copy(c));const l=this[s];i.closestPointToPoint(l,t),(o=l.distanceToSquared(t))<u&&(u=o,r&&r.copy(l),a&&a.copy(t))}for(let c=0;c<3;c++){o.set(this[n[c]],this[n[(c+1)%3]]);for(let c=0;c<3;c++){s.set(i[n[c]],i[n[(c+1)%3]]),Kt(o,s,t,e);const l=t.distanceToSquared(e);l<u&&(u=l,r&&r.copy(t),a&&a.copy(e))}}return Math.sqrt(u)}}();class ie extends e{constructor(...t){super(...t),this.isOrientedBox=!0,this.matrix=new n,this.invMatrix=new n,this.points=new Array(8).fill().map(()=>new i),this.satAxes=new Array(3).fill().map(()=>new i),this.satBounds=new Array(3).fill().map(()=>new $t),this.alignedSatBounds=new Array(3).fill().map(()=>new $t),this.sphere=new o}set(t,e,i){super.set(t,e),this.matrix=i}copy(t){super.copy(t),this.matrix.copy(t.matrix)}}ie.prototype.update=function(){const t=this.matrix,e=this.min,i=this.max,n=this.points;for(let o=0;o<=1;o++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){const a=n[1*o|2*r|4*s];a.x=o?i.x:e.x,a.y=r?i.y:e.y,a.z=s?i.z:e.z,a.applyMatrix4(t)}this.sphere.setFromPoints(this.points);const o=this.satBounds,r=this.satAxes,s=n[0];for(let t=0;t<3;t++){const e=r[t],i=o[t];e.subVectors(s,n[1<<t]),i.setFromPoints(e,n)}const a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.getInverse(this.matrix)},ie.prototype.intersectsBox=function(){const t=new $t;return function(e){if(!e.intersectsSphere(this.sphere))return!1;const i=e.min,n=e.max,o=this.satBounds,r=this.satAxes,s=this.alignedSatBounds;if(t.min=i.x,t.max=n.x,s[0].isSeparated(t))return!1;if(t.min=i.y,t.max=n.y,s[1].isSeparated(t))return!1;if(t.min=i.z,t.max=n.z,s[2].isSeparated(t))return!1;for(let i=0;i<3;i++){const n=o[i];if(t.setFromBox(r[i],e),n.isSeparated(t))return!1}return!0}}(),ie.prototype.intersectsTriangle=function(){const t=new ee,e=new Array(3),n=new $t,o=new $t,r=new i;return function(i){i.isSeparatingAxisTriangle||(t.copy(i),t.update(),i=t);const s=this.satBounds,a=this.satAxes;e[0]=i.a,e[1]=i.b,e[2]=i.c;for(let t=0;t<3;t++){const i=s[t];if(n.setFromPoints(a[t],e),i.isSeparated(n))return!1}const u=i.satBounds,c=i.satAxes,l=this.points;for(let t=0;t<3;t++){const e=u[t];if(n.setFromPoints(c[t],l),e.isSeparated(n))return!1}for(let t=0;t<3;t++){const i=a[t];for(let t=0;t<4;t++)if(r.crossVectors(i,c[t]),n.setFromPoints(r,e),o.setFromPoints(r,l),n.isSeparated(o))return!1}return!0}}(),ie.prototype.closestPointToPoint=function(t,e){return e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},ie.prototype.distanceToPoint=function(){const t=new i;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),ie.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map(()=>new r),n=new Array(12).fill().map(()=>new r),o=new i,s=new i;return function(i,r=0,a=null,u=null){if(this.intersectsBox(i))return(a||u)&&(i.getCenter(s),this.closestPointToPoint(s,o),i.closestPointToPoint(o,s),a&&a.copy(o),u&&u.copy(s)),0;const c=r*r,l=i.min,h=i.max,p=this.points;let f=Infinity;for(let t=0;t<8;t++){const e=p[t];s.copy(e).clamp(l,h);const i=e.distanceToSquared(s);if(i<f&&(f=i,a&&a.copy(e),u&&u.copy(s),i<c))return Math.sqrt(i)}let d=0;for(let i=0;i<3;i++)for(let o=0;o<=1;o++)for(let r=0;r<=1;r++){const s=(i+1)%3,a=(i+2)%3;e[d].set(p[o<<s|r<<a],p[1<<i|o<<s|r<<a]);const u=t[i],c=t[s],f=t[a],m=n[d],y=m.start,x=m.end;y[u]=l[u],y[c]=o?l[c]:h[c],y[f]=r?l[f]:h[c],x[u]=h[u],x[c]=o?l[c]:h[c],x[f]=r?l[f]:h[c],d++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){s.x=t?h.x:l.x,s.y=e?h.y:l.y,s.z=i?h.z:l.z,this.closestPointToPoint(s,o);const n=s.distanceToSquared(o);if(n<f&&(f=n,a&&a.copy(o),u&&u.copy(s),n<c))return Math.sqrt(n)}for(let t=0;t<12;t++){const i=e[t];for(let t=0;t<12;t++){Kt(i,n[t],o,s);const e=o.distanceToSquared(s);if(e<f&&(f=e,a&&a.copy(o),u&&u.copy(s),e<c))return Math.sqrt(e)}}return Math.sqrt(f)}}();const ne=new e,oe=new i,re=["x","y","z"];function se(t,e,i,n){const o=t.a,r=t.b,s=t.c;let a=i.getX(e);o.x=n.getX(a),o.y=n.getY(a),o.z=n.getZ(a),a=i.getX(e+1),r.x=n.getX(a),r.y=n.getY(a),r.z=n.getZ(a),a=i.getX(e+2),s.x=n.getX(a),s.y=n.getY(a),s.z=n.getZ(a)}class ae{constructor(){}intersectRay(t,e){return Yt(this.boundingData,ne),t.intersectBox(ne,e)}raycast(t,e,i,n){this.count?function(t,e,i,n,o,r,s){for(let a=o,u=o+r;a<u;a++)Xt(t,e,i,n,a,s)}(t,t.geometry,e,i,this.offset,this.count,n):(this.left.intersectRay(i,oe)&&this.left.raycast(t,e,i,n),this.right.intersectRay(i,oe)&&this.right.raycast(t,e,i,n))}raycastFirst(t,e,i){if(this.count)return function(t,e,i,n,o,r){let s=Infinity,a=null;for(let u=o,c=o+r;u<c;u++){const o=Xt(t,e,i,n,u);o&&o.distance<s&&(a=o,s=o.distance)}return a}(t,t.geometry,e,i,this.offset,this.count);{const n=this.splitAxis,o=re[n];let r,s;i.direction[o]>=0?(r=this.left,s=this.right):(r=this.right,s=this.left);const a=r.intersectRay(i,oe)?r.raycastFirst(t,e,i):null;if(a){const t=i.origin[o],e=t-a.point[o],r=t-s.boundingData[n],u=t-s.boundingData[n+3],c=e*e;if(c<=r*r&&c<=u*u)return a}const u=s.intersectRay(i,oe)?s.raycastFirst(t,e,i):null;return a&&u?a.distance<=u.distance?a:u:a||u||null}}}ae.prototype.shapecast=function(){const t=new ee,i=new e,n=new e;return function(e,o,r=null,s=null){if(this.count&&r){const i=e.geometry,n=i.index,o=i.attributes.position,s=this.offset;for(let e=3*s,i=3*(this.count+s);e<i;e+=3)if(se(t,e,n,o),t.update(),r(t,e,e+1,e+2))return!0;return!1}{const t=this.left,a=this.right;let u,c,l,h,p=t,f=a;if(s&&(h=n,Yt(p.boundingData,l=i),Yt(f.boundingData,h),u=s(l),(c=s(h))<u)){p=a,f=t;const e=u;u=c,c=e;const i=l;l=h,h=i}return l||Yt(p.boundingData,l=i),!!(o(l,!!p.count,u,p)&&p.shapecast(e,o,r,s)||(h||Yt(f.boundingData,h=n),o(h,!!f.count,c,f)&&f.shapecast(e,o,r,s)))}}}(),ae.prototype.intersectsGeometry=function(){const t=new ee,e=new ee,i=new f,o=new n,r=new ie,s=new ie;return function(n,a,u,c=null){if(null===c&&(a.boundingBox||a.computeBoundingBox(),r.set(a.boundingBox.min,a.boundingBox.max,u),r.update(),c=r),!this.count){const t=this.left,e=this.right;return Yt(t.boundingData,ne),!!(c.intersectsBox(ne)&&t.intersectsGeometry(n,a,u,c)||(Yt(e.boundingData,ne),c.intersectsBox(ne)&&e.intersectsGeometry(n,a,u,c)))}{const r=n.geometry,c=r.index,l=r.attributes.position,h=a.index,p=a.attributes.position,f=this.offset,d=this.count;if(o.getInverse(u),a.boundsTree){Yt(this.boundingData,s),s.matrix.copy(o),s.update(),i.geometry=a;const t=a.boundsTree.shapecast(i,t=>s.intersectsBox(t),function(t){t.a.applyMatrix4(u),t.b.applyMatrix4(u),t.c.applyMatrix4(u),t.update();for(let i=3*f,n=3*(d+f);i<n;i+=3)if(se(e,i,c,l),e.update(),t.intersectsTriangle(e))return!0;return!1});return i.geometry=null,t}for(let i=3*f,n=d+3*f;i<n;i+=3){se(t,i,c,l),t.a.applyMatrix4(o),t.b.applyMatrix4(o),t.c.applyMatrix4(o),t.update();for(let i=0,n=h.count;i<n;i+=3)if(se(e,i,h,p),e.update(),t.intersectsTriangle(e))return!0}}}}(),ae.prototype.intersectsBox=function(){const t=new ie;return function(e,i,n){return t.set(i.min,i.max,n),t.update(),this.shapecast(e,e=>t.intersectsBox(e),e=>t.intersectsTriangle(e))}}(),ae.prototype.intersectsSphere=function(t,e){return this.shapecast(t,t=>e.intersectsBox(t),t=>te(e,t))},ae.prototype.closestPointToPoint=function(){const t=new i;return function(e,i,n=null,o=0,r=Infinity){let s=Infinity;return this.shapecast(e,(t,e,i)=>i<s&&i<r,e=>{e.closestPointToPoint(i,t);const r=i.distanceTo(t);return r<s&&(n&&n.copy(t),s=r),r<o},t=>t.distanceToPoint(i)),s}}(),ae.prototype.closestPointToGeometry=function(){const t=new ee,e=new ie,n=new i,o=new i;return function(i,r,s,a=null,u=null,c=0,l=Infinity){r.boundingBox||r.computeBoundingBox(),e.set(r.boundingBox.min,r.boundingBox.max,s),e.update();const h=r.attributes.position,p=r.index;let f,d;a&&(f=n),u&&(d=o);let m=Infinity;return this.shapecast(i,(t,e,i)=>i<m&&i<l,e=>{const i=e.sphere;for(let n=0,o=p.count;n<o;n+=3){se(t,n,p,h),t.a.applyMatrix4(s),t.b.applyMatrix4(s),t.c.applyMatrix4(s),t.sphere.setFromPoints(t.points);const o=t.sphere;if(o.center.distanceTo(i.center)-o.radius-i.radius>m)continue;t.update();const r=e.distanceToTriangle(t,f,d);if(r<m&&(a&&a.copy(f),u&&u.copy(d),m=r),r<c)return!0}return!1},t=>e.distanceToBox(t,Math.min(m,l))),m}}();const ue=0,ce=1,le=2,he=["x","y","z"],pe=new e;class fe{constructor(t,e){if(this.geo=t,this.options=e,this.bounds=function(t){const e=t.attributes.position.array,i=t.index.array,n=i.length/3,o=new Float32Array(6*n);for(let t=0;t<n;t++){const n=3*i[3*t+0],r=3*i[3*t+1],s=3*i[3*t+2];for(let i=0;i<3;i++){const a=e[n+i],u=e[r+i],c=e[s+i],l=Math.min(a,u,c),h=(Math.max(a,u,c)-l)/2;o[6*t+2*i+0]=l+h,o[6*t+2*i+1]=h}}return o}(t),this.sahplanes=null,e.strategy===le){const e=t.index.count/3;this.sahplanes=[new Array(e),new Array(e),new Array(e)];for(let t=0;t<e;t++)for(let e=0;e<3;e++)this.sahplanes[e][t]={p:this.bounds[6*t+2*e],tri:t}}}getAverage(t,e,i){let n=0;const o=this.bounds;for(let r=t,s=t+e;r<s;r++)n+=o[6*r+2*i];return n/e}getBounds(t,e,i){let n=Infinity,o=Infinity,r=Infinity,s=-Infinity,a=-Infinity,u=-Infinity;const c=this.bounds;for(let i=t,l=t+e;i<l;i++){const t=c[6*i+0],e=c[6*i+1];n=Math.min(n,t-e),s=Math.max(s,t+e);const l=c[6*i+2],h=c[6*i+3];o=Math.min(o,l-h),a=Math.max(a,l+h);const p=c[6*i+4],f=c[6*i+5];r=Math.min(r,p-f),u=Math.max(u,p+f)}return i[0]=n,i[1]=o,i[2]=r,i[3]=s,i[4]=a,i[5]=u,i}partition(t,e,i){let n=t,o=t+e-1;const r=i.pos,s=2*i.axis,a=this.geo.index.array,u=this.bounds,c=this.sahplanes;for(;;){for(;n<=o&&u[6*n+s]<r;)n++;for(;n<=o&&u[6*o+s]>=r;)o--;if(!(n<o))return n;for(let t=0;t<3;t++){let e=a[3*n+t];a[3*n+t]=a[3*o+t],a[3*o+t]=e;let i=u[6*n+2*t+0];u[6*n+2*t+0]=u[6*o+2*t+0],u[6*o+2*t+0]=i;let r=u[6*n+2*t+1];u[6*n+2*t+1]=u[6*o+2*t+1],u[6*o+2*t+1]=r}if(c)for(let t=0;t<3;t++){let e=c[t][n];c[t][n]=c[t][o],c[t][o]=e}n++,o--}}getOptimalSplit(t,e,i,n){let o=-1,r=0;if(n===ue)-1!==(o=Zt(t))&&(r=(t[o+3]+t[o])/2);else if(n===ce)-1!==(o=Zt(t))&&(r=this.getAverage(e,i,o));else if(n===le){const n=3,s=1,a=Yt(t,pe),u=[a.max.x-a.min.x,a.max.y-a.min.y,a.max.z-a.min.z],c=2*(u[0]*u[1]+u[0]*u[2]+u[1]*u[2]),l=[[],[],[]];for(let t=e,n=e+i;t<n;t++)for(let e=0;e<3;e++)l[e].push(this.sahplanes[e][t]);l.forEach(t=>t.sort((t,e)=>t.p-e.p));const h=(t,e,i,o,r)=>n+s*(e/t*i+o/t*r);o=-1;let p=s*i;for(let t=0;t<3;t++){const e=(t+1)%3,n=(t+2)%3,s=a.min[he[t]],f=a.max[he[t]],d=l[t];let m=0,y=i;for(let i=0;i<d.length;i++){const a=d[i],l=a.p-s,x=f-a.p;let g=u[e],v=u[e],b=u[n],w=u[n];const F=h(c,2*(g*b+g*l+b*l),++m,2*(v*w+v*x+w*x),--y);F<p&&(o=t,r=a.p,p=F)}}}return{axis:o,pos:r}}}class de{constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.attributes.position.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the position attribute.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");(e=Object.assign({strategy:ue,maxDepth:40,maxLeafTris:10,verbose:!0},e)).strategy=Math.max(0,Math.min(2,e.strategy)),this._roots=this._buildTree(t,e)}_ensureIndex(t){if(!t.index){const e=t.attributes.position.count,i=new(e>65535?Uint32Array:Uint16Array)(e);t.setIndex(new _(i,1));for(let t=0;t<e;t++)i[t]=t}}_getRootIndexRanges(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];const e=[],i=new Set;for(const e of t.groups)i.add(e.start),i.add(e.start+e.count);const n=Array.from(i.values()).sort((t,e)=>t-e);for(let t=0;t<n.length-1;t++){const i=n[t];e.push({offset:i/3,count:(n[t+1]-i)/3})}return e}_buildTree(t,i){this._ensureIndex(t);const n=new fe(t,i);let o=!1;const r=(t,e,s,a=0)=>{if(a>=i.maxDepth&&(o=!0),s<=i.maxLeafTris||a>=i.maxDepth)return t.offset=e,t.count=s,t;const u=n.getOptimalSplit(t.boundingData,e,s,i.strategy);if(-1===u.axis)return t.offset=e,t.count=s,t;const c=n.partition(e,s,u);if(c===e||c===e+s)t.offset=e,t.count=s;else{t.splitAxis=u.axis;const i=t.left=new ae,o=e,l=c-e;i.boundingData=n.getBounds(o,l,new Float32Array(6)),r(i,o,l,a+1);const h=t.right=new ae,p=c,f=s-l;h.boundingData=n.getBounds(p,f,new Float32Array(6)),r(h,p,f,a+1)}return t},s=[],a=this._getRootIndexRanges(t);if(1===a.length){const e=new ae,i=a[0];e.boundingData=null!=t.boundingBox?function(t){const e=new Float32Array(6);return e[0]=t.min.x,e[1]=t.min.y,e[2]=t.min.z,e[3]=t.max.x,e[4]=t.max.y,e[5]=t.max.z,e}(t.boundingBox):n.getBounds(i.offset,i.count,new Float32Array(6)),r(e,i.offset,i.count),s.push(e)}else for(let t of a){const e=new ae;e.boundingData=n.getBounds(t.offset,t.count,new Float32Array(6)),r(e,t.offset,t.count),s.push(e)}if(o&&i.verbose&&(console.warn(`MeshBVH: Max depth of ${i.maxDepth} reached when generating BVH. Consider increasing maxDepth.`),console.warn(this,t)),null==t.boundingBox){const i=new e;t.boundingBox=new e;for(let e of s)t.boundingBox.union(Yt(e.boundingData,i))}return s}raycast(t,e,i,n){for(const o of this._roots)o.raycast(t,e,i,n)}raycastFirst(t,e,i){let n=null;for(const o of this._roots){const r=o.raycastFirst(t,e,i);null!=r&&(null==n||r.distance<n.distance)&&(n=r)}return n}intersectsGeometry(t,e,i){for(const n of this._roots)if(n.intersectsGeometry(t,e,i))return!0;return!1}shapecast(t,e,i=null,n=null){for(const o of this._roots)if(o.shapecast(t,e,i,n))return!0;return!1}intersectsBox(t,e,i){for(const n of this._roots)if(n.intersectsBox(t,e,i))return!0;return!1}intersectsSphere(t,e){for(const i of this._roots)if(i.intersectsSphere(t,e))return!0;return!1}closestPointToGeometry(t,e,i,n,o,r,s){let a=Infinity;for(const u of this._roots){const c=u.closestPointToGeometry(t,e,i,n,o,r,s);if(c<a&&(a=c),c<r)return c}return a}distanceToGeometry(t,e,i,n,o){return this.closestPointToGeometry(t,e,i,null,null,n,o)}closestPointToPoint(t,e,i,n,o){let r=Infinity;for(const s of this._roots){const a=s.closestPointToPoint(t,e,i,n,o);if(a<r&&(r=a),a<n)return a}return r}distanceToPoint(t,e,i,n){return this.closestPointToPoint(t,e,null,i,n)}}new T({color:65416,transparent:!0,opacity:.3}),new t,new e;const me=new w,ye=new n,xe=f.prototype.raycast;p.prototype.computeBoundsTree=function(t){return this.boundsTree=new de(this,t),this.boundsTree},p.prototype.disposeBoundsTree=function(){this.boundsTree=null},f.prototype.raycast=function(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;if(ye.getInverse(this.matrixWorld),me.copy(t.ray).applyMatrix4(ye),!0===t.firstHitOnly){const i=this.geometry.boundsTree.raycastFirst(this,t,me);i&&e.push(i)}else this.geometry.boundsTree.raycast(this,t,me,e)}else xe.call(this,t,e)};var ge=new i;d.prototype.updateMatrix=function(){var t=this.position,e=this.quaternion,i=this.scale;ge.copy(i),0===ge.x&&(ge.x=1e-10),0===ge.y&&(ge.y=1e-10),0===ge.z&&(ge.z=1e-10),this.matrix.compose(t,e,i)},d.prototype.updateMatrixWorld=function(t){this._inUpdateWorldMatrix||this.updateWorldMatrix(!1,!0,!0)},d.prototype.updateWorldMatrix=function(t,e,i){void 0===i&&(i=!0);var n=this.parent;!0===t&&null!==n&&n.updateWorldMatrix(!0,!1,!0),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);var o=this.children;if(!0===e)for(var r=0,s=o.length;r<s;r++)o[r].updateWorldMatrix(!1,!0,!1);if(!0===i){e&&this.layout.invalidateBounds(),this.layout.updateMatrix();var a=this.transitioner;a.matrixLocal.target.multiplyMatrices(this.layout.matrix,this.matrix);var u=a.active?a.matrixLocal.current:a.matrixLocal.target;if(null===n?(a.matrixWorldTarget.copy(a.matrixLocal.target),this.matrixWorld.copy(u)):(a.matrixWorldTarget.multiplyMatrices(n.transitioner.matrixWorldTarget,a.matrixLocal.target),this.matrixWorld.multiplyMatrices(n.matrixWorld,u)),!0===e)for(r=0,s=o.length;r<s;r++)o[r].updateWorldMatrix(!1,!0,!0)}this._inUpdateWorldMatrix=!0,this.updateMatrixWorld(),this._inUpdateWorldMatrix=!1},Object.defineProperty(d.prototype,"layout",{get:function(){if(this!==d.prototype)return Object.defineProperty(this,"layout",{value:new lt(this),writable:!0,enumerable:!0}),this.layout}}),Object.defineProperty(d.prototype,"transitioner",{get:function(){if(this!==d.prototype)return Object.defineProperty(this,"transitioner",{value:new Vt(this),writable:!0,enumerable:!0}),this.transitioner}});var ve=function(e){function i(){e.call(this),this._transitional=new d,this._transitionalBoxHelper=new t(this._transitional.layout.inner),this._target=new d,this._targetBoxHelper=new t(this._target.layout.inner),this.add(this._transitional),this._transitional.layout.innerAutoUpdate=!1,this._transitional.layout.forceBoundsExclusion=!0,this._transitional.add(this._transitionalBoxHelper),this._transitionalBoxHelper.layout.forceBoundsExclusion=!0,this.add(this._target),this._target.layout.innerAutoUpdate=!1,this._target.layout.forceBoundsExclusion=!0,this._target.add(this._targetBoxHelper),this._targetBoxHelper.layout.forceBoundsExclusion=!0,this._targetBoxHelper.material.color.setStyle("magenta")}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.updateWorldMatrix=function(t,i,n){e.prototype.updateWorldMatrix.call(this,t,i,n),this.parent&&(this._target.layout.inner.copy(this.parent.layout.computedInnerBounds),this._target.matrixWorld.copy(this.parent.transitioner.matrixWorldTarget),this._targetBoxHelper.updateMatrixWorld(),this._transitional.layout.inner.copy(this.parent.layout.computedInnerBounds),this._transitional.updateMatrixWorld())},i}(d),be=function(){},we=function(){};we.addBehavior=function(t,e){var i,n=t[we._getBehaviors]=t[we._getBehaviors]||[];(i="function"==typeof e?{object:t,update:e}:e).object=t,i.init&&i.init(),n.push(i)},we.getBehaviors=function(t){return t[we._getBehaviors]},we.update=function(t,e,i){we.currentScene=t,we.currentCamera=e,we.currentDeltaTime=i,t.updateWorldMatrix(!0,!0),we.ensureUpdate(e),t.traverse(we.ensureUpdate),we.currentScene=void 0,we.currentCamera=void 0,we.currentDeltaTime=void 0,Promise.resolve(t).then(we.clearUpdateFlag)},we.clearUpdateFlag=function(t){t.traverse(function(t){return t[we._didUpdate]=!1})},we.ensureUpdate=function(t){if(!we.currentScene)throw new Error("AdaptivityManager.ensureUpdate: must be called inside a Behavior callback");if(!t[we._didUpdate]){t[we._didUpdate]=!0,t.parent&&we.ensureUpdate(t.parent);var e=we.getBehaviors(t);if(Vt.disableAllTransitions=!0,e)for(var i=0,n=e;i<n.length;i+=1){var o=n[i];o.update&&(o.update(we.currentDeltaTime),t.updateWorldMatrix(!1,!0))}if(Vt.disableAllTransitions=!1,t.transitioner.update(we.currentDeltaTime,!1),e)for(var r=0,s=e;r<s.length;r+=1){var a=s[r];a.postUpdate&&(a.postUpdate(we.currentDeltaTime),t.updateWorldMatrix(!1,!0))}}},we._getBehaviors=Symbol("getBehaviors"),we._didUpdate=Symbol("didUpdate");var Fe=function(t){function e(){t.apply(this,arguments),this._boxA=new nt,this._boxB=new nt,this.occluders=[],this.occluderInfluenceDelay=.5,this.occlusionTime=new WeakMap}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.update=function(t){var e=at.get(we.currentCamera),i=this.object;i.layout.clip.makeEmpty(),i.updateWorldMatrix(!0,!0);var n=at.get(i),o=e.getDistanceOf(i),r=this._boxA.copy(i.layout.computedInnerBounds);r.min.z=-Infinity,r.max.z=Infinity;for(var s=i.layout.clip,a=0;a<this.occluders.length;a++){var u=this.occluders[a];if(e.getDistanceOf(u)>o)this.occlusionTime.set(u,0);else{we.ensureUpdate(u);var c=n.getBoundsOf(u,this._boxB);if(c.min.z=-Infinity,c.max.z=Infinity,r.intersectsBox(c)){var l=(this.occlusionTime.get(u)||0)+t;if(this.occlusionTime.set(u,l),!(l<this.occluderInfluenceDelay)){var h=c.getCenter(D.get());h.x>0&&(s.max.x=isFinite(s.max.x)?Math.min(c.min.x,s.max.x):c.min.x),h.x<0&&(s.min.x=isFinite(s.min.x)?Math.max(c.max.x,s.min.x):c.max.x),h.y>0&&(s.max.y=isFinite(s.max.y)?Math.min(c.min.y,s.max.y):c.min.y),h.y<0&&(s.min.y=isFinite(s.min.y)?Math.max(c.max.y,s.min.y):c.max.y)}}else this.occlusionTime.set(u,0)}}},e.prototype.postUpdate=function(){},e}(be);export{it as SimplifiedHull,nt as Box3,rt as VisualFrustum,at as SpatialMetrics,ct as LayoutFit,lt as Layout,Et as easing,St as TransitionTarget,Dt as Transitionable,Wt as LocalMatrixTransitionable,Vt as Transitioner,ve as LayoutHelper,be as Behavior,we as AdaptivityManager,Fe as AdaptiveClippingBehavior,M as V_00,z as V_11,B as V_000,C as V_100,P as V_010,I as V_001,A as V_111,j as Q_IDENTITY,O as Pool,S as vectors2,D as vectors,W as vectors4,V as quaternions,N as matrices3,U as matrices,G as traverse};
//# sourceMappingURL=ethereal.mjs.map
