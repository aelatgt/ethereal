var e=Object.assign;import"./dynamic-import-polyfill.b3685604.js";import{S as t,P as i,W as s,C as n,V as a,f as r,ak as o,O as c,n as d,al as l,j as h,ad as m,ac as p,m as u,M as y,am as g,T as v,an as w,ao as f,a5 as b,ap as x,aq as S,i as R,ar as T,as as P,at as A,au as E,av as O,aw as j,ax as C,ay as D,az as B,aA as q,aB as L,aC as N,aD as k,aE as M,aF as W,aG as z,aH as F,aI as I,aJ as H,aK as X,aL as V,aM as G,aN as U,aO as J,aP as Z}from"./vendor.1a9225bf.js";import{W as _,b as Y,Q as K,V as Q,c as $,e as ee}from"./mod.bbf9f12a.js";const te="-----BEGIN PGP MESSAGE-----\nVersion: OpenPGP.js v2.3.2\nComment: http://openpgpjs.org\n\n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\nTDne/ON+Rnj/EKokFOU=\n=kmoQ\n-----END PGP MESSAGE-----\n";function ie(e,t){void 0===t&&(t={});const i=void 0!==t.pixelRatio?t.pixelRatio:window.devicePixelRatio,s=void 0!==t.fontface?t.fontface:"Arial",n=(void 0!==t.fontsize?t.fontsize:18)*i,a=(void 0!==t.padding?t.padding:3)*i,r=(void 0!==t.borderThickness?t.borderThickness:2)*i,o=void 0!==t.borderColor?t.borderColor:"rgba(0,0,0,1)",c=void 0!==t.backgroundColor?t.backgroundColor:"rgba(255,255,255,1.0)",l=document.createElement("canvas"),h=l.getContext("2d");h.font="Bold "+n+"px "+s;const g=h.measureText(e).width+2*a,v=1.2*n+2*a;l.width=g+2*r,l.height=v+2*r,h.fillStyle=c,h.strokeStyle=o,h.lineWidth=r,function(e,t,i,s,n,a,r=!0,o=!0){void 0===o&&(o=!0);void 0===a&&(a=5);if("number"==typeof a)a={tl:a,tr:a,br:a,bl:a};else{const e={tl:0,tr:0,br:0,bl:0};for(const t of Object.keys(e))a[t]=a[t]||e[t]}e.beginPath(),e.moveTo(t+a.tl,i),e.lineTo(t+s-a.tr,i),e.quadraticCurveTo(t+s,i,t+s,i+a.tr),e.lineTo(t+s,i+n-a.br),e.quadraticCurveTo(t+s,i+n,t+s-a.br,i+n),e.lineTo(t+a.bl,i+n),e.quadraticCurveTo(t,i+n,t,i+n-a.bl),e.lineTo(t,i+a.tl),e.quadraticCurveTo(t,i,t+a.tl,i),e.closePath(),r&&e.fill();o&&e.stroke()}(h,r,r,l.width-2*r,l.height-2*r,5),h.font="Bold "+n+"px "+s,h.fillStyle="rgba(0, 0, 0, 1.0)",h.textAlign="center",h.textBaseline="top",h.fillText(e,l.width/2,r+a,l.width);const w=new m(l);w.minFilter=p,w.needsUpdate=!0;const f=new u(.001*l.width,.001*l.height,2,2),b=new d({map:w,alphaTest:.5});return new y(f,b)}const se=g(e({},v));class ne{constructor(e){this.app=e,this.snubberObject=new c,this._snubberRoot=new c,this.grid=new w(1,10),this.lineMaterial=new f({color:16753920,depthTest:!1}),this._scratchMatrix=new b,this.annotations=[{text:"TEST",anchorPoint:[0,0,0]},{text:"Part A",anchorPoint:[-.18,.06,.09]},{text:"Part B",anchorPoint:[.05,.05,.12]},{text:"Part C",anchorPoint:[-.1,.05,.11]},{text:"Part D",anchorPoint:[.14,-.22,-.06]},{text:"Part E",anchorPoint:[.11,0,.1]},{text:"Part F",anchorPoint:[-.06,-.04,.02]}],this.annotationState=new Map,this.stlLoader=new se,this.physicsWorld=new x.World,this.CENTRAL_REPULSION_FORCE=20,this.VIEW_DEPENDENT_REPULSION_FORCE=40,this.ANNOTATION_REPULSION_FACTOR=.4,this.VIEW_DEPENDENT_ANNOTATION_REPULSION_FACTOR=.5,this._force=new x.Vec3,this._cameraWorldPosition=new h,this._directionA=new h,this._directionB=new h,this.snubberTargetPosition=new h,this.snubberObject.add(this._snubberRoot),this._snubberRoot.quaternion.setFromAxisAngle(new h(0,0,1),Math.PI),this._snubberRoot.scale.setScalar(.01),this.snubberObject.name="snubber",this.snubberMeshPromise=new Promise((e=>{this.stlLoader.load("./static/fullSnubberSimplified.stl",(t=>{t.computeBoundsTree();const i=new S,s=new y(t,i);this.snubberMesh=s,this.snubberMesh.scale.setScalar(.01),this._snubberRoot.add(s),e(s)}))}));for(const t of this.annotations){const e=new c,i=ie(t.text,{pixelRatio:window.devicePixelRatio/2});e.add(i);const s=new c;s.position.set(...t.anchorPoint),s.add(new y(new R(.005))),this._snubberRoot.add(s);const n=i.material.map.image,a=new x.Body({mass:0,position:new x.Vec3(0,0,0).set(...t.anchorPoint)});a.collisionResponse=!1;const r=new x.Body({mass:1,position:new x.Vec3(0,0,0).set(...t.anchorPoint),shape:new x.Box(new x.Vec3(.01*n.width,.01*n.height,1)),linearDamping:1,angularDamping:1});r.collisionResponse=!1,this.physicsWorld.addBody(a),this.physicsWorld.addBody(r);const o=new x.Spring(a,r,{restLength:.15,stiffness:200,damping:1}),d=new T;d.vertices.push(new h),d.vertices.push(new h);const l=new f({color:16777215*Math.random(),linewidth:3}),m=new P(d,l);l.depthWrite=!1,m.frustumCulled=!1,this.app.scene.add(m);const p=new T;p.vertices.push(new h),p.vertices.push(new h);const u=l.clone(),g=new P(p,u);u.depthWrite=!0,g.frustumCulled=!1,this.app.scene.add(g),this.annotationState.set(t,{spring:o,anchorBody:a,annotationBody:r,anchorObject:s,contentObject:i,annotationObject:e,lineDepthWriting:g,line:m})}this.initDefault()}initDefault(){this.snubberTargetPosition.set(0,0,-1)}async enterXR(e){const{session:t,vuforia:i}=this.app;if(!t||!i)return void this.initDefault();t&&t.addEventListener("end",(()=>{this.initDefault()}));const s=await i.fetchDataSet("/Treadmill.xml"),n=(await i.loadDataSet(s)).get("treadmill");this.treadmillAnchorObject=this.app.getXRObject3D(n),this.snubberTargetPosition.set(.033,-.062,.018);const a=n.size,r=new y(new A(a.x,a.y,.001),new E({color:"#DDFFDD",opacity:.5,transparent:!0}));r.visible=!1,this.treadmillAnchorObject.add(r);const o=new c;o.add(this.snubberObject),o.scale.setScalar(a.y/2),this.treadmillAnchorObject.add(o),i.activateDataSet(s)}update(e){}}const ae="https://prideview-ar.traclabs.com:8025/AR_server/",re={json:"",procedure:"Treadmill Monthly Maintenance",step:"",instruction:"test",image:"",video:"/armWiggleDemonstrated.mov",elementType:"",elementSubType:"",objects:{}};async function oe(e="none"){return(await fetch(ae+"ARready",{mode:"cors",method:"POST",body:JSON.stringify({action:"done",value:e})})).json()}var ce={data:re,get:async function e(){const t=await fetch(ae+"ARready",{mode:"cors"}).catch(),i=await t.json().catch(),s=i&&i.procedureElementInfo&&i.procedureElementInfo.steplist;if(!s)return await e();if("continue procedure"===i.text)return await oe(),await e();re.json=i,re.step=s[s.length-1].title,re.instruction=i.text,re.elementType=i.procedureElementInfo.elementType,re.elementSubType=i.procedureElementInfo.elementData[re.elementType.toLowerCase()+"Type"];const n=Object.keys(i).filter((e=>e.toLowerCase().includes("object")));for(const a of n){const e=i[a],t=e.properties.realityaugmentation;if(!t)continue;const s=re.objects[e.name]={},n=t.split(";");for(const i of n){if(!i)continue;let[e,t]=i.split(":");if(e=e.trim(),t=t.trim(),"position"===e||"rotation"===e||"size"===e){const[i,n,a]=t.split(" ").map((e=>parseFloat(e)));s[e]={x:i,y:n,z:a}}else s[e]=isNaN(t)?t:parseFloat(t)}}return i},getText:async function(){return(await fetch(ae+"ARready",{mode:"cors"})).text()},done:oe,startProcedure:async function(e){return(await fetch(ae+"ARready",{mode:"cors",method:"POST",body:JSON.stringify({action:e})})).json()},back:async function(){return(await fetch(ae+"ARready",{mode:"cors",method:"POST",body:JSON.stringify({action:"back",value:"none"})})).json()},skip:async function(){return(await fetch(ae+"ARready",{mode:"cors",method:"POST",body:JSON.stringify({action:"skip",value:"none"})})).json()},comment:async function(e){return(await fetch(ae+"ARready",{mode:"cors",method:"POST",body:JSON.stringify({action:"comment",value:e})})).json()}};class de{constructor(){this.logo="./static/pride-view.png",this.pride=ce.data,this.immersiveMode=!1}async getPrideData(){await ce.get(),this.pride=ce.data}start(){return setInterval((()=>{this.getPrideData()}),5e3),this}}const le=Symbol("state");const he=D({setup:()=>O(C(le))}),me=W("data-v-4c35fc1c");z("data-v-4c35fc1c");const pe={"xr-layer":"",id:"procedure"},ue={id:"step","xr-layer":""},ye=L("Step: "),ge={id:"type"},ve={"xr-layer":"",id:"content"},we={id:"instruction","xr-layer":""},fe={"xr-layer":"","xr-pixel-ratio":"0.5",id:"media"},be=q("div",{"xr-layer":"",id:"model","xr-pixel-ratio":"0.5"},null,-1),xe={id:"controls"},Se=q("div",{"xr-layer":"",class:"button",id:"back"},"Back",-1),Re={"xr-layer":"",class:"button",id:"done"},Te={"xr-layer":"",class:"button",id:"yes"},Pe={"xr-layer":"",class:"button",id:"no"},Ae={"xr-layer":"",class:"button",id:"no"},Ee={"xr-layer":"",class:"button",id:"immersive-toggle"};F();const Oe=me(((e,t,i,s,n,a)=>(I(),B("div",{id:"pride","xr-pixel-ratio":"1",class:{xr:e.immersiveMode}},[q("div",pe,[q("img",{"xr-layer":"",class:"logo",src:e.logo},null,8,["src"]),L("Procedure: "+N(e.pride.procedure),1)]),q("div",ue,[ye,q("span",ge,N(e.pride.elementSubType),1),L(" "+N(e.pride.step),1)]),q("div",ve,[q("div",we,N(e.pride.instruction),1),q("div",fe,[k(q("video",{"xr-layer":"",id:"video",loop:"","webkit-playsinline":"",playsinline:"true",crossorigin:"anonymous",muted:"",src:e.pride.video},null,8,["src"]),[[M,e.pride.video]]),k(q("img",{"xr-layer":"",id:"image",crossorigin:"anonymous",src:e.pride.image},null,8,["src"]),[[M,e.pride.image]])]),be]),q("div",xe,[Se,k(q("div",Re,"Done",512),[[M,["ManualInstruction","ClarifyingInfo","VerifyInstruction"].indexOf(e.pride.elementSubType)>-1]]),k(q("div",Te,"Yes",512),[[M,"Conditional"===e.pride.elementSubType]]),k(q("div",Pe,"No",512),[[M,"Conditional"===e.pride.elementSubType]]),k(q("div",Ae,"Record",512),[[M,"Bla"===e.pride.elementSubType]]),q("div",Ee,[q("b",null,N(e.immersiveMode?"Flat":"Immersive"),1)])])],2))));he.render=Oe,he.__scopeId="data-v-4c35fc1c";class je{constructor(e,t){this.app=e,this.treadmill=t,this.augmentations={},this.state=j(new de).start(),this.prideVue=H(he).provide(le,this.state).mount(document.createElement("div")),this.pride=this.app.createWebLayerTree(this.prideVue.$el,{layerSeparation:.002,onLayerCreate:e=>{const t=this.app.system.getAdapter(e);t.transition.duration=1,t.transition.maxWait=10,t.onUpdate=()=>{e.update()}}}),this.procedure=this.pride.querySelector("#procedure"),this.step=this.pride.querySelector("#step"),this.instruction=this.pride.querySelector("#instruction"),this.content=this.pride.querySelector("#content"),this.media=this.pride.querySelector("#media"),this.image=this.pride.querySelector("#image"),this.video=this.pride.querySelector("#video"),this.model=this.pride.querySelector("#model"),this.controls=this.pride.querySelector("#controls"),this.backButton=this.pride.querySelector("#back"),this.doneButton=this.pride.querySelector("#done"),this.yesButton=this.pride.querySelector("#yes"),this.noButton=this.pride.querySelector("#no"),this.immersiveButton=this.pride.querySelector("#immersive-toggle"),this.immersiveAnchor=new c,this.box=new X(this.pride);(()=>{this.app.scene.add(this.immersiveAnchor);const e=this.app.system.getAdapter(this.immersiveAnchor),t=new h;e.onUpdate=()=>{t.set(0,this.app.xrPresenting?1.6:0,this.app.xrPresenting?-.7:-1.4),e.bounds.target.setFromCenterAndSize(t,Y)}})(),(()=>{const e=this.app.system.getAdapter(this.pride),t=e.createLayout().attachedTo(this.app.scene).localPosition({x:0,y:0,z:-1}).localScale(Y).localOrientation(K),i=e.createLayout().attachedTo(this.app.camera).localOrientation(K).preserveAspect("visual").visualBounds({back:{lt:"-1m"},size:{y:"100 vh"},center:{x:"0 vdeg",y:"0 vdeg"}});this.app.camera.add(this.pride),e.onUpdate=()=>{this.pride.options.autoRefresh=this.app.timeSinceLastResize>100,this.pride.update(),this.state.immersiveMode?e.layouts=[t]:e.layouts=[i]},setTimeout((()=>this.video.element.play()),5e3)})(),(()=>{const t=this.treadmill.snubberObject;this.model.add(t);const i=e.system.getAdapter(t);i.transition.duration=1,i.transition.maxWait=10;const s=i.createLayout();s.attachedTo(this.model).localOrientation(K).preserveAspect("visual").visualBounds({back:{gt:"0.1m"},left:{gt:"10px"},right:{lt:"-10px"},bottom:{gt:"10px"},top:{lt:"-10px"},size:{diagonal:{gt:"10vdeg"}}}).visualForce({}).visualMaximize({relativeTolerance:.5});const n=i.createLayout().attachedTo(this.app.scene).spatialOrientation({swingRange:{x:"10deg",y:"10deg"},twistRange:"10deg"}).spatialBounds({size:{diagonal:"0.2m"}}).visualBounds({center:{x:"0",y:"0"},size:{y:"50vh"}});n.visualAccuracy="30px";const a=[n,i.createLayout().attachedTo(this.treadmill.treadmillAnchorObject).localPosition(Q).localOrientation(K).localScale(Y)],r=[s];i.onUpdate=()=>{this.state.immersiveMode?i.layouts=a:i.layouts=r},i.onPostUpdate=()=>{this.state.immersiveMode&&i.hasValidContext&&(i.layouts=[])}})(),this.backButton.element.addEventListener("click",(async()=>{await ce.back(),ce.get()})),this.doneButton.element.addEventListener("click",(async()=>{await ce.done(),ce.get()})),this.yesButton.element.addEventListener("click",(async()=>{await ce.done("yes"),ce.get()})),this.noButton.element.addEventListener("click",(async()=>{await ce.done("no"),ce.get()})),this.immersiveButton.element.addEventListener("click",(async()=>{this.state.immersiveMode=!this.state.immersiveMode,this.state.immersiveMode&&this.app.enterXR()}))}updateAugmentations(){const e=ce.data.objects;for(const t in e){const i=e[t];let s=this.augmentations[t];if(!s){switch(i.type){case"box":const e=i.size;s=new y(new A(.01*e.x,.01*e.y,.01*e.z));break;case"sphere":s=new y(new R(.01*i.radius));break;default:s=new c}this.augmentations[t]=s}s.position.copy(i.position).multiplyScalar(.01),s.rotation.x=i.rotation.x*V.DEG2RAD,s.rotation.y=i.rotation.y*V.DEG2RAD,s.rotation.z=i.rotation.z*V.DEG2RAD}}update(e){}}G.prototype.computeBoundsTree=U,G.prototype.disposeBoundsTree=J,y.prototype.raycast=Z;const Ce=new class extends class{constructor(e){this._config=e,this.scene=new t,this.camera=new i,this.renderer=new s({desynchronized:!0,antialias:!1,alpha:!0}),this.clock=new n,this.pointer=new a,this.raycaster=new r,this.mouseRay=[this.raycaster.ray],this.immersiveRays=new Set,this.interactionRays=[],this.xrObjects=new Map,this.webLayers=new Set,this.onAnimate=()=>{const e=this.renderer.domElement;this.xrPresenting||this._setSize(e.clientWidth,e.clientHeight,window.devicePixelRatio);const t=Math.min(this.clock.getDelta(),1/60);this.update(t),this.renderer.render(this.scene,this.camera)},this._wasPresenting=!1,this.update=e=>{if(this.interactionRays.length=0,"world"===this.interactionSpace)for(const t of this.immersiveRays)this.interactionRays.push(t);else for(const t of this.mouseRay)this.interactionRays.push(t);if(this.xrPresenting){this.renderer.setClearColor(new o("blue")),this.renderer.setClearColor(new o("white"),0),this._wasPresenting=!0;const e=this.renderer.xr.getCamera(this.camera);this.camera.matrix.copy(e.matrix),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.projectionMatrix.copy(e.projectionMatrix),this.camera.projectionMatrixInverse.getInverse(this.camera.projectionMatrix),this.camera.updateWorldMatrix(!0,!0)}else{this.renderer.setClearColor(new o("white")),this._wasPresenting&&(this._wasPresenting=!1,this._exitXR(),this.interactionSpace="screen");const e=this.renderer.domElement,t=e.clientWidth/e.clientHeight;this.camera.aspect=t,this.camera.near=.001,this.camera.far=1e5,this.camera.updateProjectionMatrix()}if(this.session)for(const t of this.xrObjects.values()){const e=t.xrCoordinateSystem,i=e.getTransformTo(this.frameOfReference);i?(t.matrixAutoUpdate=!1,t.matrix.fromArray(i),t.updateMatrixWorld(!0),t.parent!==this.scene&&(this.scene.add(t),console.log("added xrObject "+e.uid||""))):t.parent&&(this.scene.remove(t),console.log("removed xrObject "+e.uid||""))}this.raycaster.setFromCamera(this.pointer,this.camera),this._config.onUpdate({type:"update",deltaTime:e,elapsedTime:this.clock.elapsedTime})},this.interactionSpace="screen",this.lastResize=-1/0,this.lastWidth=window.innerWidth,this.lastHeight=window.innerHeight,this.timeSinceLastResize=1/0,this.scene.add(this.camera);const c=this.renderer;document.documentElement.append(this.renderer.domElement),c.domElement.style.position="fixed",c.domElement.style.width="100%",c.domElement.style.height="100%",c.domElement.style.top="0",c.domElement.addEventListener("mousemove",(function(e){m(e.clientX,e.clientY)})),c.domElement.addEventListener("touchmove",(function(e){e.preventDefault(),m(e.touches[0].clientX,e.touches[0].clientY)}),{passive:!1}),c.domElement.addEventListener("touchstart",(function(e){m(e.touches[0].clientX,e.touches[0].clientY),p(e)}),{passive:!1}),c.domElement.addEventListener("touchend",(function(e){setTimeout((()=>m(-1/0,-1/0)),10)}),{passive:!1}),c.domElement.addEventListener("click",(function(e){p(e)}),!1),c.setAnimationLoop(this.onAnimate),window.addEventListener("vrdisplaypresentchange",(e=>{setTimeout((()=>{this.xrPresenting||this._exitXR()}))}),!1),document.documentElement.style.width="100%",document.documentElement.style.height="100%";const m=(e,t)=>{this.pointer.x=(e+window.pageXOffset)/document.documentElement.offsetWidth*2-1,this.pointer.y=-(t+window.pageYOffset)/document.documentElement.offsetHeight*2+1};const p=e=>{for(const t of this.webLayers){const i=t.hitTest(this.raycaster.ray);i&&(i.target.dispatchEvent(new e.constructor(e.type,e)),i.target.focus(),console.log("hit",i.target,i.layer))}},u=e=>{const t=14365238,i=new d({color:t}),s=c.xr.getController(e);this.scene.add(s),s.addEventListener("selectstart",(e=>{i.color.setHex(16040461),r()})),s.addEventListener("selectend",(e=>{i.color.setHex(t)})),s.add(new l(1)),this.immersiveRays.add(s);const n=new h,a=new h,r=()=>{s.getWorldPosition(n),s.getWorldDirection(a),this.raycaster.ray.set(n,a);for(const e of this.webLayers){const t=e.hitTest(this.raycaster.ray);t&&(t.target.click(),t.target.focus())}}};u(0),u(1)}createWebLayerTree(e,t){const i=new _(e,t);return i.interactionRays=this.interactionRays,this.webLayers.add(i),i}getXRObject3D(e){let t=this.xrObjects.get(e);return t||(t=new c,t.xrCoordinateSystem=e,this.xrObjects.set(e,t),t)}async start(){return this.enterXR().catch((()=>{console.log("Enter XR failed"),this.renderer.domElement.style.backgroundColor="lightgrey"}))}get xrPresenting(){return this.renderer.xr.isPresenting}async enterXR(){if(this.xrPresenting)return;if(!navigator.xr)throw new Error("WebXR is not supported by this browser");const e="local";this.renderer.xr.setReferenceSpaceType(e);const t=async t=>{if(console.log("GOT XR SESSION"),this.session&&this.session.end(),this.session=t,navigator.userAgent.includes("Argon")){const e=t.requestAnimationFrame;t.requestAnimationFrame=i=>{e.call(t,(e=>{i(performance.now(),e)}))}}else this.interactionSpace="world";try{this.renderer.vr.setSession(t)}catch(i){}if(this.frameOfReference=await t.requestReferenceSpace(e),t.addEventListener("end",(()=>{this.session=void 0,this.frameOfReference=void 0,this.renderer.vr.setSession(null),this._exitXR()})),t.requestTracker)try{this.vuforia=await t.requestTracker("ARGON_vuforia",{encryptedLicenseData:te})}catch(i){}this._enterXR()};if(navigator.xr.requestSession){var i={optionalFeatures:["local-floor","bounded-floor"]};return await navigator.xr.isSessionSupported("immersive-ar",i)?(console.log("AR supported, trying AR"),navigator.xr.requestSession("immersive-ar",i).then(t)):(console.log("AR not supported, trying VR"),navigator.xr.requestSession("immersive-vr",i).then(t))}}_enterXR(){this.renderer.xr.enabled=!0,this._config.onEnterXR({type:"enterxr"})}_exitXR(){this._config.onExitXR({type:"exitxr"}),this.camera.position.set(0,0,0),this.camera.quaternion.set(0,0,0,1),this.interactionSpace="screen",this.renderer.xr.enabled=!1}_setSize(e,t,i=1){e===this.lastWidth&&t===this.lastHeight||(this.lastWidth=e,this.lastHeight=t,this.lastResize=performance.now()),this.timeSinceLastResize=performance.now()-this.lastResize,this.timeSinceLastResize>2e3&&(this.renderer.setSize(e,t,!1),this.renderer.setPixelRatio(i))}}{constructor(){super(...arguments),this.pride=ce,this.system=$(this.camera),this.treadmill=new ne(this),this.ui=new je(this,this.treadmill),this.ethereal=ee}}({onUpdate:e=>{Ce.system.viewFrustum.setFromPerspectiveProjectionMatrix(Ce.camera.projectionMatrix),Ce.renderer.getSize(Ce.system.viewResolution),Ce.system.update(e.deltaTime,e.elapsedTime),Ce.treadmill.update(e),Ce.ui.update(e)},onEnterXR:e=>{Ce.treadmill.enterXR(e)},onExitXR:e=>{Ce.ui.state.immersiveMode=!1}});Ce.start().catch((e=>{console.log(e.stack),alert(e)})),Object.assign(window,{THREE:v,app:Ce});
