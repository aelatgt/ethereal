var yo=Object.defineProperty,vo=Object.defineProperties;var wo=Object.getOwnPropertyDescriptors;var ni=Object.getOwnPropertySymbols;var bo=Object.prototype.hasOwnProperty,_o=Object.prototype.propertyIsEnumerable;var On=(n,e,t)=>e in n?yo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Z=(n,e)=>{for(var t in e||(e={}))bo.call(e,t)&&On(n,t,e[t]);if(ni)for(var t of ni(e))_o.call(e,t)&&On(n,t,e[t]);return n},Ln=(n,e)=>vo(n,wo(e));var c=(n,e,t)=>(On(n,typeof e!="symbol"?e+"":e,t),t);import{w as ae,x as B,y as G,z as F,F as ee,H as lt,J as ri,K as Q,U as j,X as zn,Y as xo,Z as So,_ as To,$ as Eo,a0 as Mo,a1 as Ao,a2 as Ro,a3 as Bo,a4 as Co,a5 as Io,a6 as Do,a7 as Oo,a8 as Lo,a9 as zo,aa as ko,ab as Po,ac as No,ad as Uo,ae as Gt,af as Fo,m as Qt,ag as Vo,O as $t,q as jo,ah as Ko,ai as qt,aj as ii,M as si,r as oi,n as Wo,ak as Ho,al as Go,am as Qo,an as $o,i as qo}from"./vendor.js";const Yo=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}};Yo();const ai=Object.freeze(new ae(0,0)),Xo=Object.freeze(new ae(1,1)),ue=Object.freeze(new B(0,0,0)),Jo=Object.freeze(new B(1,0,0)),Zo=Object.freeze(new B(0,1,0)),ea=Object.freeze(new B(0,0,1)),kn=Object.freeze(new B(1,1,1)),Pn=Object.freeze(new G),ht={RIGHT:Object.freeze(new B(1,0,0)),UP:Object.freeze(new B(0,1,0)),NEAR:Object.freeze(new B(0,0,1)),LEFT:Object.freeze(new B(-1,0,0)),DOWN:Object.freeze(new B(0,-1,0)),FAR:Object.freeze(new B(0,0,-1))};function Nn(n,e){return typeof n=="number"?ta(n,e):"isVector3"in n?na(n,e):"isVector2"in n?ra(n,e):"isBox3"in n?ia(n,e):"isQuaternion"in n?sa(n,e):"isColor"in n?oa(n,e):1/0}function ta(n,e){if(e===n)return 0;const t=Math.abs(e-n),r=(Math.abs(e)+Math.abs(n))/2;return t/r}function na(n,e){if(e.equals(n))return 0;const t=e.distanceTo(n),r=(e.length()+n.length())/2;return t/r}function ra(n,e){if(e.equals(n))return 0;const t=e.distanceTo(n),r=(e.length()+n.length())/2;return t/r}function ia(n,e){if(n.equals(e))return 0;const t=ui,r=e.min.distanceTo(n.min),i=e.max.distanceTo(n.max),s=(r+i)/2,o=(e.getSize(t).length()+n.getSize(t).length())/2;return s/o}const ui=new B;function sa(n,e){return n.equals(e)?0:n.angleTo(e)/Math.PI}function oa(n,e){return n.equals(e)?0:ui.set(Math.abs(e.r-n.r),Math.abs(e.g-n.g),Math.abs(e.b-n.b)).length()/aa}const aa=Math.sqrt(3),ft=(n=1)=>{var e=Math.random();return(e%1e-8>5e-9?1:-1)*Math.sqrt(-Math.log(Math.max(1e-9,e)))*n},Un=(n=1)=>{const e=Math.sqrt(Math.sqrt(1/(2*n)));return 1/ft(e)**2},Yt=(()=>{const n=Math.PI*2,e=new B(0,0,1),t=new G,r=new G,i=new B,s=new G;return function(a=1,u=1){var l=(Math.random()-.5)*n*a,p=Math.random()*n,g=Math.random()*Math.PI*u;return i.set(1,0,0).applyAxisAngle(e,p),t.setFromAxisAngle(e,l),r.setFromAxisAngle(i,g),s.multiplyQuaternions(r,t)}})();function ci(n,e){let t=0;for(let i=0;i<n.length;i++)t+=(e==null?void 0:e[i])||1;const r=Math.random()*t;t=0;for(let i=0;i<n.length;i++)if(t+=(e==null?void 0:e[i])||1,t>r)return n[i];return n[0]}const ua=(()=>{const n=new B;return function(t,r,i){const s=n.set(t.x,t.y,t.z),o=r.dot(s),a=n.copy(r).multiplyScalar(o),u=i.set(a.x,a.y,a.z,t.w).normalize();return o<0&&(u.x=-u.x,u.y=-u.y,u.z=-u.z,u.w=-u.w),u}})();class Xt{constructor(){c(this,"callbacks",[])}memoize(e,...t){t.push(this);const r=ca(e);for(const i of t)i.callbacks.push(r);return r}invalidateAll(){const e=this.callbacks;for(let t=0;t<this.callbacks.length;t++)e[t].needsUpdate=!0}isFullyInvalid(){const e=this.callbacks;for(let t=0;t<this.callbacks.length;t++)if(!e[t].needsUpdate)return!1;return!0}}const li=void 0;function ca(n){let e=li;const t=()=>{if(t.needsUpdate&&(t.needsUpdate=!1,e=n()),e===li)throw new Error("Possible recursive memoization detected");return e};return t.needsUpdate=!0,t}const Jt=Symbol("current"),Zt=Symbol("target"),hi=Symbol("previousTarget");class fi{constructor(e,t){this.mode=e,this.metrics=t}}const ut=class extends fi{constructor(e,t){super(e,t);c(this,"_cache",new Xt);c(this,"opacity",1);c(this,"_parent",null);c(this,"_localMatrix",new F);c(this,"_worldMatrix",new F);c(this,"_worldMatrixInverse",new F);c(this,"_worldPosition",new B);c(this,"_worldOrientation",new G);c(this,"_worldOrientationInverse",new G);c(this,"_worldScale",new B(1,1,1));c(this,"_worldRotation",new F);c(this,"_worldRotationInverse",new F);c(this,"_relativePosition",new B);c(this,"_relativeOrientation",new G);c(this,"_relativeScale",new B(1,1,1));c(this,"_cachedWorldCenter",this._cache.memoize(()=>this._worldCenter.copy(this.metrics.innerCenter).applyMatrix4(this.worldMatrix)));c(this,"_worldCenter",new B);c(this,"_cachedSpatialMatrix",this._cache.memoize(()=>{const e=this._worldFromSpatial.compose(this.outerOrigin,this.worldOrientation,kn);this._spatialFromWorld.copy(this._worldFromSpatial).invert(),this._localFromSpatial.multiplyMatrices(this.worldMatrixInverse,e),this._spatialFromLocal.copy(this._localFromSpatial).invert();const t=this.referenceState;return t?this._spatialFromReference.multiplyMatrices(this._spatialFromWorld,t.worldMatrix):this._spatialFromReference.copy(this._spatialFromWorld),e}));c(this,"_worldFromSpatial",new F);c(this,"_spatialFromWorld",new F);c(this,"_localFromSpatial",new F);c(this,"_spatialFromLocal",new F);c(this,"_spatialFromReference",new F);c(this,"_cachedSpatialBounds",this._cache.memoize(()=>{this._spatialBounds.copy(this.metrics.innerBounds);const e=this._spatialBounds.applyMatrix4(this.spatialFromLocal);return e.getCenter(this._spatialCenter),e.getSize(this._spatialSize),e}));c(this,"_spatialBounds",new ee);c(this,"_spatialSize",new B);c(this,"_spatialCenter",new B);c(this,"_cachedOuterBounds",this._cache.memoize(()=>{const e=this._outerBounds,t=this.metrics.system.nodeAdapters.get(this.metrics.node);if(t)e.copy(t.outerBounds[this.mode]);else{const r=this.referenceState;r?e.copy(r.metrics.innerBounds):e.setFromCenterAndSize(ue,ue),e.applyMatrix4(this.spatialFromReference)}return e.getCenter(this._outerCenter),e.getSize(this._outerSize),e}));c(this,"_outerBounds",new ee);c(this,"_outerCenter",new B);c(this,"_outerSize",new B);c(this,"_cachedOuterVisualBounds",this._cache.memoize(()=>{const e=this._outerVisualBounds,t=this.metrics.system.nodeAdapters.get(this.metrics.node);if(t)e.copy(t.outerVisualBounds[this.mode]);else{const r=this.referenceState;r?e.copy(r.visualBounds):e.setFromCenterAndSize(ue,ue)}return e.getCenter(this._outerVisualCenter),e.getSize(this._outerVisualSize),e}));c(this,"_outerVisualBounds",new ee);c(this,"_outerVisualCenter",new B);c(this,"_outerVisualSize",new B);c(this,"_viewFromWorld",new F);c(this,"_viewFromSpatial",new F);c(this,"_spatialFromView",new F);c(this,"_cachedNDCBounds",this._cache.memoize(()=>{if(this.metrics.system.viewNode===this.metrics.node)return this._ndcBounds.min.setScalar(-1),this._ndcBounds.max.setScalar(1),this._ndcBounds;const t=this.metrics.system.viewFrustum.perspectiveProjectionMatrix,r=this.viewFromWorld,i=this._viewProjectionFromWorld.multiplyMatrices(t,r),s=this._ndcBounds.copy(this.metrics.innerBounds).applyMatrix4(i);return s.getCenter(this._ndcCenter),s.getSize(this._ndcSize),(!isFinite(s.min.x)||!isFinite(s.min.y)||!isFinite(s.min.z)||!isFinite(s.max.x)||!isFinite(s.max.y)||!isFinite(s.max.z))&&(s.min.setScalar(-1),s.max.setScalar(1),s.getCenter(this._ndcCenter),s.getSize(this._ndcSize)),s},this._viewState._cache));c(this,"_viewProjectionFromWorld",new F);c(this,"_ndcBounds",new ee);c(this,"_ndcCenter",new B);c(this,"_ndcSize",new B);c(this,"_cachedVisualBounds",this._cache.memoize(()=>{const e=this.metrics.system,t=e.viewFrustum.perspectiveProjectionMatrix,r=this._inverseProjection.copy(t).invert(),i=this._visualBounds.copy(this.ndcBounds),s=this._v1,o=s.set(0,0,i.min.z).applyMatrix4(r).z,a=s.set(0,0,i.max.z).applyMatrix4(r).z;return i.min.z=a,i.max.z=o,i.min.x*=.5*e.viewResolution.x,i.max.x*=.5*e.viewResolution.x,i.min.y*=.5*e.viewResolution.y,i.max.y*=.5*e.viewResolution.y,i.getCenter(this._visualCenter),i.getSize(this._visualSize),i},this._viewState._cache));c(this,"_visualBounds",new ee);c(this,"_visualCenter",new B);c(this,"_visualSize",new B);c(this,"_v1",new B);c(this,"_inverseProjection",new F);c(this,"_viewPosition",new B);c(this,"_cachedViewAlignedOrientation",this._cache.memoize(()=>{const e=this._relativeViewMatrix.multiplyMatrices(this.worldMatrixInverse,this._viewState.worldMatrix),t=this._relativeViewRotation.extractRotation(e),r=this._relativeViewOrientation.setFromRotationMatrix(t),i=this._relativeViewForward.set(0,0,1).applyQuaternion(r),s=this._relativeViewUp.set(0,1,0).applyQuaternion(r);let o=1/0,a=1/0,u,l,p;for(p in ht){const h=ht[p];var g=s.distanceToSquared(h);g<a&&(a=g,l=h)}for(p in ht){const h=ht[p];if(h.x&&l.x||h.y&&l.y||h.z&&l.z)continue;const d=i.distanceToSquared(h);d<o&&(o=d,u=h)}const f=this._orthogonalRotation.identity();return f.lookAt(u,ue,l),this._orthogonalOrientation.setFromRotationMatrix(f)},this._viewState._cache));c(this,"_relativeViewMatrix",new F);c(this,"_relativeViewRotation",new F);c(this,"_relativeViewOrientation",new G);c(this,"_relativeViewUp",new B);c(this,"_relativeViewForward",new B);c(this,"_orthogonalRotation",new F);c(this,"_orthogonalOrientation",new G);c(this,"_computeOcclusion",this._cache.memoize(()=>{this._occludingPercent=0,this._occludedPercent=0;const e=this.metrics;if(e.innerBounds.isEmpty())return;const r=e.system.nodeAdapters.values(),i=this.visualBounds,s=i.min.z,o=ut._boxA,a=ut._boxB;o.min.set(i.min.x,i.min.y),o.min.set(i.max.x,i.max.y);const u=o.getSize(ut._sizeA).length();for(const l of r){const p=l.metrics;if(p===e||!p.isAdaptive||p.innerBounds.isEmpty()||p.containedByNode(l.node))continue;const f=(this.mode==="current"?p.current:p.target).visualBounds;o.min.set(i.min.x,i.min.y),o.min.set(i.max.x,i.max.y),a.min.set(f.min.x,f.min.y),a.min.set(f.max.x,f.max.y);const h=o.intersect(a).getSize(ut._sizeB).length()/u;h>0&&(s<f.min.z?this._occludingPercent+=h:this._occludedPercent+=h)}},this._viewState._cache));c(this,"_occludingPercent",0);c(this,"_occludedPercent",0)}invalidate(){this._cache.invalidateAll()}get parent(){return this._parent}set parent(e){this._parent!==e&&(this._parent=e,this.invalidate())}get parentState(){var e;return(e=this.metrics.parentMetrics)==null?void 0:e[this.mode]}get localMatrix(){var t;const e=(t=this.parentState)==null?void 0:t.worldMatrixInverse;return e?this._localMatrix.multiplyMatrices(e,this.worldMatrix):this._localMatrix.copy(this.worldMatrix)}get referenceState(){var e;return(e=this.metrics.referenceMetrics)==null?void 0:e[this.mode]}get worldMatrix(){return this._worldMatrix}set worldMatrix(e){if(isNaN(e.elements[0])||isNaN(e.elements[15])||e.elements[0]===0)throw new Error;this._worldMatrix.equals(e)||(this.invalidate(),this._worldMatrix.copy(e),this._worldMatrixInverse.copy(this._worldMatrix).invert(),this._worldMatrix.decompose(this._worldPosition,this._worldOrientation,this._worldScale),this._worldOrientationInverse.copy(this._worldOrientation).invert(),this._worldRotation.makeRotationFromQuaternion(this._worldOrientation),this._worldRotationInverse.makeRotationFromQuaternion(this._worldOrientationInverse))}get relativePosition(){var t;const e=(t=this.referenceState)==null?void 0:t.worldPosition;return e?this._relativePosition.subVectors(this.worldPosition,e):this._relativePosition.copy(this.worldPosition)}get relativeOrientation(){var t;const e=(t=this.referenceState)==null?void 0:t.worldOrientationInverse;return e?this._relativeOrientation.multiplyQuaternions(this.worldOrientation,e):this._relativeOrientation.copy(this.worldOrientation)}get relativeScale(){var t;const e=(t=this.referenceState)==null?void 0:t.worldScale;return e?this._relativeScale.copy(this.worldScale).divide(e):this._relativeScale.copy(this.worldScale)}get worldMatrixInverse(){return this._worldMatrixInverse}get worldPosition(){return this._worldPosition}get worldOrientation(){return this._worldOrientation}get worldScale(){return this._worldScale}get worldOrientationInverse(){return this._worldOrientationInverse}get worldRotation(){return this._worldRotation}get worldRotationInverse(){return this._worldRotationInverse}get worldCenter(){return this._cachedWorldCenter()}get spatialMatrix(){return this._cachedSpatialMatrix()}get spatialMatrixInverse(){return this.spatialMatrix,this._spatialFromWorld}get localFromSpatial(){return this.spatialMatrix,this._localFromSpatial}get spatialFromLocal(){return this.spatialMatrix,this._spatialFromLocal}get spatialFromReference(){return this.spatialMatrix,this._spatialFromReference}get spatialBounds(){return this._cachedSpatialBounds()}get spatialSize(){return this.spatialBounds,this._spatialSize}get spatialCenter(){return this.spatialBounds,this._spatialCenter}get outerBounds(){return this._cachedOuterBounds()}get outerCenter(){return this.outerBounds,this._outerCenter}get outerSize(){return this.outerBounds,this._outerSize}get outerOrigin(){return this.metrics.outerOrigin[this.mode]()}get outerOrientation(){var t,r;const e=this.metrics.system.nodeAdapters.get(this.metrics.node);return e?e.outerOrientation[this.mode]:(r=(t=this.referenceState)==null?void 0:t.worldOrientation)!=null?r:Pn}get outerVisualBounds(){return this._cachedOuterVisualBounds()}get outerVisualCenter(){return this.outerVisualBounds,this._outerVisualCenter}get outerVisualSize(){return this.outerVisualBounds,this._outerVisualSize}get _viewState(){if(this.metrics.system.viewNode===this.metrics.node)return this;const e=this.metrics.system.viewMetrics;return this.mode==="current"?e[Jt]:e[Zt]}get viewFromWorld(){return this._viewFromWorld.multiplyMatrices(this._viewState.worldMatrixInverse,this.worldMatrix)}get viewFromSpatial(){return this._viewFromSpatial.multiplyMatrices(this._viewState.worldMatrixInverse,this.spatialMatrix)}get spatialFromView(){return this._spatialFromView.copy(this.viewFromSpatial).invert()}get ndcBounds(){return this._cachedNDCBounds()}get ndcCenter(){return this._cachedNDCBounds(),this._ndcCenter}get ndcSize(){return this._cachedNDCBounds(),this._ndcSize}get visualBounds(){return this._cachedVisualBounds()}get visualCenter(){return this._cachedVisualBounds(),this._visualCenter}get visualSize(){return this._cachedVisualBounds(),this._visualSize}get relativeViewPosition(){return this._viewPosition.copy(this._viewState.worldPosition).applyMatrix4(this.worldMatrixInverse)}get viewAlignedOrientation(){return this._cachedViewAlignedOrientation()}get occludingPercent(){return this._computeOcclusion(),this._occludingPercent}get occludedPercent(){return this._computeOcclusion(),this._occludedPercent}visualAverageEdgeLength(){}};let _e=ut;c(_e,"_boxA",new lt),c(_e,"_boxB",new lt),c(_e,"_sizeA",new ae),c(_e,"_sizeB",new ae);class la{constructor(e,t){this.system=e,this.node=t}}var Wh,Hh,Gh;class di extends la{constructor(e,t){super(e,t);c(this,"_cache",new Xt);c(this,"needsUpdate",!0);c(this,"parentNode");c(this,"parentMetrics");c(this,"referenceMetrics");c(this,"_adapter");c(this,"_cachedInnerBounds",this._cache.memoize(()=>{const e=this._innerBounds;if(!this.raw.parent)return e.makeEmpty();if(this.node!==this.system.viewNode){e.copy(this.intrinsicBounds);const i=this._childBounds;for(const s of this.boundingChildMetrics)s.update(),i.copy(s.innerBounds),i.applyMatrix4(s.raw.relativeMatrix),e.union(i)}const t=e.getCenter(this._innerCenter),r=e.getSize(this._innerSize);if(r.length()>0){const i=this.system.epsillonMeters;Math.abs(r.x)<=i&&(r.x=(Math.sign(r.x)||1)*i*1e3),Math.abs(r.y)<=i&&(r.y=(Math.sign(r.y)||1)*i*1e3),Math.abs(r.z)<=i&&(r.z=(Math.sign(r.z)||1)*i*1e3,t.z-=i*1e3/2),e.setFromCenterAndSize(t,r)}return e}));c(this,"_childBounds",new ee);c(this,"_innerBounds",new ee);c(this,"_innerCenter",new B);c(this,"_innerSize",new B);c(this,"_intrinsicBoundsNeedsUpdate",!0);c(this,"_intrinsicBounds",new ee);c(this,"_intrinsicCenter",new B);c(this,"_intrinsicSize",new B);c(this,"_cachedNodeChildren",this._cache.memoize(()=>(this.system.bindings.getChildren(this,this._nodeChildren),this._nodeChildren)));c(this,"_nodeChildren",new Array);c(this,"_computeState",(()=>{const e=new F,t=new G,r=new F,i=new B,s=new G,o=new B,a=new B,u=new B,l=new B,p=new B;return function(f){var b;f.parent=this.raw.parent;const h=this._adapter,d=(b=this.referenceMetrics)==null?void 0:b[f.mode];t.copy((h==null?void 0:h.orientation.enabled)&&(h==null?void 0:h.orientation[f.mode])||this.raw.relativeOrientation);const m=(h==null?void 0:h.bounds.enabled)&&(h==null?void 0:h.bounds[f.mode]);if(m){m.getCenter(a),m.getSize(u);const _=this.innerCenter,v=this.innerSize,x=this.system.epsillonMeters;Math.abs(u.x)<=x&&(u.x=(Math.sign(u.x)||1)*x*10),Math.abs(u.y)<=x&&(u.y=(Math.sign(u.y)||1)*x*10),Math.abs(u.z)<=x&&(u.z=(Math.sign(u.z)||1)*x*10),o.copy(u),Math.abs(v.x)>=x&&(o.x/=v.x),Math.abs(v.y)>=x&&(o.y/=v.y),Math.abs(v.z)>=x&&(o.z/=v.z),s.multiplyQuaternions(f.outerOrientation,t).normalize(),l.copy(a).applyQuaternion(s),p.copy(_).multiply(o).applyQuaternion(s),i.copy(f.outerOrigin).add(l).sub(p),r.compose(i,s,o),f.worldMatrix=r}else e.compose(this.raw.relativePosition,t,this.raw.relativeScale),f.worldMatrix=(d==null?void 0:d.worldMatrix)?r.multiplyMatrices(d==null?void 0:d.worldMatrix,e):e;const y=(h==null?void 0:h.opacity.enabled)&&(h==null?void 0:h.opacity[f.mode]);return f.opacity=typeof y=="number"?y:1,f}})());c(this,"raw",{parent:null,worldMatrix:new F,relativeMatrix:new F,opacity:0,worldPosition:new B,worldOrientation:new G,worldScale:new B,relativePosition:new B,relativeOrientation:new G,relativeScale:new B,spatialBounds:new ee,worldFromSpatial:new F,localFromSpatial:new F,spatialFromLocal:new F});c(this,"outerOrigin",{current:()=>this._getOuterOrigin("current"),target:()=>this._getOuterOrigin("target")});c(this,"_cachedCurrentState",this._cache.memoize(()=>this._computeState(this[Jt])));c(this,Wh,new _e("current",this));c(this,"_cachedTargetState",this._cache.memoize(()=>this._computeState(this[Zt])));c(this,Hh,new _e("target",this));c(this,Gh,new _e("target",this));c(this,"_cachedBoundsChildren",this._cache.memoize(()=>{const e=this.nodeChildren,t=this._boundingChildren;t.length=0;for(const r of e){const i=this.system.getMetrics(r);i.isAdaptive||t.push(i)}return t}));c(this,"_boundingChildren",[])}update(){var e,t;if(this.needsUpdate){this.needsUpdate=!1;const r=this._adapter=this.system.nodeAdapters.get(this.node);this.parentNode=this.raw.parent,this.parentMetrics=this.parentNode&&this.system.getMetrics(this.parentNode);const i=((e=r==null?void 0:r.activeLayout)==null?void 0:e.referenceNode)||(r==null?void 0:r.referenceNode)||this.parentNode;this.referenceMetrics=i&&this.system.getMetrics(i),(t=this.referenceMetrics)==null||t.update(),r?r._update():(this.invalidateInnerBounds(),this.invalidateStates(),this.updateRawState())}}get innerBounds(){return this._cachedInnerBounds()}get innerCenter(){return this.innerBounds,this._innerCenter}get innerSize(){return this.innerBounds,this._innerSize}get intrinsicBounds(){return this._intrinsicBoundsNeedsUpdate&&(this._intrinsicBoundsNeedsUpdate=!1,this.system.bindings.getIntrinsicBounds(this,this._intrinsicBounds),this._intrinsicBounds.getCenter(this._intrinsicCenter),this._intrinsicBounds.getSize(this._intrinsicSize)),this._intrinsicBounds}get intrinsicCenter(){return this.intrinsicBounds,this._intrinsicCenter}get intrinsicSize(){return this.intrinsicBounds,this._intrinsicSize}invalidateIntrinsicBounds(){this._intrinsicBoundsNeedsUpdate=!0;for(const e of this.boundingChildMetrics)e.invalidateIntrinsicBounds()}invalidateInnerBounds(){if(!this._cachedInnerBounds.needsUpdate){this._cachedNodeChildren.needsUpdate=!0,this._cachedBoundsChildren.needsUpdate=!0,this._cachedInnerBounds.needsUpdate=!0;for(const e of this.boundingChildMetrics)e.invalidateInnerBounds()}}containsNode(e){this.update();let t=this.system.getMetrics(e);for(;t;){if(t.parentMetrics===this)return t.node;t=t.parentMetrics}return!1}containedByNode(e){this.update();let t=this.parentMetrics;for(;t;){if(t.node===e)return t.node;t=t.parentMetrics}return!1}get nodeChildren(){return this._cachedNodeChildren()}invalidateStates(){this._cachedCurrentState.needsUpdate=!0,this._cachedTargetState.needsUpdate=!0,this[Jt].invalidate(),this[Zt].invalidate()}updateRawState(){this.system.bindings.getState(this);const e=this.raw;e.worldMatrix.decompose(e.worldPosition,e.worldOrientation,e.worldScale),e.relativeMatrix.decompose(e.relativePosition,e.relativeOrientation,e.relativeScale),e.worldFromSpatial.compose(this.outerOrigin.target(),e.worldOrientation,kn),e.localFromSpatial.copy(e.worldMatrix).invert().multiply(e.worldFromSpatial),e.spatialFromLocal.copy(e.localFromSpatial).invert(),e.spatialBounds.copy(this.innerBounds).applyMatrix4(e.spatialFromLocal)}_getOuterOrigin(e){var r,i,s;const t=this.system.nodeAdapters.get(this.node);return t?t.outerOrigin[e]:(s=(i=(r=this.referenceMetrics)==null?void 0:r[e])==null?void 0:i.worldCenter)!=null?s:ue}get current(){return this.update(),this._cachedCurrentState()}get target(){return this.update(),this._cachedTargetState()}get previousTarget(){return this.update(),this[hi]}get boundingChildMetrics(){return this._cachedBoundsChildren()}get isAdaptive(){return this.system.nodeAdapters.has(this.node)}}Wh=Jt,Hh=Zt,Gh=hi;class en{constructor(e){c(this,"relativeTolerance");c(this,"stepSizeMin");c(this,"stepSizeMax");c(this,"stepSizeStart");c(this,"minFeasibleTime");c(this,"maxInfeasibleTime");c(this,"maxIterationsPerFrame");c(this,"swarmSize");c(this,"pulseRate");c(this,"pulseFrequencyMin");c(this,"pulseFrequencyMax");e&&Object.assign(this,e)}}class pi{constructor(e){c(this,"_config",new en);c(this,"_prevOrientation",new G);c(this,"_prevBounds",new ee);c(this,"_scratchSolution",new ce);c(this,"_scratchBestSolution",new ce);this.system=e}_setConfig(e){var r,i,s,o,a,u,l,p,g,f;const t=this.system.optimize;this._config.minFeasibleTime=(r=e.minFeasibleTime)!=null?r:t.minFeasibleTime,this._config.maxInfeasibleTime=(i=e.maxInfeasibleTime)!=null?i:t.maxInfeasibleTime,this._config.pulseRate=(s=e.pulseRate)!=null?s:t.pulseRate,this._config.maxIterationsPerFrame=(o=e.maxIterationsPerFrame)!=null?o:t.maxIterationsPerFrame,this._config.swarmSize=(a=e.swarmSize)!=null?a:t.swarmSize,this._config.pulseFrequencyMin=(u=e.pulseFrequencyMin)!=null?u:t.pulseFrequencyMin,this._config.pulseFrequencyMax=(l=e.pulseFrequencyMax)!=null?l:t.pulseFrequencyMax,this._config.stepSizeMax=(p=e.stepSizeMax)!=null?p:t.stepSizeMax,this._config.stepSizeMin=(g=e.stepSizeMin)!=null?g:t.stepSizeMin,this._config.stepSizeStart=(f=e.stepSizeStart)!=null?f:t.stepSizeStart}update(e){if(e.layouts.length===0||e.metrics.innerBounds.isEmpty())return e.activeLayout=null,!1;const t=this._prevOrientation.copy(e.orientation.target),r=this._prevBounds.copy(e.bounds.target);for(const o of e.layouts)this._setConfig(o),this._updateLayout(e,o);let i,s;for(const o of e.layouts){const a=o.solutions[0];if((!s||!s.isFeasible&&a.isFeasible)&&(s=a,i=o,s.isFeasible))break}return e.layoutFeasibleTime+=e.system.deltaTime,e.layoutInfeasibleTime+=e.system.deltaTime,(s==null?void 0:s.isFeasible)||(e.layoutFeasibleTime=0),s&&s.isFeasible&&e.layoutFeasibleTime>=this._config.minFeasibleTime||e.layoutInfeasibleTime>=this._config.maxInfeasibleTime?(e.layoutInfeasibleTime=0,s.apply(!1)):(e.orientation.target=t,e.bounds.target=r,e.metrics.invalidateStates()),e.activeLayout=i,!0}_updateLayout(e,t){var p;e.measureBoundsCache.clear(),t.processObjectives();const r=t.solutions,i=this._config,s=this._scratchSolution,o=this._scratchBestSolution,a=1.5,u=1.5**(-1/4);let l=i.maxIterationsPerFrame;((p=t.solutions[0])==null?void 0:p.isFeasible)&&(l=1),this._manageSolutionPopulation(e,t,i.swarmSize,i.stepSizeStart),r[0].apply();for(let g=0;g<l;g++){t.iteration++,o.copy(r[0]);let f=!1;for(let h=0;h<r.length;h++){const d=r[h];s.copy(d),s.mutationStrategies=d.mutationStrategies;let m;if(Math.random()<i.pulseRate){const b=o!==d?o:r[1];let _;if(r.length>2)do _=r[Math.floor(Math.random()*r.length)];while(_===d);s.moveTowards(b,i.pulseFrequencyMin,i.pulseFrequencyMax),_&&t.compareSolutions(_,d)<=0&&s.moveTowards(_,i.pulseFrequencyMin,i.pulseFrequencyMax)}else m=s.perturb();s.apply();const y=t.compareSolutions(s,d)<0;if(y&&(d.copy(s),d!==r[0]&&t.compareSolutions(d,r[0])<0&&r[0].copy(d),f=!0),m)if(m.stepSize*=y?a:u,!y&&m.stepSize<i.stepSizeMin||m.stepSize>i.stepSizeMax){for(const b of d.mutationStrategies)b.stepSize=i.stepSizeStart;d!==r[0]&&(t.restartRate=.001+(1-.001)*t.restartRate,d.randomize(1),d.apply(),f=!0)}else d!==r[0]&&(t.restartRate=(1-.001)*t.restartRate)}f&&t.sortSolutions(),t.compareSolutions(o,r[0])<=0?t.successRate=(1-.005)*t.successRate:t.successRate=.005+(1-.005)*t.successRate}}_manageSolutionPopulation(e,t,r,i){if(r<=1)throw new Error("Swarm size must be larger than 1");if(t.solutions.length<r)for(;t.solutions.length<r;){const s=new ce(t);for(const o of s.mutationStrategies)o.stepSize=i;s.randomize(1),t.solutions.push(s)}else if(t.solutions.length>r)for(;t.solutions.length>r;)t.solutions.pop()}}class Ue{constructor(e){c(this,"type","ratio");c(this,"sortBlame",0);c(this,"relativeTolerance");c(this,"absoluteTolerance");c(this,"computedAbsoluteTolerance",-1/0);c(this,"computedRelativeTolerance",-1/0);c(this,"priority",0);c(this,"index",-1);c(this,"layout");c(this,"reduceFromOneOrManySpec",(e,t,r)=>{if(t===void 0)return 0;if(t instanceof Array){let i=-1/0;for(const s of t)i=Math.max(r(e,s),i);return i}return r(e,t)});c(this,"_getNumberScoreSingle",(e,t)=>{let r=0;if(typeof t!="object"){const i=this.layout.adapter.system.measureNumber(t);r=-Math.abs(e-i)}else{const i="gt"in t?this.layout.adapter.system.measureNumber(t.gt):void 0,s="lt"in t?this.layout.adapter.system.measureNumber(t.lt):void 0;i!==void 0&&e<i?r=e-i:s!==void 0&&e>s&&(r=s-e)}return r});c(this,"_getVector3ScoreSingle",(e,t)=>{const r="x"in t&&typeof t.x!="undefined"?this.getNumberScore(e.x,t.x):0,i="y"in t&&typeof t.y!="undefined"?this.getNumberScore(e.y,t.y):0,s="z"in t&&typeof t.z!="undefined"?this.getNumberScore(e.z,t.z):0,o="magnitude"in t&&typeof t.magnitude!="undefined"?this.getNumberScore(e.length(),t.magnitude):0;return r+i+s+o});c(this,"_quat",new G);c(this,"_euler",new ri);c(this,"_getQuaternionScoreSingle",(e,t)=>{var r,i;if(t===void 0)return 0;if("x"in t)return-this._quat.copy(t).angleTo(e)*Q;if("swingRange"in t){const s=this._euler.setFromQuaternion(e),o=s.x*Q,a=s.y*Q,u=s.z*Q,l=this.layout.adapter.system,p=l.mathScope.degree;let g=((r=t.swingRange)==null?void 0:r.x)?l.measureNumber(t.swingRange.x,p):0,f=((i=t.swingRange)==null?void 0:i.y)?l.measureNumber(t.swingRange.y,p):0;g=Math.max(g,.01),f=Math.max(f,.01);const h=t.twistRange?l.measureNumber(t.twistRange,p):0,d=1-(o/g)**2-(a/f)**2,m=h-Math.abs(u);return(d>0?0:d)+(m>0?0:m)}return 0});c(this,"_getBoundsMeasureScoreSingle",(e,t,r,i)=>{if(t===void 0)return 0;if(typeof t=="object"){if("gt"in t){const s=this.layout.adapter.measureBounds(t.gt,r,i);if(e<s)return e-s}if("lt"in t){const s=this.layout.adapter.measureBounds(t.lt,r,i);if(e>s)return s-e}return 0}return-Math.abs(e-this.layout.adapter.measureBounds(t,r,i))});this.layout=e}static isDiscreteSpec(e){const t=typeof e;return t==="string"||t==="number"}static isContinuousSpec(e){return e!==void 0&&!(e instanceof Array)&&typeof e=="object"&&("gt"in e||"lt"in e)}get bestScore(){return this.layout.solutions[0].scores[this.index]}getNumberScore(e,t){return this.reduceFromOneOrManySpec(e,t,this._getNumberScoreSingle)}getVector3Score(e,t){return this.reduceFromOneOrManySpec(e,t,this._getVector3ScoreSingle)}getQuaternionScore(e,t){return this.reduceFromOneOrManySpec(e,t,this._getQuaternionScoreSingle)}getBoundsScore(e,t){if(e===void 0)return 0;let r=0;for(const i in e){if(i==="absolute")continue;let s=i;if(s==="size"||s==="center"){const o=e[s];for(const a of da){let u=a;t!=="spatial"&&(this.type==="meter"&&u!=="z"||this.type==="pixel"&&u==="z")||(r+=this.getBoundsMeasureScore(o==null?void 0:o[u],t,s+u))}}else{if(t!=="spatial"&&(this.type==="meter"&&s!=="back"&&s!=="front"||this.type==="pixel"&&(s==="back"||s==="front")))continue;r+=this.getBoundsMeasureScore(e[s],t,s)}}return r}getBoundsMeasureScore(e,t,r){if(e===void 0)return 0;const i=this.layout.adapter.metrics.target;let s,o,a;switch(t){case"spatial":s=i.spatialBounds,o=i.spatialCenter,a=i.spatialSize;break;case"visual":case"view":s=i.visualBounds,o=i.visualCenter,a=i.visualSize;break;default:throw new Error(`Unknown measure type "${t}.${r}" in spec:
 "${e}"`)}let u=0;switch(r){case"left":u=s.min.x;break;case"right":u=s.max.x;break;case"bottom":u=s.min.y;break;case"top":u=s.max.y;break;case"back":u=s.min.z;break;case"front":u=s.max.z;break;case"centerx":u=o.x;break;case"centery":u=o.y;break;case"centerz":u=o.z;break;case"centerdistance":u=t==="spatial"?o.length():Math.sqrt(o.x**2+a.y**2);break;case"sizex":u=a.x;break;case"sizey":u=a.y;break;case"sizez":u=a.z;break;case"sizediagonal":u=t==="spatial"?a.length():Math.sqrt(a.x**2+a.y**2);break;default:throw new Error(`Unknown measure subtype ${t}.${r} in spec "${e}"`)}if(e instanceof Array){let l=-1/0;for(const p of e)l=Math.max(this._getBoundsMeasureScoreSingle(u,p,t,r),l);return l}return this._getBoundsMeasureScoreSingle(u,e,t,r)}attenuateVisualScore(e){let t=0;const r=this.layout.getComputedAbsoluteTolerance("pixel"),i=this.layout.adapter,s=i.system.viewResolution,o=i.system.viewFrustum,a=s.x,u=s.y,l=s.length(),p=i.metrics.target.visualBounds,g=p.min.x- -a/2+r,f=p.max.x-a/2-r,h=p.min.y- -u/2+r,d=p.max.y-u/2-r,m=p.max.z+o.nearMeters;return g<0&&(t+=Math.abs(g/a)),f>0&&(t+=Math.abs(f/a)),h<0&&(t+=Math.abs(h/u)),d>0&&(t+=Math.abs(d/u)),m>0&&(t+=m*10),e-Math.abs(l)*t}}class gi extends Ue{constructor(e){super(e);c(this,"spec");this.type="degree"}evaluate(){const e=this.layout.adapter.metrics.target;return this.getQuaternionScore(e.relativeOrientation,this.spec)}}class ha extends Ue{constructor(e){super(e);c(this,"spec");this.type="ratio"}evaluate(){const e=this.layout.adapter.metrics.target;return this.getVector3Score(e.worldScale,this.spec)}}class fa extends Ue{constructor(e){super(e);c(this,"mode","xyz");c(this,"_scale",new B);this.type="ratio"}evaluate(){const e=this.layout.adapter.metrics.target,t=this.mode;if(!t)return 0;const r=this._scale.copy(e.worldScale),i=t==="xyz"?Math.max(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z)):Math.max(Math.abs(r.x),Math.abs(r.y)),s=r.divideScalar(i);return-(1/s.x)+1+-(1/s.y)+1+(t==="xyz"?-(1/s.z)+1:s.z>1?1-s.z:0)}}const da=["x","y","z","diagonal","distance"];class pa extends Ue{constructor(e){super(e);c(this,"spec");this.type="meter"}evaluate(){return this.getBoundsScore(this.spec,"spatial")}}class mi extends Ue{constructor(e){super(e);c(this,"spec");c(this,"pixelTolerance");c(this,"meterTolerance");this.type="pixel"}evaluate(){var e;return this.type==="meter"&&(this.absoluteTolerance=this.meterTolerance),this.type==="pixel"&&(this.absoluteTolerance=this.pixelTolerance),this.getBoundsScore(this.spec,"visual")+this.getBoundsScore((e=this.spec)==null?void 0:e.absolute,"view")}}class ga extends Ue{constructor(e){super(e);c(this,"minAreaPercent",0);this.type="pixel"}evaluate(){var u;const e=this.layout.adapter.metrics.target,t=e.visualSize,r=this.layout.adapter.system.viewResolution,i=Math.min(t.x*t.y,r.x*r.y),s=((u=e.referenceState)==null?void 0:u.visualSize)||r,o=s.x*s.y;return this.attenuateVisualScore(i)-o*this.minAreaPercent}}class yi extends Ue{constructor(e){super(e);this.type="meter",this.absoluteTolerance=1e10}evaluate(){return-this.layout.adapter.metrics.target.visualCenter.length()}}const vi=new B;class wi extends en{constructor(e){super();c(this,"absoluteTolerance",{meter:"10mm",pixel:"4px",degree:"0.002deg",ratio:.002});c(this,"successRate",0);c(this,"restartRate",0);c(this,"objectives",new Array);c(this,"referenceNode",null);c(this,"maximizeObjective");c(this,"orientationConstraint");c(this,"keepAspectConstraint");c(this,"scaleConstraint");c(this,"boundsConstraint");c(this,"visualBoundsMeterConstraint");c(this,"visualBoundsPixelConstraint");c(this,"magnetizeObjective");c(this,"minimizeOcclusionObjective");c(this,"solutions",new Array);c(this,"iteration",0);c(this,"bestSolution");c(this,"compareSolutions",(e,t)=>{const r=this.objectives;if(e.scores.length<r.length)return 1;if(t.scores.length<r.length)return-1;if(e.boundsCenterDistance>1e20)return 1;if(t.boundsCenterDistance>1e10)return-1;if(e.boundsManhattanLength>1e20)return 1;if(t.boundsManhattanLength>1e10)return-1;const i=e.isFeasible,s=t.isFeasible;if(i&&!s)return-1;if(s&&!i)return 1;let o=0;const a=this.solutions[0].scores;for(let u=0;u<r.length;u++){const l=e.scores[u],p=t.scores[u];if(isNaN(l))return 1;if(isNaN(p))return-1;const g=r[u],f=g.computedRelativeTolerance,h=g.computedAbsoluteTolerance,d=Math.max(a[u],l,p),m=Math.min(d-Math.abs(d)*f,-h);if(l<m||p<m)return g.sortBlame++,p-l;p-l!=0&&(o=p-l)}return o});this.adapter=e}getComputedAbsoluteTolerance(e){return this.adapter.system.measureNumber(this.absoluteTolerance[e],e)}poseRelativeTo(e){return this.referenceNode=e,this}maximize(e){var r;const t=this.maximizeObjective=(r=this.maximizeObjective)!=null?r:new ga(this);return t.priority=-1e3,t.relativeTolerance=.1,this.addObjective(t,e)}orientation(e,t){var i;const r=this.orientationConstraint=(i=this.orientationConstraint)!=null?i:new gi(this);return r.spec=e,r.priority=-999,this.addObjective(r,t)}keepAspect(e="xyz",t){var i;const r=this.keepAspectConstraint=(i=this.keepAspectConstraint)!=null?i:new fa(this);return r.mode=e,r.priority=-998,this.addObjective(r,t)}scale(e,t){var i;const r=this.scaleConstraint=(i=this.scaleConstraint)!=null?i:new ha(this);return r.spec=e,r.priority=-2,this.addObjective(r,t)}bounds(e,t){var i;const r=this.boundsConstraint=(i=this.boundsConstraint)!=null?i:new pa(this);return r.spec=e,this.addObjective(r,t)}visualOrientation(e,t){var i;const r=this.orientationConstraint=(i=this.orientationConstraint)!=null?i:new gi(this);return r.spec=e,r.priority=-999,this.addObjective(r,t)}visualBounds(e,t){var s,o;const r=this.visualBoundsMeterConstraint=(s=this.visualBoundsMeterConstraint)!=null?s:new mi(this),i=this.visualBoundsPixelConstraint=(o=this.visualBoundsPixelConstraint)!=null?o:new mi(this);return r.spec=e,r.type="meter",i.spec=e,i.type="pixel",this.addObjective(r,t).addObjective(i,t)}magnetize(e){var r;const t=this.magnetizeObjective=(r=this.magnetizeObjective)!=null?r:new yi(this);return t.priority=-900,t.relativeTolerance=.95,this.addObjective(t,e)}avoidOcclusion(e){var r;const t=this.minimizeOcclusionObjective=(r=this.minimizeOcclusionObjective)!=null?r:new yi(this);return t.priority=11,this.addObjective(t,e)}addObjective(e,t){return Object.assign(e,t),this.objectives.indexOf(e)===-1&&this.objectives.push(e),this.processObjectives(),this}get hasValidSolution(){var e;return((e=this.solutions[0])==null?void 0:e.isFeasible)===!0}processObjectives(){var i,s;const e=this.adapter.system,t=this.objectives;let r=0;for(const o of t)o.index=r++,o.computedAbsoluteTolerance=o.absoluteTolerance!==void 0?e.measureNumber(o.absoluteTolerance,e.mathScope[o.type]):this.getComputedAbsoluteTolerance(o.type),o.computedRelativeTolerance=(s=(i=o.relativeTolerance)!=null?i:this.relativeTolerance)!=null?s:this.adapter.system.optimize.relativeTolerance}sortSolutions(){this.solutions.sort(this.compareSolutions),this.bestSolution=this.solutions[0]}}const q=class{constructor(e){c(this,"layout");c(this,"orientation",new G);c(this,"bounds",new ee);c(this,"scores",[]);c(this,"isFeasible",!1);c(this,"mutationStrategies",[{type:"rotate",stepSize:.1},{type:"center",stepSize:.1},{type:"size",stepSize:.1},{type:"minmax",stepSize:.1}]);c(this,"_mutationWeights",[]);c(this,"boundsManhattanLength");c(this,"boundsCenterDistance");e&&(this.layout=e)}get aspectPenalty(){return this.scores[this.layout.objectives.indexOf(this.layout.keepAspectConstraint)]||0}get orientationPenalty(){return this.scores[this.layout.objectives.indexOf(this.layout.orientationConstraint)]||0}get spatialBoundsPenalty(){return this.scores[this.layout.objectives.indexOf(this.layout.boundsConstraint)]||0}_selectStrategy(){const e=this.mutationStrategies,t=this._mutationWeights,r=this.layout.orientationConstraint,i=this.layout.keepAspectConstraint;for(let s=0;s<e.length;s++)t[s]=e[s].stepSize,r&&e[s].type=="rotate"&&this.orientationPenalty>-r.computedAbsoluteTolerance&&(t[s]*=.01),i&&e[s].type=="size"&&this.aspectPenalty<-i.computedAbsoluteTolerance&&(t[s]*=100);return ci(e,t)}copy(e){this.layout=e.layout,this.orientation.copy(e.orientation),this.bounds.copy(e.bounds),this.scores.length=0;for(let t=0;t<e.scores.length;t++)this.scores[t]=e.scores[t];return this.isFeasible=e.isFeasible,this}randomize(e){const t=Un(e),r=q._scratchV1.set(0,0,-t),i=this.layout.adapter.system.viewMetrics.target;r.applyMatrix4(i.worldMatrix);const s=this.layout.adapter.metrics.target.parentState;s&&r.applyMatrix4(s.worldMatrixInverse),this.orientation.copy(i.worldOrientation),s&&this.orientation.multiply(s.worldOrientationInverse);const o=this.layout.adapter.metrics.innerBounds,a=o.isEmpty()?q._scratchV2.set(1,1,1):o.getSize(q._scratchV2);return a.normalize(),a.multiplyScalar(t*2*Math.tan(5*j)),this.bounds.setFromCenterAndSize(r,a),this}moveTowards(e,t,r){const i=this.bounds.getCenter(q._center),s=this.bounds.getSize(q._size),o=e.bounds,a=o.getCenter(q._otherCenter),u=o.getSize(q._otherSize);this.orientation.slerp(e.orientation,q.generatePulseFrequency(t,r)).normalize(),Math.random()<.5?(i.lerp(a,q.generatePulseFrequency(t,r)),s.lerp(u,q.generatePulseFrequency(t,r)),this.bounds.setFromCenterAndSize(i,s)):(this.bounds.min.lerp(o.min,q.generatePulseFrequency(t,r)),this.bounds.max.lerp(o.max,q.generatePulseFrequency(t,r)))}perturb(){var l;const e=this._selectStrategy(),t=e.type;let r=e.stepSize;if(t==="rotate"||Math.random()<.001){const p=(l=this.layout.orientationConstraint)==null?void 0:l.spec;if((p==null?void 0:p.isQuaternion)&&this.orientationPenalty<p.computedAbsoluteTolerance&&Math.random()<.01)this.orientation.copy(p);else{const g=Math.min(Un(Math.min(r,1)*1e-4),1);this.orientation.multiply(Yt(g,g)).normalize()}}const i=this.bounds,s=i.getCenter(q._center),o=i.getSize(q._size);if(t==="center"){const p=q._direction.set(0,0,1).applyQuaternion(Yt(1,1));p.setLength(ft(r)).multiplyScalar(o.length()),s.add(p)}if(t==="size"){const p=2**ft(r);o.multiplyScalar(p)}if(o.clampScalar(this.layout.adapter.system.epsillonMeters/10,1e20),i.setFromCenterAndSize(s,o),t==="minmax"){const p=q._direction.set(0,0,1).applyQuaternion(Yt(1,1));p.setLength(ft(r)).multiply(o),Math.random()<.5,i.min.add(p)}const a=i.min,u=i.max;return a.x>u.x&&this._swap(a,u,"x"),a.y>u.y&&this._swap(a,u,"y"),a.z>u.z&&this._swap(a,u,"z"),e}_swap(e,t,r){const i=e[r],s=t[r];e[r]=s,t[r]=i}static generatePulseFrequency(e,t){return e+Math.random()*(t-e)}apply(e=!0){const t=this.layout,r=t.adapter;if(r.orientation.target=this.orientation,r.bounds.target=this.bounds,r.metrics.invalidateStates(),e){this.isFeasible=!0;for(let i=0;i<t.objectives.length;i++){const s=t.objectives[i],o=this.scores[i]=s.evaluate();(o<-s.computedAbsoluteTolerance||!isFinite(o))&&(this.isFeasible=!1)}}this.boundsManhattanLength=this.bounds.getSize(vi).manhattanLength(),this.boundsCenterDistance=this.bounds.getCenter(vi).length()}};let ce=q;c(ce,"_scratchV1",new B),c(ce,"_scratchV2",new B),c(ce,"_direction",new B),c(ce,"_center",new B),c(ce,"_size",new B),c(ce,"_otherCenter",new B),c(ce,"_otherSize",new B);const bi=xo;class _i{constructor(e){c(this,"target");c(this,"duration");c(this,"easing");c(this,"blend");c(this,"elapsed");e&&Object.assign(this,e)}}class dt{constructor(e){c(this,"multiplier");c(this,"duration");c(this,"easing");c(this,"threshold");c(this,"delay");c(this,"debounce");c(this,"maxWait");c(this,"blend");e&&Object.assign(this,e)}}const ma=new ae,ya=new B,va=new G,xi=new ee,wa=new zn,ba=new zn(0,0,0);class xe extends dt{constructor(e,t,r,i=e.transition){super(r);c(this,"needsUpdate",!1);c(this,"_size",new B);c(this,"_start");c(this,"_current");c(this,"_reference");c(this,"_target");c(this,"queue",[]);c(this,"enabled",!1);c(this,"forceWait",!1);c(this,"_forceCommit",!1);c(this,"_resolvedConfig",new dt);c(this,"delayTime",0);c(this,"debounceTime",0);c(this,"_previousStatus","unchanged");c(this,"_status","unchanged");c(this,"_previousTarget");c(this,"_syncGroup");this.system=e,this.parentConfig=i,this.reset(t),this._previousTarget=this._copy(this._previousTarget,this.target)}_copy(e,t){if(typeof t=="undefined")return;if(typeof t=="number")return t;const r=e?e.copy(t):t.clone();if(r&&"isBox3"in r){const i=r,s=i.getSize(this._size);(i.isEmpty()||!isFinite(s.x)||!isFinite(s.y)||!isFinite(s.z))&&i.setFromCenterAndSize(ue,ue)}return r}_isEqual(e,t){return e===void 0||t===void 0?!1:e===t?!0:typeof e=="number"?e===t:(e==null?void 0:e.equals(t))||!1}reset(e){this._start=this._copy(this._start,e),this._current=this._copy(this._current,e),this._target=this._copy(this._target,e),this.queue.length=0}set start(e){this._start=this._copy(this._start,e)}get start(){return this._start}set current(e){this._current=this._copy(this._current,e)}get current(){return this._current}set reference(e){this._reference=this._copy(this._reference,e)}get reference(){return this._reference}set target(e){this.enabled=!0,this._target=this._copy(this._target,e)}get target(){return this._target}get progress(){if(!this.enabled)return 1;if(this.queue.length>0){const e=this.queue[this.queue.length-1];return e.duration===0?0:e.elapsed/e.duration}return 1}get forceCommit(){return this._forceCommit}set forceCommit(e){this._forceCommit!==e&&(this._forceCommit=e)}get relativeDifference(){var t,r;const e=(r=(t=this.queue[this.queue.length-1])==null?void 0:t.target)!=null?r:this.start;return typeof this.target!="undefined"?Nn(e,this.target):0}get referenceRelativeDifference(){return typeof this.reference!="undefined"&&typeof this.target!="undefined"?Nn(this.reference,this.target):1/0}get resolvedConfig(){var i,s,o,a,u,l,p,g,f,h,d,m,y,b,_,v;const e=this._resolvedConfig,t=this.parentConfig,r=this.system.transition;return e.multiplier=(s=(i=this.multiplier)!=null?i:t==null?void 0:t.multiplier)!=null?s:r.multiplier,e.duration=(a=(o=this.duration)!=null?o:t==null?void 0:t.duration)!=null?a:r.duration,e.easing=(l=(u=this.easing)!=null?u:t==null?void 0:t.easing)!=null?l:r.easing,e.threshold=(g=(p=this.threshold)!=null?p:t==null?void 0:t.threshold)!=null?g:r.threshold,e.delay=(h=(f=this.delay)!=null?f:t==null?void 0:t.delay)!=null?h:r.delay,e.debounce=(m=(d=this.debounce)!=null?d:t==null?void 0:t.debounce)!=null?m:r.debounce,e.maxWait=(b=(y=this.maxWait)!=null?y:t==null?void 0:t.maxWait)!=null?b:r.maxWait,e.blend=(v=(_=this.blend)!=null?_:t==null?void 0:t.blend)!=null?v:r.blend,e}get previousStatus(){return this._previousStatus}get status(){return this.needsUpdate&&(this._previousStatus=this._status,this._status=this._computeStatus()),this._status}_computeStatus(){if(this.forceCommit)return"committing";const e=this.resolvedConfig,t=e.threshold,r=this.system.deltaTime*e.multiplier,i=this.delayTime+r,s=this.debounceTime+r;return this.relativeDifference>t?!this.forceWait&&(i>=e.delay&&s>=e.debounce||i>=e.maxWait)?"committing":this.referenceRelativeDifference<t?"settling":"changed":"unchanged"}_updateTransitionable(){var a,u,l,p,g;const e=this.system.deltaTime,t=this.resolvedConfig,r=this.queue,i=this.status,s=e*t.multiplier;for(;r.length&&r[0].elapsed>=r[0].duration;)this.start=r.shift().target;this.current=this.start;let o=this.start;for(let f=0;f<r.length;f++){const h=r[f];if(this._addTransitionToCurrent(o,h,s),o=h.target,!h.blend)break}switch(this.debounceTime+=s,i){case"settling":break;case"changed":this.delayTime+=s,this.reference=this.target;break;case"unchanged":this.reference=void 0,this.delayTime=0;break;case"committing":this.delayTime=0,this.debounceTime=0;const f=typeof this.forceCommit=="object"?this.forceCommit:new _i;f.target=(a=f.target)!=null?a:this._copy(void 0,this.target),f.duration=(u=f.duration)!=null?u:t.duration,f.easing=(l=f.easing)!=null?l:t.easing,f.blend=(p=f.blend)!=null?p:t.blend,f.elapsed=(g=f.elapsed)!=null?g:0,r.push(f),this.forceCommit=!1;break}this.forceWait=!1}_addTransitionToCurrent(e,t,r){const i=this._current,s=t.duration>0?t.easing(Math.min(t.elapsed/t.duration,1)):1,o=t.target;if(t.elapsed+=r,typeof o=="number"){this._current=i+So(o-e,0,1-s);return}if("isVector3"in o){const a=i,u=e,l=o,p=ya.copy(l).sub(u).lerp(ue,1-s);this._current=a.add(p);return}if("isVector2"in o){const a=i,u=e,l=o,p=ma.copy(l).sub(u).lerp(ai,1-s);this._current=a.add(p);return}if("isQuaternion"in o){const a=i,u=e,l=o,p=va.copy(u).invert().multiply(l).slerp(Pn,1-s);this._current=a.multiply(p).normalize();return}if("isColor"in o){const a=i,u=e,l=o,p=wa.copy(l).sub(u).lerp(ba,1-s);this._current=a.add(p);return}if("isBox3"in o){const a=i,u=e,l=o,p=xi.min.copy(l.min).sub(u.min).lerp(ue,1-s),g=xi.max.copy(l.max).sub(u.max).lerp(ue,1-s);a.min.add(p),a.max.add(g),this._current=a;return}}_swap(e,t,r){const i=e[r],s=t[r];e[r]=s,t[r]=i}update(e=!1){if(!this.needsUpdate&&!e||(this._isEqual(this._previousTarget,this.target)||(this._target=this._target,this.enabled=!0),this._previousTarget=this._copy(this._previousTarget,this.target),!this.enabled))return;const t=this.syncGroup;if(!this.forceCommit&&t){for(const r of t)if(r.enabled&&r.status==="committing"){for(const i of t)i.needsUpdate&&i.forceCommit===!1&&i.relativeDifference>i.resolvedConfig.threshold&&(i.forceCommit=!0);break}}this._updateTransitionable(),this.needsUpdate=!1}set syncGroup(e){this._syncGroup&&this._syncGroup.delete(this),this._syncGroup=e,e==null||e.add(this)}get syncGroup(){return this._syncGroup}}class Si{constructor(e,t){c(this,"measureBoundsCache",new Map);c(this,"metrics");c(this,"transition",new dt);c(this,"referenceNode");c(this,"_outerOrigin");c(this,"_outerOrientation");c(this,"_outerBounds");c(this,"_outerVisualBounds");c(this,"_parentAdapter",null);c(this,"_orientation");c(this,"_bounds");c(this,"_opacity");c(this,"layouts",new Array);c(this,"layoutFeasibleTime",0);c(this,"layoutInfeasibleTime",0);c(this,"_prevLayout",null);c(this,"_activeLayout",null);c(this,"_progress",1);c(this,"_hasValidContext",!1);c(this,"onUpdate");c(this,"onPostUpdate");c(this,"_prevNodeOrientation",new G);c(this,"_prevNodeBounds",new ee);this.system=e,this.node=t,this.metrics=this.system.getMetrics(this.node);const r=this.metrics.target;this._orientation=new xe(this.system,r.relativeOrientation,void 0,this.transition),this._bounds=new xe(this.system,r.spatialBounds,void 0,this.transition),this._opacity=new xe(this.system,r.opacity,void 0,this.transition),this._outerOrigin=new xe(this.system,r.outerCenter,void 0,this.transition),this._outerOrientation=new xe(this.system,r.outerOrientation,void 0,this.transition),this._outerBounds=new xe(this.system,r.outerBounds,void 0,this.transition),this._outerVisualBounds=new xe(this.system,r.outerVisualBounds,void 0,this.transition),this._outerOrigin.debounce=0,this._outerOrigin.delay=0,this._outerOrientation.debounce=0,this._outerOrientation.delay=0,this._outerBounds.debounce=0,this._outerBounds.delay=0,this._outerVisualBounds.debounce=0,this._outerVisualBounds.delay=0,this._orientation.syncGroup=this._bounds.syncGroup=this._opacity.syncGroup=new Set}measureBounds(e,t,r){var b,_,v;const i=this.system,s=i.mathScope,o=i.math,a=t==="spatial"||r==="front"||r==="back"||r==="centerz"||r==="sizez"?s.meter:s.pixel,u=a===s.meter?"m":"px";typeof e=="number"&&(e=""+e+u);const l=t+"-"+r+" = "+e;if((b=this.measureBoundsCache)==null?void 0:b.has(l))return this.measureBoundsCache.get(l);if(!i.mathCompiledExpressions.has(e)){const w=o.parse(e.replace("%","percent")).compile();i.mathCompiledExpressions.set(e,w)}const p=i.mathCompiledExpressions.get(e),g=i.viewMetrics.target,f=this.metrics.target;let h,d;switch(t){case"spatial":h=f.outerBounds,d=f.outerCenter;break;case"visual":h=f.outerVisualBounds,d=f.outerVisualCenter;break;case"view":h=g.visualBounds,d=g.visualCenter;break;default:throw new Error(`Unknown measure type "${t}.${r}"`)}if(e.includes("%")){const x=t==="spatial"?f.outerSize:(_=f.outerVisualSize)!=null?_:g.visualSize;let w=0;switch(r){case"left":case"centerx":case"right":case"sizex":w=o.unit(x.x/100,u);break;case"bottom":case"centery":case"top":case"sizey":w=o.unit(x.y/100,u);break;case"back":case"centerz":case"front":case"sizez":w=o.unit(x.z/100,"m");break;case"sizediagonal":w=t==="spatial"?o.unit(x.length()/100,"m"):o.unit(Math.sqrt(x.x**2+x.y**2)/100,"px");break;default:throw new Error(`Invalid measure subtype "${t}.${r}" for percentage units`)}s.percent=w}let m;switch(r){case"left":m=h.min.x;break;case"centerx":m=d.x;break;case"right":m=h.max.x;break;case"bottom":m=h.min.y;break;case"centery":m=d.y;break;case"top":m=h.max.y;break;case"front":m=h.max.z;break;case"centerz":m=d.z;break;case"back":m=h.min.z;break;case"centerdistance":default:m=0}let y=p.evaluate(s);return typeof y=="object"&&(y=o.number(y,a)),m+=y,s.percent=void 0,(v=this.measureBoundsCache)==null||v.set(l,m),m}get outerOrigin(){return this._outerOrigin}get outerOrientation(){return this._outerOrientation}get outerBounds(){return this._outerBounds}get outerVisualBounds(){return this._outerVisualBounds}get parentAdapter(){return this._parentAdapter}_computeParentAdapter(){let e=this.metrics;for(;e=e.parentMetrics;){const t=this.system.nodeAdapters.get(e.node);if(t)return t}return null}get orientation(){return this._orientation}get bounds(){return this._bounds}get opacity(){return this._opacity}get previousLayout(){return this._prevLayout}set activeLayout(e){this._prevLayout=this._activeLayout,this._activeLayout=e}get activeLayout(){return this._activeLayout}get progress(){return this._progress}_computeProgress(){return Math.min(this.orientation.progress,this.bounds.progress,this.opacity.progress)}createLayout(){const e=new wi(this);return this.layouts.push(e),e}get hasValidContext(){return this._hasValidContext}_computeHasValidContext(){var t;const e=this.parentAdapter;return e?e.hasValidContext?!!(e.layouts.length===0||((t=e.activeLayout)==null?void 0:t.hasValidSolution)):!1:!0}_update(){var t;this._parentAdapter=this._computeParentAdapter(),this._hasValidContext=this._computeHasValidContext();const e=this.metrics;if(e.referenceMetrics&&(this.outerOrigin.target=e.referenceMetrics.target.worldCenter,this.outerOrientation.target=e.referenceMetrics.target.worldOrientation,this.outerBounds.target=e.referenceMetrics.innerBounds,this.outerBounds.target.applyMatrix4(e.target.spatialFromReference),this.outerVisualBounds.target=e.referenceMetrics.target.visualBounds),this.outerOrigin.update(),this.outerOrientation.update(),this.outerBounds.update(),this.outerVisualBounds.update(),this.onUpdate){this.onUpdate(),e.invalidateIntrinsicBounds(),e.invalidateInnerBounds(),e.invalidateStates(),e.updateRawState();const r=e.raw;if(!this.system.optimizer.update(this)){const i=this.orientation.current,s=this.orientation.target,o=r.relativeOrientation;s.angleTo(o)>this.system.epsillonRadians&&i.angleTo(o)>this.system.epsillonRadians&&(this.orientation.target=o);const a=this.bounds.current,u=this.bounds.target,l=r.spatialBounds;(u.min.distanceTo(l.min)>this.system.epsillonMeters||u.max.distanceTo(l.max)>this.system.epsillonMeters)&&(a.min.distanceTo(l.min)>this.system.epsillonMeters||a.max.distanceTo(l.max)>this.system.epsillonMeters)&&(this.bounds.target=l)}}else e.invalidateIntrinsicBounds(),e.invalidateInnerBounds(),e.invalidateStates(),this.system.optimizer.update(this);this.opacity.update(),this.orientation.update(),this.bounds.update(),this._progress=this._computeProgress(),e.invalidateStates(),this.system.bindings.apply(e,e.current),e.invalidateStates(),(t=this.onPostUpdate)==null||t.call(this)}}class Ti{constructor(){c(this,"_cache",new Xt);c(this,"isLayoutFrustum",!0);c(this,"_leftDegrees",-20);c(this,"_rightDegrees",20);c(this,"_bottomDegrees",-20);c(this,"_topDegrees",20);c(this,"_nearMeters",.5);c(this,"_farMeters",1e3);c(this,"_size",new ae);c(this,"_center",new ae);c(this,"_v1",new B);c(this,"_inverseProjection",new F);c(this,"_forwardDirection",new B(0,0,-1));c(this,"_fullNDC",new ee(new B(-1,-1,-1),new B(1,1,1)));c(this,"_cachedPerspectiveProjectionMatrix",this._cache.memoize(()=>{const e=this.nearMeters,t=this.farMeters,r=e*Math.tan(this.leftDegrees*j),i=e*Math.tan(this.rightDegrees*j),s=e*Math.tan(this.topDegrees*j),o=e*Math.tan(this.bottomDegrees*j);return this._perspective.makePerspective(r,i,s,o,e,t)}));c(this,"_perspective",new F);c(this,"_boxA",new lt);c(this,"_boxB",new lt);c(this,"_overlapSize",new ae)}get leftDegrees(){return this._leftDegrees}set leftDegrees(e){e!==this._leftDegrees&&(this._leftDegrees=e,this._cache.invalidateAll())}get rightDegrees(){return this._rightDegrees}set rightDegrees(e){e!==this._rightDegrees&&(this._rightDegrees=e,this._cache.invalidateAll())}get bottomDegrees(){return this._bottomDegrees}set bottomDegrees(e){e!==this._bottomDegrees&&(this._bottomDegrees=e,this._cache.invalidateAll())}get topDegrees(){return this._topDegrees}set topDegrees(e){e!==this._topDegrees&&(this._topDegrees=e,this._cache.invalidateAll())}get nearMeters(){return this._nearMeters}set nearMeters(e){e!==this._nearMeters&&(this._nearMeters=e,this._cache.invalidateAll())}get farMeters(){return this._farMeters}set farMeters(e){e!==this._farMeters&&(this._farMeters=e,this._cache.invalidateAll())}get sizeDegrees(){return this._size.set(this.rightDegrees-this.leftDegrees,this.topDegrees-this.bottomDegrees),this._size}get diagonalDegrees(){const e=this.sizeDegrees;return Math.acos(Math.cos(e.x*j)*Math.cos(e.y*j))*Q}get centerDegrees(){const e=this.sizeDegrees;return this._center.set(this.leftDegrees+e.x/2,this.bottomDegrees+e.y/2)}get angleToCenter(){const e=this.centerDegrees;return Math.acos(Math.cos(e.x*j)*Math.cos(e.y*j))*Q}get angleToTopLeft(){return Math.acos(Math.cos(this.leftDegrees*j)*Math.cos(this.topDegrees*j))*Q}get angleToTopRight(){return Math.acos(Math.cos(this.rightDegrees*j)*Math.cos(this.topDegrees*j))*Q}get angleToBottomLeft(){return Math.acos(Math.cos(this.leftDegrees*j)*Math.cos(this.bottomDegrees*j))*Q}get angleToBottomRight(){return Math.acos(Math.cos(this.rightDegrees*j)*Math.cos(this.bottomDegrees*j))*Q}get angleToClosestPoint(){const e=Math.min(Math.max(0,this.leftDegrees),this.rightDegrees),t=Math.min(Math.max(0,this.bottomDegrees),this.topDegrees);return Math.acos(Math.cos(e*j)*Math.cos(t*j))*Q}get angleToFarthestPoint(){return Math.max(this.angleToTopLeft,this.angleToTopRight,this.angleToBottomLeft,this.angleToBottomRight)}get depth(){return this.farMeters-this.nearMeters}get distance(){return this.nearMeters+this.depth/2}get aspectRatio(){const e=this.nearMeters,t=e*Math.tan(this.leftDegrees*j),r=e*Math.tan(this.rightDegrees*j),i=e*Math.tan(this.topDegrees*j),s=e*Math.tan(this.bottomDegrees*j);return(i-s)/(r-t)}setFromPerspectiveProjectionMatrix(e,t=this._fullNDC){const r=this._inverseProjection.copy(e).invert(),i=this._v1,s=this._forwardDirection,o=Math.sign(t.min.x)*i.set(t.min.x,0,-1).applyMatrix4(r).angleTo(s)*Q,a=Math.sign(t.max.x)*i.set(t.max.x,0,-1).applyMatrix4(r).angleTo(s)*Q,u=Math.sign(t.max.y)*i.set(0,t.max.y,-1).applyMatrix4(r).angleTo(s)*Q,l=Math.sign(t.min.y)*i.set(0,t.min.y,-1).applyMatrix4(r).angleTo(s)*Q,p=-i.set(0,0,t.min.z).applyMatrix4(r).z,g=-i.set(0,0,t.max.z).applyMatrix4(r).z;return this.leftDegrees=o,this.rightDegrees=a,this.topDegrees=u,this.bottomDegrees=l,this.nearMeters=p,this.farMeters=g,this}get perspectiveProjectionMatrix(){return this._cachedPerspectiveProjectionMatrix()}overlapPercent(e){return this._boxA.min.x=this.leftDegrees,this._boxA.max.x=this.rightDegrees,this._boxA.min.y=this.bottomDegrees,this._boxA.max.y=this.topDegrees,this._boxB.min.x=e.leftDegrees,this._boxB.max.x=e.rightDegrees,this._boxB.min.y=e.bottomDegrees,this._boxB.max.y=e.topDegrees,this._boxA.intersect(this._boxB).getSize(this._overlapSize).length()/this.sizeDegrees.length()}}class Ei{constructor(e,t){c(this,"math",To({evaluateDependencies:Eo,addDependencies:Mo,subtractDependencies:Ao,multiplyDependencies:Ro,divideDependencies:Bo,modDependencies:Co,numberDependencies:Io,createUnitDependencies:Do,unitDependencies:Oo},{predictable:!0}));c(this,"mathCompiledExpressions",new Map);c(this,"mathScope",{ratio:void 0,degree:this.math.unit("degree"),meter:this.math.unit("meter"),pixel:this.math.createUnit("pixel",{aliases:["pixels","px"]}),percent:void 0,vdeg:void 0,vw:void 0,vh:void 0});c(this,"epsillonMeters",1e-10);c(this,"epsillonRadians",1e-10);c(this,"epsillonRatio",1e-10);c(this,"transition",new dt({multiplier:1,duration:0,easing:bi.easeInOut,threshold:0,delay:0,debounce:0,maxWait:10,blend:!0}));c(this,"optimize",new en({minFeasibleTime:.02,maxInfeasibleTime:5,relativeTolerance:.001,maxIterationsPerFrame:10,swarmSize:10,pulseFrequencyMin:0,pulseFrequencyMax:1,pulseRate:.4,stepSizeMin:1e-4,stepSizeMax:4,stepSizeStart:1.5}));c(this,"optimizer",new pi(this));c(this,"viewFrustum",new Ti);c(this,"viewResolution",new ae(1e3,1e3));c(this,"deltaTime",1/60);c(this,"time",0);c(this,"maxDeltaTime",1/60);c(this,"nodeMetrics",new Map);c(this,"nodeAdapters",new Map);c(this,"transitionables",[]);c(this,"getMetrics",e=>{if(!e)throw new Error("node must be defined");let t=this.nodeMetrics.get(e);return t||(t=new di(this,e),this.nodeMetrics.set(e,t)),t});c(this,"getState",e=>{if(!e)throw new Error("node must be defined");return this.getMetrics(e).target});c(this,"getAdapter",e=>{let t=this.nodeAdapters.get(e);return t||(t=new Si(this,e),this.nodeAdapters.set(e,t)),t});c(this,"createTransitionable",(e,t)=>{const r=new xe(this,e,t,this.transition);return this.transitionables.push(r),r});c(this,"_prevResolution",new ae);c(this,"_prevSize",new ae);c(this,"measureNumberCache",{});this.viewNode=e,this.bindings=t}get viewMetrics(){if(!this.viewNode)throw new Error("EtherealSystem.viewNode must be defined");return this.getMetrics(this.viewNode)}update(e,t){this.deltaTime=Math.max(e,this.maxDeltaTime),this.time=t,(!this._prevResolution.equals(this.viewResolution)||!this._prevSize.equals(this.viewFrustum.sizeDegrees))&&(this.mathScope.vdeg=this.math.unit(this.viewResolution.y/this.viewFrustum.sizeDegrees.y,"px"),this.mathScope.vw=this.math.unit(this.viewResolution.x/100,"px"),this.mathScope.vh=this.math.unit(this.viewResolution.y/100,"px"),this.measureNumberCache={}),this._prevResolution.copy(this.viewResolution),this._prevSize.copy(this.viewFrustum.sizeDegrees);for(const r of this.nodeMetrics.values()){r.needsUpdate=!0;const i=this.nodeAdapters.get(r.node);i&&(i.opacity.needsUpdate=!0,i.orientation.needsUpdate=!0,i.bounds.needsUpdate=!0,i.outerOrigin.needsUpdate=!0,i.outerOrientation.needsUpdate=!0,i.outerBounds.needsUpdate=!0,i.outerVisualBounds.needsUpdate=!0)}for(const r of this.transitionables)r.needsUpdate=!0;for(const r of this.transitionables)r.update();this.viewMetrics.update();for(const r of this.nodeAdapters.values())r.metrics.update()}measureNumber(e,t){if(typeof e=="number")return e;if(e in this.measureNumberCache)return this.measureNumberCache[e];if(!this.mathCompiledExpressions.has(e)){const a=this.math.parse(e).compile();this.mathCompiledExpressions.set(e,a)}const r=this.mathCompiledExpressions.get(e),i=r.evaluate(this.mathScope),s=typeof i=="number"?i:this.math.number(r.evaluate(this.mathScope),t);return this.measureNumberCache[e]=s,s}}const _a=new B;class xa{constructor(e=0,t=0,r=0){this.horizontalRadians=e,this.verticalRadians=t,this.distance=r}get horizontalDegrees(){return this.horizontalRadians*Q}set horizontalDegrees(e){this.horizontalRadians=e*j}get verticalDegrees(){return this.verticalRadians*Q}set verticalDegrees(e){this.verticalRadians=e*j}setWithRadians(e,t,r){return this.horizontalRadians=e,this.verticalRadians=t,this.distance=r,this}setWithDegrees(e,t,r){return this.horizontalDegrees=e,this.verticalDegrees=t,this.distance=r,this}fromCartesianDirection(e){const t=_a.copy(e).normalize();return this.verticalRadians=Math.asin(t.y)*Q,this.horizontalRadians=Math.atan2(t.x,-t.z)*Q,this.distance=0,this}fromCartesianPosition(e){return this.fromCartesianDirection(e),this.distance=e.length(),this}toCartesianDirection(e){const t=this.verticalRadians,r=-Math.PI-this.horizontalRadians,i=Math.sin(t),s=Math.cos(t)*Math.sin(r),o=-Math.cos(t)*Math.cos(r);return e.set(s,i,o).normalize()}toCartesianPosition(e){return this.toCartesianDirection(e).multiplyScalar(this.distance)}}const Sa=new F,Ta=new F,pt={getChildren(n,e){const t=n.node;if(!!t.isObject3D){e.length=0;for(let r=0;r<t.children.length;r++)e[r]=t.children[r]}},getState(n){var i;if(n.system.viewNode===n.node){const s=n.node;s.updateMatrixWorld(),n.system.viewFrustum.setFromPerspectiveProjectionMatrix(s.projectionMatrix)}const e=n.node;if(!e.isObject3D)return;let t,r;if(n.isAdaptive){const s=(i=n.referenceMetrics)==null?void 0:i.target.worldMatrix;r=Sa.compose(e.position,e.quaternion,e.scale),t=s?Ta.multiplyMatrices(s,r):r}else t=e.matrixWorld,r=e.matrix;n.raw.parent=e.parent,n.raw.worldMatrix.copy(t),n.raw.relativeMatrix.copy(r),n.raw.opacity=Mi(n)||1},getIntrinsicBounds(n,e){const t=n.node;if(!!t.isObject3D)return t.geometry?(t.geometry.boundingBox||t.geometry.computeBoundingBox(),e.copy(t.geometry.boundingBox)):e},apply(n,e){const t=n.node;if(!t.isObject3D)return;if(e.parent!==t.parent){const i=e.parent;i&&i.add(t)}let r=e.localMatrix;if(isNaN(r.elements[0])||isNaN(r.elements[13])||isNaN(r.elements[14])||isNaN(r.elements[15])||r.elements[0]===0)throw new Error;if(r=e.worldMatrix,isNaN(r.elements[0])||isNaN(r.elements[13])||isNaN(r.elements[14])||isNaN(r.elements[15])||r.elements[0]===0)throw new Error;t.matrixAutoUpdate=!1,t.matrix.copy(e.localMatrix),t.matrixWorld.copy(e.worldMatrix),Ai(n,e.opacity)}};function Mi(n){const e=n.node;if(e.material){const t=e.material;if(t.length){for(const r of t)if(r.opacity!==void 0)return r.opacity}else if("opacity"in e.material)return e.material.opacity}for(const t of n.boundingChildMetrics){const r=Mi(t);if(r!==void 0)return r}}function Ai(n,e){const t=n.node;if(t.material){const r=t.material;if(r.length)for(const i of r)"opacity"in i&&(i.opacity=e);else t.material.opacity=e}for(const r of n.boundingChildMetrics)Ai(r,e)}const Ri={getChildren(n,e){n.node.isObject3D&&pt.getChildren(n,e)},getState(n){n.node.isObject3D&&pt.getState(n)},getIntrinsicBounds(n,e){return n.node.isObject3D&&pt.getIntrinsicBounds(n,e),e},apply(n,e){n.node.isObject3D&&pt.apply(n,e)}};function Ea(n,e=Ri){return new Ei(n,e)}var Vh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ThreeBindings:pt,DefaultBindings:Ri,createLayoutSystem:Ea,EtherealLayoutSystem:Ei,MathUtils:Lo,Matrix3:zo,Matrix4:F,V_00:ai,V_11:Xo,V_000:ue,V_100:Jo,V_010:Zo,V_001:ea,V_111:kn,Q_IDENTITY:Pn,DIRECTION:ht,Vector2:ae,Vector3:B,Vector4:ko,Quaternion:G,Euler:ri,Color:zn,Box2:lt,Box3:ee,Ray:Po,Line3:No,Plane:Uo,computeRelativeDifference:Nn,gaussian:ft,levy:Un,randomQuaternion:Yt,randomSelect:ci,extractRotationAboutAxis:ua,LayoutFrustum:Ti,NodeStateBase:fi,NodeState:_e,SpatialMetrics:di,SpatialAdapter:Si,SpatialLayout:wi,LayoutSolution:ce,OptimizerConfig:en,SpatialOptimizer:pi,easing:bi,Transition:_i,TransitionConfig:dt,Transitionable:xe,SphericalCoordinate:xa,MemoizationCache:Xt});function tn(n,e,t,r=0){var i;r++,n=n.shadowRoot||n;for(let s=n.firstElementChild;s;s=s.nextElementSibling){if(s.assignedSlot)continue;const o=(i=s.assignedElements)==null?void 0:i.call(s,{flatten:!0});if(o)for(const a of o)e.call(t,a,r)&&tn(s,e,t,r);e.call(t,s,r)&&tn(s,e,t,r)}}class Fe{constructor(){c(this,"left",0);c(this,"top",0);c(this,"width",0);c(this,"height",0)}copy(e){return this.top=e.top,this.left=e.left,this.width=e.width,this.height=e.height,this}}class $e{constructor(){c(this,"left",0);c(this,"top",0);c(this,"right",0);c(this,"bottom",0)}copy(e){return this.top=e.top,this.left=e.left,this.right=e.right,this.bottom=e.bottom,this}}function gt(n,e=new Fe,t){const r=n.ownerDocument,i=r.documentElement,s=r.body;if(n===i)return Ra(r,e);if(t===n){e.left=0,e.top=0,e.width=n.offsetWidth,e.height=n.offsetHeight;return}const o=n.ownerDocument.defaultView;let a=n,u,l=a.offsetParent,p=o.getComputedStyle(a,null),g=a.offsetTop,f=a.offsetLeft;for(l&&t&&(l.contains(t)||l.contains(t.getRootNode().host))&&l!==t&&(gt(t,e,l),f-=e.left,g-=e.top);(a=a.parentElement)&&a!==s&&a!==i&&a!==t&&p.position!=="fixed";)u=o.getComputedStyle(a,null),g-=a.scrollTop,f-=a.scrollLeft,a===l&&(g+=a.offsetTop,f+=a.offsetLeft,g+=parseFloat(u.borderTopWidth)||0,f+=parseFloat(u.borderLeftWidth)||0,l=a.offsetParent),p=u;return p.position==="fixed"&&(g+=Math.max(i.scrollTop,s.scrollTop),f+=Math.max(i.scrollLeft,s.scrollLeft)),e.left=f,e.top=g,e.width=n.offsetWidth,e.height=n.offsetHeight,e}function Bi(n,e){if(n.offsetParent===null){e.left=e.right=e.top=e.bottom=0;return}let t=getComputedStyle(n);e.left=parseFloat(t.marginLeft)||0,e.right=parseFloat(t.marginRight)||0,e.top=parseFloat(t.marginTop)||0,e.bottom=parseFloat(t.marginBottom)||0}function Ma(n,e){let t=getComputedStyle(n);e.left=parseFloat(t.borderLeftWidth)||0,e.right=parseFloat(t.borderRightWidth)||0,e.top=parseFloat(t.borderTopWidth)||0,e.bottom=parseFloat(t.borderBottomWidth)||0}function Aa(n,e){let t=getComputedStyle(n);e.left=parseFloat(t.paddingLeft)||0,e.right=parseFloat(t.paddingRight)||0,e.top=parseFloat(t.paddingTop)||0,e.bottom=parseFloat(t.paddingBottom)||0}const qe=document.createElement("div");qe.id="VIEWPORT";qe.style.position="fixed";qe.style.width="100vw";qe.style.height="100vh";qe.style.visibility="hidden";qe.style.pointerEvents="none";function Ra(n,e){const t=n.documentElement,r=n.body,i=getComputedStyle(t),s=getComputedStyle(r);return e.top=r.offsetTop+parseFloat(i.marginTop)||0+parseFloat(s.marginTop)||0,e.left=r.offsetLeft+parseFloat(i.marginLeft)||0+parseFloat(s.marginLeft)||0,e.width=Math.max(Math.max(r.scrollWidth,t.scrollWidth),Math.max(r.offsetWidth,t.offsetWidth),Math.max(r.clientWidth,t.clientWidth)),e.height=Math.max(Math.max(r.scrollHeight,t.scrollHeight),Math.max(r.offsetHeight,t.offsetHeight),Math.max(r.clientHeight,t.clientHeight)),e}function Ba(n){const e=document.createElement("div");e.innerHTML=n;const t=e.firstElementChild;return e.removeChild(t),t}(function(n){function e(){}function t(u,l){if(u=u===void 0?"utf-8":u,l=l===void 0?{fatal:!1}:l,o.indexOf(u.toLowerCase())===-1)throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+u+"') is invalid.");if(l.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(u){return Buffer.from(u.buffer,u.byteOffset,u.byteLength).toString("utf-8")}function i(u){var l=URL.createObjectURL(new Blob([u],{type:"text/plain;charset=UTF-8"}));try{var p=new XMLHttpRequest;return p.open("GET",l,!1),p.send(),p.responseText}catch{return s(u)}finally{URL.revokeObjectURL(l)}}function s(u){for(var l=0,p=Math.min(65536,u.length+1),g=new Uint16Array(p),f=[],h=0;;){var d=l<u.length;if(!d||h>=p-1){if(f.push(String.fromCharCode.apply(null,g.subarray(0,h))),!d)return f.join("");u=u.subarray(l),h=l=0}if(d=u[l++],(d&128)==0)g[h++]=d;else if((d&224)==192){var m=u[l++]&63;g[h++]=(d&31)<<6|m}else if((d&240)==224){m=u[l++]&63;var y=u[l++]&63;g[h++]=(d&31)<<12|m<<6|y}else if((d&248)==240){m=u[l++]&63,y=u[l++]&63;var b=u[l++]&63;d=(d&7)<<18|m<<12|y<<6|b,65535<d&&(d-=65536,g[h++]=d>>>10&1023|55296,d=56320|d&1023),g[h++]=d}}}if(n.TextEncoder&&n.TextDecoder)return!1;var o=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(u,l){if(l=l===void 0?{stream:!1}:l,l.stream)throw Error("Failed to encode: the 'stream' option is unsupported.");l=0;for(var p=u.length,g=0,f=Math.max(32,p+(p>>>1)+7),h=new Uint8Array(f>>>3<<3);l<p;){var d=u.charCodeAt(l++);if(55296<=d&&56319>=d){if(l<p){var m=u.charCodeAt(l);(m&64512)==56320&&(++l,d=((d&1023)<<10)+(m&1023)+65536)}if(55296<=d&&56319>=d)continue}if(g+4>h.length&&(f+=8,f*=1+l/u.length*2,f=f>>>3<<3,m=new Uint8Array(f),m.set(h),h=m),(d&4294967168)==0)h[g++]=d;else{if((d&4294965248)==0)h[g++]=d>>>6&31|192;else if((d&4294901760)==0)h[g++]=d>>>12&15|224,h[g++]=d>>>6&63|128;else if((d&4292870144)==0)h[g++]=d>>>18&7|240,h[g++]=d>>>12&63|128,h[g++]=d>>>6&63|128;else continue;h[g++]=d&63|128}}return h.slice?h.slice(0,g):h.subarray(0,g)},Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1});var a=s;typeof Buffer=="function"&&Buffer.from?a=r:typeof Blob=="function"&&typeof URL=="function"&&typeof URL.createObjectURL=="function"&&(a=i),t.prototype.decode=function(u,l){if(l=l===void 0?{stream:!1}:l,l.stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return u=u instanceof Uint8Array?u:u.buffer instanceof ArrayBuffer?new Uint8Array(u.buffer):new Uint8Array(u),a(u)},n.TextEncoder=e,n.TextDecoder=t})(typeof window!="undefined"?window:typeof Gt!="undefined"?Gt:Gt);var Fn={exports:{}};(function(n){(function(e,t){var r={};t(r);var i=r.default;for(var s in r)i[s]=r[s];n.exports=i})(Gt,function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(f,h,d,m,y){for(var b,_,v,x,w,S,E,T,A,C,N,U,k;y>=64;){for(b=h[0],_=h[1],v=h[2],x=h[3],w=h[4],S=h[5],E=h[6],T=h[7],C=0;C<16;C++)N=m+C*4,f[C]=(d[N]&255)<<24|(d[N+1]&255)<<16|(d[N+2]&255)<<8|d[N+3]&255;for(C=16;C<64;C++)A=f[C-2],U=(A>>>17|A<<32-17)^(A>>>19|A<<32-19)^A>>>10,A=f[C-15],k=(A>>>7|A<<32-7)^(A>>>18|A<<32-18)^A>>>3,f[C]=(U+f[C-7]|0)+(k+f[C-16]|0);for(C=0;C<64;C++)U=(((w>>>6|w<<32-6)^(w>>>11|w<<32-11)^(w>>>25|w<<32-25))+(w&S^~w&E)|0)+(T+(t[C]+f[C]|0)|0)|0,k=((b>>>2|b<<32-2)^(b>>>13|b<<32-13)^(b>>>22|b<<32-22))+(b&_^b&v^_&v)|0,T=E,E=S,S=w,w=x+U|0,x=v,v=_,_=b,b=U+k|0;h[0]+=b,h[1]+=_,h[2]+=v,h[3]+=x,h[4]+=w,h[5]+=S,h[6]+=E,h[7]+=T,m+=64,y-=64}return m}var i=function(){function f(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return f.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},f.prototype.clean=function(){for(var h=0;h<this.buffer.length;h++)this.buffer[h]=0;for(var h=0;h<this.temp.length;h++)this.temp[h]=0;this.reset()},f.prototype.update=function(h,d){if(d===void 0&&(d=h.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this.bytesHashed+=d,this.bufferLength>0){for(;this.bufferLength<64&&d>0;)this.buffer[this.bufferLength++]=h[m++],d--;this.bufferLength===64&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(d>=64&&(m=r(this.temp,this.state,h,m,d),d%=64);d>0;)this.buffer[this.bufferLength++]=h[m++],d--;return this},f.prototype.finish=function(h){if(!this.finished){var d=this.bytesHashed,m=this.bufferLength,y=d/536870912|0,b=d<<3,_=d%64<56?64:128;this.buffer[m]=128;for(var v=m+1;v<_-8;v++)this.buffer[v]=0;this.buffer[_-8]=y>>>24&255,this.buffer[_-7]=y>>>16&255,this.buffer[_-6]=y>>>8&255,this.buffer[_-5]=y>>>0&255,this.buffer[_-4]=b>>>24&255,this.buffer[_-3]=b>>>16&255,this.buffer[_-2]=b>>>8&255,this.buffer[_-1]=b>>>0&255,r(this.temp,this.state,this.buffer,0,_),this.finished=!0}for(var v=0;v<8;v++)h[v*4+0]=this.state[v]>>>24&255,h[v*4+1]=this.state[v]>>>16&255,h[v*4+2]=this.state[v]>>>8&255,h[v*4+3]=this.state[v]>>>0&255;return this},f.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},f.prototype._saveState=function(h){for(var d=0;d<this.state.length;d++)h[d]=this.state[d]},f.prototype._restoreState=function(h,d){for(var m=0;m<this.state.length;m++)this.state[m]=h[m];this.bytesHashed=d,this.finished=!1,this.bufferLength=0},f}();e.Hash=i;var s=function(){function f(h){this.inner=new i,this.outer=new i,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var d=new Uint8Array(this.blockSize);if(h.length>this.blockSize)new i().update(h).finish(d).clean();else for(var m=0;m<h.length;m++)d[m]=h[m];for(var m=0;m<d.length;m++)d[m]^=54;this.inner.update(d);for(var m=0;m<d.length;m++)d[m]^=54^92;this.outer.update(d),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var m=0;m<d.length;m++)d[m]=0}return f.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},f.prototype.clean=function(){for(var h=0;h<this.istate.length;h++)this.ostate[h]=this.istate[h]=0;this.inner.clean(),this.outer.clean()},f.prototype.update=function(h){return this.inner.update(h),this},f.prototype.finish=function(h){return this.outer.finished?this.outer.finish(h):(this.inner.finish(h),this.outer.update(h,this.digestLength).finish(h)),this},f.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},f}();e.HMAC=s;function o(f){var h=new i().update(f),d=h.digest();return h.clean(),d}e.hash=o,e.default=o;function a(f,h){var d=new s(f).update(h),m=d.digest();return d.clean(),m}e.hmac=a;function u(f,h,d,m){var y=m[0];if(y===0)throw new Error("hkdf: cannot expand more");h.reset(),y>1&&h.update(f),d&&h.update(d),h.update(m),h.finish(f),m[0]++}var l=new Uint8Array(e.digestLength);function p(f,h,d,m){h===void 0&&(h=l),m===void 0&&(m=32);for(var y=new Uint8Array([1]),b=a(h,f),_=new s(b),v=new Uint8Array(_.digestLength),x=v.length,w=new Uint8Array(m),S=0;S<m;S++)x===v.length&&(u(v,_,d,y),x=0),w[S]=v[x++];return _.clean(),v.fill(0),y.fill(0),w}e.hkdf=p;function g(f,h,d,m){for(var y=new s(f),b=y.digestLength,_=new Uint8Array(4),v=new Uint8Array(b),x=new Uint8Array(b),w=new Uint8Array(m),S=0;S*b<m;S++){var E=S+1;_[0]=E>>>24&255,_[1]=E>>>16&255,_[2]=E>>>8&255,_[3]=E>>>0&255,y.reset(),y.update(h),y.update(_),y.finish(x);for(var T=0;T<b;T++)v[T]=x[T];for(var T=2;T<=d;T++){y.reset(),y.update(x).finish(x);for(var A=0;A<b;A++)v[A]^=x[A]}for(var T=0;T<b&&S*b+T<m;T++)w[S*b+T]=v[T]}for(var S=0;S<b;S++)v[S]=x[S]=0;for(var S=0;S<4;S++)_[S]=0;return y.clean(),w}e.pbkdf2=g})})(Fn);function Ca(n){return n.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g,"")}function Ci(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Ia(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function mt(n,e){return" "+n+'="'+Ci(e)+'"'}function Da(n,e){return!n.hasAttribute("xmlns")&&(e||n.namespaceURI!==n.parentElement.namespaceURI)?' xmlns="'+n.namespaceURI+'"':""}async function Ii(n,e){let t=[];for(const r of n.childNodes)t.push(Di(r,e));return Promise.all(t).then(r=>r.join(""))}async function Oa(n,e){const t=n.tagName.toLowerCase();let r="<"+t;r+=Da(n,e.depth===0);const i=Ii(n,e);for(const s of n.attributes)s.name==="src"?r+=mt(s.name,await M.getDataURL(s.value)):r+=mt(s.name,s.value);return n.childNodes.length>0?(e.depth++,r+=">",r+=await i,r+="</"+t+">",e.depth--):r+="/>",r}function La(n){var e=n.nodeValue||"";return Ia(e)}function za(n){return"<![CDATA["+n.nodeValue+"]]>"}async function Di(n,e){var r;const t=(r=e.replacer)==null?void 0:r.call(e,n);if(typeof t=="string")return t;if(n.nodeName==="#document"||n.nodeName==="#document-fragment")return Ii(n,e);if(n.tagName)return Oa(n,e);if(n.nodeName==="#text")return La(n);if(n.nodeName!=="#comment"){if(n.nodeName==="#cdata-section")return za(n)}return""}async function ka(n,e){return Ca(await Di(n,{depth:0,replacer:e}))}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var P=function(){return P=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},P.apply(this,arguments)};function Vn(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var K=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,H=Object.keys,X=Array.isArray;typeof Promise!="undefined"&&!K.Promise&&(K.Promise=Promise);function te(n,e){return typeof e!="object"||H(e).forEach(function(t){n[t]=e[t]}),n}var yt=Object.getPrototypeOf,Pa={}.hasOwnProperty;function le(n,e){return Pa.call(n,e)}function Ye(n,e){typeof e=="function"&&(e=e(yt(n))),(typeof Reflect=="undefined"?H:Reflect.ownKeys)(e).forEach(function(t){Se(n,t,e[t])})}var Oi=Object.defineProperty;function Se(n,e,t,r){Oi(n,e,te(t&&le(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function Xe(n){return{from:function(e){return n.prototype=Object.create(e.prototype),Se(n.prototype,"constructor",n),{extend:Ye.bind(null,n.prototype)}}}}var Na=Object.getOwnPropertyDescriptor;function jn(n,e){var t=Na(n,e),r;return t||(r=yt(n))&&jn(r,e)}var Ua=[].slice;function nn(n,e,t){return Ua.call(n,e,t)}function Li(n,e){return e(n)}function vt(n){if(!n)throw new Error("Assertion Failed")}function zi(n){K.setImmediate?setImmediate(n):setTimeout(n,0)}function ki(n,e){return n.reduce(function(t,r,i){var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function Fa(n,e,t){try{n.apply(null,t)}catch(r){e&&e(r)}}function Te(n,e){if(le(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=Te(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a===void 0?void 0:Te(a,e.substr(o+1))}}function pe(n,e,t){if(!(!n||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){vt(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)pe(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")t===void 0?X(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var u=n[o];u||(u=n[o]={}),pe(u,a,t)}}else t===void 0?X(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function Va(n,e){typeof e=="string"?pe(n,e,void 0):"length"in e&&[].map.call(e,function(t){pe(n,t,void 0)})}function Pi(n){var e={};for(var t in n)le(n,t)&&(e[t]=n[t]);return e}var ja=[].concat;function Ni(n){return ja.apply([],n)}var Ui="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ni([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(e){return e+n+"Array"})}))).filter(function(n){return K[n]}),Ka=Ui.map(function(n){return K[n]});ki(Ui,function(n){return[n,!0]});var Oe=null;function wt(n){Oe=typeof WeakMap!="undefined"&&new WeakMap;var e=Kn(n);return Oe=null,e}function Kn(n){if(!n||typeof n!="object")return n;var e=Oe&&Oe.get(n);if(e)return e;if(X(n)){e=[],Oe&&Oe.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(Kn(n[t]))}else if(Ka.indexOf(n.constructor)>=0)e=n;else{var i=yt(n);e=i===Object.prototype?{}:Object.create(i),Oe&&Oe.set(n,e);for(var s in n)le(n,s)&&(e[s]=Kn(n[s]))}return e}var Wa={}.toString;function Wn(n){return Wa.call(n).slice(8,-1)}var Hn=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Ha=typeof Hn=="symbol"?function(n){var e;return n!=null&&(e=n[Hn])&&e.apply(n)}:function(){return null},Je={};function Ee(n){var e,t,r,i;if(arguments.length===1){if(X(n))return n.slice();if(this===Je&&typeof n=="string")return[n];if(i=Ha(n)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(n==null)return[n];if(e=n.length,typeof e=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}var Gn=typeof Symbol!="undefined"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ye=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Fi(n,e){ye=n,Vi=e}var Vi=function(){return!0},Ga=!new Error("").stack;function Ve(){if(Ga)try{throw Ve.arguments,new Error}catch(n){return n}return new Error}function Qn(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(Vi).map(function(r){return`
`+r}).join("")):""}var Qa=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],ji=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],$n=Qa.concat(ji),$a={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ze(n,e){this._e=Ve(),this.name=n,this.message=e}Xe(Ze).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Qn(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Ki(n,e){return n+". Errors: "+Object.keys(e).map(function(t){return e[t].toString()}).filter(function(t,r,i){return i.indexOf(t)===r}).join(`
`)}function rn(n,e,t,r){this._e=Ve(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=Ki(n,e)}Xe(rn).from(Ze);function bt(n,e){this._e=Ve(),this.name="BulkError",this.failures=Object.keys(e).map(function(t){return e[t]}),this.failuresByPos=e,this.message=Ki(n,e)}Xe(bt).from(Ze);var qa=$n.reduce(function(n,e){return n[e]=e+"Error",n},{}),Ya=Ze,O=$n.reduce(function(n,e){var t=e+"Error";function r(i,s){this._e=Ve(),this.name=t,i?typeof i=="string"?(this.message=""+i+(s?`
 `+s:""),this.inner=s||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=$a[e]||t,this.inner=null)}return Xe(r).from(Ya),n[e]=r,n},{});O.Syntax=SyntaxError;O.Type=TypeError;O.Range=RangeError;var Wi=ji.reduce(function(n,e){return n[e+"Error"]=O[e],n},{});function Xa(n,e){if(!n||n instanceof Ze||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Wi[n.name])return n;var t=new Wi[n.name](e||n.message,n);return"stack"in n&&Se(t,"stack",{get:function(){return this.inner.stack}}),t}var sn=$n.reduce(function(n,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=O[e]),n},{});sn.ModifyError=rn;sn.DexieError=Ze;sn.BulkError=bt;function V(){}function _t(n){return n}function Ja(n,e){return n==null||n===_t?e:function(t){return e(n(t))}}function je(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function Za(n,e){return n===V?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?je(r,this.onsuccess):r),i&&(this.onerror=this.onerror?je(i,this.onerror):i),s!==void 0?s:t}}function eu(n,e){return n===V?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?je(t,this.onsuccess):t),r&&(this.onerror=this.onerror?je(r,this.onerror):r)}}function tu(n,e){return n===V?e:function(t){var r=n.apply(this,arguments);te(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?je(i,this.onsuccess):i),s&&(this.onerror=this.onerror?je(s,this.onerror):s),r===void 0?o===void 0?void 0:o:te(r,o)}}function nu(n,e){return n===V?e:function(){return e.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function qn(n,e){return n===V?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var xt={},ru=100,iu=20,Hi=100,Yn=typeof Promise=="undefined"?[]:function(){var n=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[n,yt(n),n];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,yt(e),n]}(),Xn=Yn[0],on=Yn[1],Jn=Yn[2],Gi=on&&on.then,an=Xn&&Xn.constructor,Zn=!!Jn,er=!1,su=Jn?function(){Jn.then(hn)}:K.setImmediate?setImmediate.bind(null,hn):K.MutationObserver?function(){var n=document.createElement("div");new MutationObserver(function(){hn(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:function(){setTimeout(hn,0)},St=function(n,e){Tt.push([n,e]),un&&(su(),un=!1)},tr=!0,un=!0,Ke=[],cn=[],nr=null,rr=_t,et={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ns,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(n){try{ns(n[0],n[1])}catch{}})}},I=et,Tt=[],We=0,ln=[];function R(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=V,this._lib=!1;var e=this._PSD=I;if(ye&&(this._stackHolder=Ve(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==xt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&sr(this,this._value);return}this._state=null,this._value=null,++e.ref,$i(this,n)}var ir={get:function(){var n=I,e=pn;function t(r,i){var s=this,o=!n.global&&(n!==I||e!==pn),a=o&&!Me(),u=new R(function(l,p){or(s,new Qi(mn(r,n,o,a),mn(i,n,o,a),l,p,n))});return ye&&Xi(u,this),u}return t.prototype=xt,t},set:function(n){Se(this,"then",n&&n.prototype===xt?ir:{get:function(){return n},set:ir.set})}};Ye(R.prototype,{then:ir,_then:function(n,e){or(this,new Qi(null,null,n,e,I))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?t(r):fn(r)}):this.then(null,function(r){return r&&r.name===e?t(r):fn(r)})},finally:function(n){return this.then(function(e){return n(),e},function(e){return n(),fn(e)})},stack:{get:function(){if(this._stack)return this._stack;try{er=!0;var n=Yi(this,[],iu),e=n.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{er=!1}}},timeout:function(n,e){var t=this;return n<1/0?new R(function(r,i){var s=setTimeout(function(){return i(new O.Timeout(e))},n);t.then(r,i).finally(clearTimeout.bind(null,s))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Se(R.prototype,Symbol.toStringTag,"Dexie.Promise");et.env=Ji();function Qi(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}Ye(R,{all:function(){var n=Ee.apply(null,arguments).map(gn);return new R(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach(function(i,s){return R.resolve(i).then(function(o){n[s]=o,--r||e(n)},t)})})},resolve:function(n){if(n instanceof R)return n;if(n&&typeof n.then=="function")return new R(function(t,r){n.then(t,r)});var e=new R(xt,!0,n);return Xi(e,nr),e},reject:fn,race:function(){var n=Ee.apply(null,arguments).map(gn);return new R(function(e,t){n.map(function(r){return R.resolve(r).then(e,t)})})},PSD:{get:function(){return I},set:function(n){return I=n}},totalEchoes:{get:function(){return pn}},newPSD:Le,usePSD:nt,scheduler:{get:function(){return St},set:function(n){St=n}},rejectionMapper:{get:function(){return rr},set:function(n){rr=n}},follow:function(n,e){return new R(function(t,r){return Le(function(i,s){var o=I;o.unhandleds=[],o.onunhandled=s,o.finalize=je(function(){var a=this;au(function(){a.unhandleds.length===0?i():s(a.unhandleds[0])})},o.finalize),n()},e,t,r)})}});an&&(an.allSettled&&Se(R,"allSettled",function(){var n=Ee.apply(null,arguments).map(gn);return new R(function(e){n.length===0&&e([]);var t=n.length,r=new Array(t);n.forEach(function(i,s){return R.resolve(i).then(function(o){return r[s]={status:"fulfilled",value:o}},function(o){return r[s]={status:"rejected",reason:o}}).then(function(){return--t||e(r)})})})}),an.any&&typeof AggregateError!="undefined"&&Se(R,"any",function(){var n=Ee.apply(null,arguments).map(gn);return new R(function(e,t){n.length===0&&t(new AggregateError([]));var r=n.length,i=new Array(r);n.forEach(function(s,o){return R.resolve(s).then(function(a){return e(a)},function(a){i[o]=a,--r||t(new AggregateError(i))})})})}));function $i(n,e){try{e(function(t){if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&Et();t&&typeof t.then=="function"?$i(n,function(i,s){t instanceof R?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,qi(n)),r&&Mt()}},sr.bind(null,n))}catch(t){sr(n,t)}}function sr(n,e){if(cn.push(e),n._state===null){var t=n._lib&&Et();e=rr(e),n._state=!1,n._value=e,ye&&e!==null&&typeof e=="object"&&!e._promise&&Fa(function(){var r=jn(e,"stack");e._promise=n,Se(e,"stack",{get:function(){return er?r&&(r.get?r.get.apply(e):r.value):n.stack}})}),uu(n),qi(n),t&&Mt()}}function qi(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)or(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),We===0&&(++We,St(function(){--We==0&&ar()},[]))}function or(n,e){if(n._state===null){n._listeners.push(e);return}var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++We,St(ou,[t,n,e])}function ou(n,e,t){try{nr=e;var r,i=e._value;e._state?r=n(i):(cn.length&&(cn=[]),r=n(i),cn.indexOf(i)===-1&&cu(e)),t.resolve(r)}catch(s){t.reject(s)}finally{nr=null,--We==0&&ar(),--t.psd.ref||t.psd.finalize()}}function Yi(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i=n._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=Qn(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return ye&&(r=Qn(n._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),n._prev&&Yi(n._prev,e,t)),e}function Xi(n,e){var t=e?e._numPrev+1:0;t<ru&&(n._prev=e,n._numPrev=t)}function hn(){Et()&&Mt()}function Et(){var n=tr;return tr=!1,un=!1,n}function Mt(){var n,e,t;do for(;Tt.length>0;)for(n=Tt,Tt=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(Tt.length>0);tr=!0,un=!0}function ar(){var n=Ke;Ke=[],n.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=ln.slice(0),t=e.length;t;)e[--t]()}function au(n){function e(){n(),ln.splice(ln.indexOf(e),1)}ln.push(e),++We,St(function(){--We==0&&ar()},[])}function uu(n){Ke.some(function(e){return e._value===n._value})||Ke.push(n)}function cu(n){for(var e=Ke.length;e;)if(Ke[--e]._value===n._value){Ke.splice(e,1);return}}function fn(n){return new R(xt,!1,n)}function W(n,e){var t=I;return function(){var r=Et(),i=I;try{return ze(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{ze(i,!1),r&&Mt()}}}var J={awaits:0,echoes:0,id:0},lu=0,dn=[],ur=0,pn=0,hu=0;function Le(n,e,t,r){var i=I,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++hu;var o=et.env;s.env=Zn?{Promise:R,PromiseProp:{value:R,configurable:!0,writable:!0},all:R.all,race:R.race,allSettled:R.allSettled,any:R.any,resolve:R.resolve,reject:R.reject,nthen:es(o.nthen,s),gthen:es(o.gthen,s)}:{},e&&te(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=nt(s,n,t,r);return s.ref===0&&s.finalize(),a}function tt(){return J.id||(J.id=++lu),++J.awaits,J.echoes+=Hi,J.id}function Me(){return J.awaits?(--J.awaits==0&&(J.id=0),J.echoes=J.awaits*Hi,!0):!1}(""+Gi).indexOf("[native code]")===-1&&(tt=Me=V);function gn(n){return J.echoes&&n&&n.constructor===an?(tt(),n.then(function(e){return Me(),e},function(e){return Me(),$(e)})):n}function fu(n){++pn,(!J.echoes||--J.echoes==0)&&(J.echoes=J.id=0),dn.push(I),ze(n,!0)}function du(){var n=dn[dn.length-1];dn.pop(),ze(n,!1)}function ze(n,e){var t=I;if((e?J.echoes&&(!ur++||n!==I):ur&&(!--ur||n!==I))&&Zi(e?fu.bind(null,n):du),n!==I&&(I=n,t===et&&(et.env=Ji()),Zn)){var r=et.env.Promise,i=n.env;on.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(K,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Ji(){var n=K.Promise;return Zn?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(K,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:on.then,gthen:n.prototype.then}:{}}function nt(n,e,t,r,i){var s=I;try{return ze(n,!0),e(t,r,i)}finally{ze(s,!1)}}function Zi(n){Gi.call(Xn,n)}function mn(n,e,t,r){return typeof n!="function"?n:function(){var i=I;t&&tt(),ze(e,!0);try{return n.apply(this,arguments)}finally{ze(i,!1),r&&Zi(Me)}}}function es(n,e){return function(t,r){return n.call(this,mn(t,e),mn(r,e))}}var ts="unhandledrejection";function ns(n,e){var t;try{t=e.onuncatched(n)}catch{}if(t!==!1)try{var r,i={promise:e,reason:n};if(K.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(ts,!0,!0),te(r,i)):K.CustomEvent&&(r=new CustomEvent(ts,{detail:i}),te(r,i)),r&&K.dispatchEvent&&(dispatchEvent(r),!K.PromiseRejectionEvent&&K.onunhandledrejection))try{K.onunhandledrejection(r)}catch{}ye&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(n.stack||n))}catch{}}var $=R.reject;function rs(n,e,t,r){if(!n.idbdb||!n._state.openComplete&&!I.letThrough&&!n._vip){if(n._state.openComplete)return $(new O.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return $(new O.DatabaseClosed);n.open().catch(V)}return n._state.dbReadyPromise.then(function(){return rs(n,e,t,r)})}else{var i=n._createTransaction(e,t,n._dbSchema);try{i.create()}catch(s){return $(s)}return i._promise(e,function(s,o){return Le(function(){return I.trans=i,r(s,o,i)})}).then(function(s){return i._completion.then(function(){return s})})}}var is="3.2.0",He=String.fromCharCode(65535),cr=-1/0,Ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ss="String expected.",At=[],yn=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),pu=yn,gu=yn,os=function(n){return!/(dexie\.js|dexie\.min\.js)/.test(n)},vn="__dbnames",lr="readonly",hr="readwrite";function Ge(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}var as={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function wn(n){return typeof n=="string"&&!/\./.test(n)?function(e){return e[n]===void 0&&n in e&&(e=wt(e),delete e[n]),e}:function(e){return e}}var mu=function(){function n(){}return n.prototype._trans=function(e,t,r){var i=this._tx||I.trans,s=this.name;function o(u,l,p){if(!p.schema[s])throw new O.NotFound("Table "+s+" not part of transaction");return t(p.idbtrans,p)}var a=Et();try{return i&&i.db===this.db?i===I.trans?i._promise(e,o,r):Le(function(){return i._promise(e,o,r)},{trans:i,transless:I.transless||I}):rs(this.db,e,[this.name],o)}finally{a&&Mt()}},n.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(s){return r.hook.reading.fire(s)})}).then(t)},n.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(X(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var t=H(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(p){return p.compound&&t.every(function(g){return p.keyPath.indexOf(g)>=0})&&p.keyPath.every(function(g){return t.indexOf(g)>=0})})[0];if(r&&this.db._maxKey!==He)return this.where(r.name).equals(r.keyPath.map(function(p){return e[p]}));!r&&ye&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+t.join("+")+"]"));var i=this.schema.idxByName,s=this.db._deps.indexedDB;function o(p,g){try{return s.cmp(p,g)===0}catch{return!1}}var a=t.reduce(function(p,g){var f=p[0],h=p[1],d=i[g],m=e[g];return[f||d,f||!d?Ge(h,d&&d.multi?function(y){var b=Te(y,g);return X(b)&&b.some(function(_){return o(m,_)})}:function(y){return o(m,Te(y,g))}):h]},[null,null]),u=a[0],l=a[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):r?this.filter(l):this.where(t).equals("")},n.prototype.filter=function(e){return this.toCollection().and(e)},n.prototype.count=function(e){return this.toCollection().count(e)},n.prototype.offset=function(e){return this.toCollection().offset(e)},n.prototype.limit=function(e){return this.toCollection().limit(e)},n.prototype.each=function(e){return this.toCollection().each(e)},n.prototype.toArray=function(e){return this.toCollection().toArray(e)},n.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},n.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,X(e)?"["+e.join("+")+"]":e))},n.prototype.reverse=function(){return this.toCollection().reverse()},n.prototype.mapToClass=function(e){this.schema.mappedClass=e;var t=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var s in r)if(le(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e},n.prototype.defineClass=function(){function e(t){te(this,t)}return this.mapToClass(e)},n.prototype.add=function(e,t){var r=this,i=this.schema.primKey,s=i.auto,o=i.keyPath,a=e;return o&&s&&(a=wn(o)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:t!=null?[t]:null,values:[a]})}).then(function(u){return u.numFailures?R.reject(u.failures[0]):u.lastResult}).then(function(u){if(o)try{pe(e,o,u)}catch{}return u})},n.prototype.update=function(e,t){if(typeof e=="object"&&!X(e)){var r=Te(e,this.schema.primKey.keyPath);if(r===void 0)return $(new O.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?H(t).forEach(function(i){pe(e,i,t[i])}):t(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(e).modify(t)},n.prototype.put=function(e,t){var r=this,i=this.schema.primKey,s=i.auto,o=i.keyPath,a=e;return o&&s&&(a=wn(o)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[a],keys:t!=null?[t]:null})}).then(function(u){return u.numFailures?R.reject(u.failures[0]):u.lastResult}).then(function(u){if(o)try{pe(e,o,u)}catch{}return u})},n.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?R.reject(r.failures[0]):void 0})},n.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:as})}).then(function(t){return t.numFailures?R.reject(t.failures[0]):void 0})},n.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(s){return t.hook.reading.fire(s)})})})},n.prototype.bulkAdd=function(e,t,r){var i=this,s=Array.isArray(t)?t:void 0;r=r||(s?void 0:t);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(a){var u=i.schema.primKey,l=u.auto,p=u.keyPath;if(p&&s)throw new O.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,f=p&&l?e.map(wn(p)):e;return i.core.mutate({trans:a,type:"add",keys:s,values:f,wantResults:o}).then(function(h){var d=h.numFailures,m=h.results,y=h.lastResult,b=h.failures,_=o?m:y;if(d===0)return _;throw new bt(i.name+".bulkAdd(): "+d+" of "+g+" operations failed",b)})})},n.prototype.bulkPut=function(e,t,r){var i=this,s=Array.isArray(t)?t:void 0;r=r||(s?void 0:t);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(a){var u=i.schema.primKey,l=u.auto,p=u.keyPath;if(p&&s)throw new O.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");var g=e.length,f=p&&l?e.map(wn(p)):e;return i.core.mutate({trans:a,type:"put",keys:s,values:f,wantResults:o}).then(function(h){var d=h.numFailures,m=h.results,y=h.lastResult,b=h.failures,_=o?m:y;if(d===0)return _;throw new bt(i.name+".bulkPut(): "+d+" of "+g+" operations failed",b)})})},n.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var s=i.numFailures,o=i.lastResult,a=i.failures;if(s===0)return o;throw new bt(t.name+".bulkDelete(): "+s+" of "+r+" operations failed",a)})},n}();function Rt(n){var e={},t=function(a,u){if(u){for(var l=arguments.length,p=new Array(l-1);--l;)p[l-1]=arguments[l];return e[a].subscribe.apply(null,p),n}else if(typeof a=="string")return e[a]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(a,u,l){if(typeof a=="object")return o(a);u||(u=nu),l||(l=V);var p={subscribers:[],fire:l,subscribe:function(g){p.subscribers.indexOf(g)===-1&&(p.subscribers.push(g),p.fire=u(p.fire,g))},unsubscribe:function(g){p.subscribers=p.subscribers.filter(function(f){return f!==g}),p.fire=p.subscribers.reduce(u,l)}};return e[a]=t[a]=p,p}function o(a){H(a).forEach(function(u){var l=a[u];if(X(l))s(u,a[u][0],a[u][1]);else if(l==="asap")var p=s(u,_t,function(){for(var f=arguments.length,h=new Array(f);f--;)h[f]=arguments[f];p.subscribers.forEach(function(d){zi(function(){d.apply(null,h)})})});else throw new O.InvalidArgument("Invalid event config")})}}function Bt(n,e){return Xe(e).from({prototype:n}),e}function yu(n){return Bt(mu.prototype,function(t,r,i){this.db=n,this._tx=i,this.name=t,this.schema=r,this.hook=n._allTables[t]?n._allTables[t].hook:Rt(null,{creating:[Za,V],reading:[Ja,_t],updating:[tu,V],deleting:[eu,V]})})}function rt(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function fr(n,e){n.filter=Ge(n.filter,e)}function dr(n,e,t){var r=n.replayFilter;n.replayFilter=r?function(){return Ge(r(),e())}:e,n.justLimit=t&&!r}function vu(n,e){n.isMatch=Ge(n.isMatch,e)}function bn(n,e){if(n.isPrimKey)return e.primaryKey;var t=e.getIndexByKeyPath(n.index);if(!t)throw new O.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function us(n,e,t){var r=bn(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function _n(n,e,t,r){var i=n.replayFilter?Ge(n.filter,n.replayFilter()):n.filter;if(n.or){var s={},o=function(a,u,l){if(!i||i(u,l,function(f){return u.stop(f)},function(f){return u.fail(f)})){var p=u.primaryKey,g=""+p;g==="[object ArrayBuffer]"&&(g=""+new Uint8Array(p)),le(s,g)||(s[g]=!0,e(a,u,l))}};return Promise.all([n.or._iterate(o,t),cs(us(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}else return cs(us(n,r,t),Ge(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function cs(n,e,t,r){var i=r?function(o,a,u){return t(r(o),a,u)}:t,s=W(i);return n.then(function(o){if(o)return o.start(function(){var a=function(){return o.continue()};(!e||e(o,function(u){return a=u},function(u){o.stop(u),a=V},function(u){o.fail(u),a=V}))&&s(o.value,o,function(u){return a=u}),a()})})}function ne(n,e){try{var t=ls(n),r=ls(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return bu(hs(n),hs(e));case"Array":return wu(n,e)}}catch{}return NaN}function wu(n,e){for(var t=n.length,r=e.length,i=t<r?t:r,s=0;s<i;++s){var o=ne(n[s],e[s]);if(o!==0)return o}return t===r?0:t<r?-1:1}function bu(n,e){for(var t=n.length,r=e.length,i=t<r?t:r,s=0;s<i;++s)if(n[s]!==e[s])return n[s]<e[s]?-1:1;return t===r?0:t<r?-1:1}function ls(n){var e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";var t=Wn(n);return t==="ArrayBuffer"?"binary":t}function hs(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var _u=function(){function n(){}return n.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,$.bind(null,r.error)):r.table._trans("readonly",e).then(t)},n.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,$.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},n.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Ge(t.algorithm,e)},n.prototype._iterate=function(e,t){return _n(this._ctx,e,t,this._ctx.table.core)},n.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&te(r,e),t._ctx=r,t},n.prototype.raw=function(){return this._ctx.valueMapper=null,this},n.prototype.each=function(e){var t=this._ctx;return this._read(function(r){return _n(t,e,r,t.table.core)})},n.prototype.count=function(e){var t=this;return this._read(function(r){var i=t._ctx,s=i.table.core;if(rt(i,!0))return s.count({trans:r,query:{index:bn(i,s.schema),range:i.range}}).then(function(a){return Math.min(a,i.limit)});var o=0;return _n(i,function(){return++o,!1},r,s).then(function(){return o})}).then(e)},n.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(l,p){return p?o(l[r[p]],p-1):l[i]}var a=this._ctx.dir==="next"?1:-1;function u(l,p){var g=o(l,s),f=o(p,s);return g<f?-a:g>f?a:0}return this.toArray(function(l){return l.sort(u)}).then(t)},n.prototype.toArray=function(e){var t=this;return this._read(function(r){var i=t._ctx;if(i.dir==="next"&&rt(i,!0)&&i.limit>0){var s=i.valueMapper,o=bn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:o,range:i.range}}).then(function(u){var l=u.result;return s?l.map(s):l})}else{var a=[];return _n(i,function(u){return a.push(u)},r,i.table.core).then(function(){return a})}},e)},n.prototype.offset=function(e){var t=this._ctx;return e<=0?this:(t.offset+=e,rt(t)?dr(t,function(){var r=e;return function(i,s){return r===0?!0:r===1?(--r,!1):(s(function(){i.advance(r),r=0}),!1)}}):dr(t,function(){var r=e;return function(){return--r<0}}),this)},n.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),dr(this._ctx,function(){var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this},n.prototype.until=function(e,t){return fr(this._ctx,function(r,i,s){return e(r.value)?(i(s),t):!0}),this},n.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},n.prototype.last=function(e){return this.reverse().first(e)},n.prototype.filter=function(e){return fr(this._ctx,function(t){return e(t.value)}),vu(this._ctx,e),this},n.prototype.and=function(e){return this.filter(e)},n.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},n.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},n.prototype.desc=function(){return this.reverse()},n.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})},n.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},n.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},n.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)},n.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&rt(t,!0)&&t.limit>0)return this._read(function(i){var s=bn(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(function(i){var s=i.result;return s}).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)},n.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},n.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},n.prototype.lastKey=function(e){return this.reverse().firstKey(e)},n.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return fr(this._ctx,function(i){var s=i.primaryKey.toString(),o=le(r,s);return r[s]=!0,!o}),this},n.prototype.modify=function(e){var t=this,r=this._ctx;return this._write(function(i){var s;if(typeof e=="function")s=e;else{var o=H(e),a=o.length;s=function(b){for(var _=!1,v=0;v<a;++v){var x=o[v],w=e[x];Te(b,x)!==w&&(pe(b,x,w),_=!0)}return _}}var u=r.table.core,l=u.schema.primaryKey,p=l.outbound,g=l.extractKey,f=t.db._options.modifyChunkSize||200,h=[],d=0,m=[],y=function(b,_){var v=_.failures,x=_.numFailures;d+=b-x;for(var w=0,S=H(v);w<S.length;w++){var E=S[w];h.push(v[E])}};return t.clone().primaryKeys().then(function(b){var _=function(v){var x=Math.min(f,b.length-v);return u.getMany({trans:i,keys:b.slice(v,v+x),cache:"immutable"}).then(function(w){for(var S=[],E=[],T=p?[]:null,A=[],C=0;C<x;++C){var N=w[C],U={value:wt(N),primKey:b[v+C]};s.call(U,U.value,U)!==!1&&(U.value==null?A.push(b[v+C]):!p&&ne(g(N),g(U.value))!==0?(A.push(b[v+C]),S.push(U.value)):(E.push(U.value),p&&T.push(b[v+C])))}var k=rt(r)&&r.limit===1/0&&(typeof e!="function"||e===pr)&&{index:r.index,range:r.range};return Promise.resolve(S.length>0&&u.mutate({trans:i,type:"add",values:S}).then(function(Y){for(var L in Y.failures)A.splice(parseInt(L),1);y(S.length,Y)})).then(function(){return(E.length>0||k&&typeof e=="object")&&u.mutate({trans:i,type:"put",keys:T,values:E,criteria:k,changeSpec:typeof e!="function"&&e}).then(function(Y){return y(E.length,Y)})}).then(function(){return(A.length>0||k&&e===pr)&&u.mutate({trans:i,type:"delete",keys:A,criteria:k}).then(function(Y){return y(A.length,Y)})}).then(function(){return b.length>v+x&&_(v+f)})})};return _(0).then(function(){if(h.length>0)throw new rn("Error modifying one or more objects",h,d,m);return b.length})})})},n.prototype.delete=function(){var e=this._ctx,t=e.range;return rt(e)&&(e.isPrimKey&&!gu||t.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(function(o){return e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(function(a){var u=a.failures;a.lastResult,a.results;var l=a.numFailures;if(l)throw new rn("Could not delete some values",Object.keys(u).map(function(p){return u[p]}),o-l);return o-l})})}):this.modify(pr)},n}(),pr=function(n,e){return e.value=null};function xu(n){return Bt(_u.prototype,function(t,r){this.db=n;var i=as,s=null;if(r)try{i=r()}catch(l){s=l}var o=t._ctx,a=o.table,u=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:u!==_t?u:null}})}function Su(n,e){return n<e?-1:n===e?0:1}function Tu(n,e){return n>e?-1:n===e?0:1}function re(n,e,t){var r=n instanceof ds?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function it(n){return new n.Collection(n,function(){return fs("")}).limit(0)}function Eu(n){return n==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function Mu(n){return n==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function Au(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),a=-1,u=0;u<o;++u){var l=e[u];if(l!==r[u])return i(n[u],t[u])<0?n.substr(0,u)+t[u]+t.substr(u+1):i(n[u],r[u])<0?n.substr(0,u)+r[u]+t.substr(u+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;i(n[u],l)<0&&(a=u)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+r[a]+t.substr(a+1)}function xn(n,e,t,r){var i,s,o,a,u,l,p,g=t.length;if(!t.every(function(m){return typeof m=="string"}))return re(n,ss);function f(m){i=Eu(m),s=Mu(m),o=m==="next"?Su:Tu;var y=t.map(function(b){return{lower:s(b),upper:i(b)}}).sort(function(b,_){return o(b.lower,_.lower)});a=y.map(function(b){return b.upper}),u=y.map(function(b){return b.lower}),l=m,p=m==="next"?"":r}f("next");var h=new n.Collection(n,function(){return ke(a[0],u[g-1]+r)});h._ondirectionchange=function(m){f(m)};var d=0;return h._addAlgorithm(function(m,y,b){var _=m.key;if(typeof _!="string")return!1;var v=s(_);if(e(v,u,d))return!0;for(var x=null,w=d;w<g;++w){var S=Au(_,v,a[w],u[w],o,l);S===null&&x===null?d=w+1:(x===null||o(x,S)>0)&&(x=S)}return y(x!==null?function(){m.continue(x+p)}:b),!1}),h}function ke(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function fs(n){return{type:1,lower:n,upper:n}}var ds=function(){function n(){}return Object.defineProperty(n.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),n.prototype.between=function(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&!(r&&i)?it(this):new this.Collection(this,function(){return ke(e,t,!r,!i)})}catch{return re(this,Ae)}},n.prototype.equals=function(e){return e==null?re(this,Ae):new this.Collection(this,function(){return fs(e)})},n.prototype.above=function(e){return e==null?re(this,Ae):new this.Collection(this,function(){return ke(e,void 0,!0)})},n.prototype.aboveOrEqual=function(e){return e==null?re(this,Ae):new this.Collection(this,function(){return ke(e,void 0,!1)})},n.prototype.below=function(e){return e==null?re(this,Ae):new this.Collection(this,function(){return ke(void 0,e,!1,!0)})},n.prototype.belowOrEqual=function(e){return e==null?re(this,Ae):new this.Collection(this,function(){return ke(void 0,e)})},n.prototype.startsWith=function(e){return typeof e!="string"?re(this,ss):this.between(e,e+He,!0,!0)},n.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):xn(this,function(t,r){return t.indexOf(r[0])===0},[e],He)},n.prototype.equalsIgnoreCase=function(e){return xn(this,function(t,r){return t===r[0]},[e],"")},n.prototype.anyOfIgnoreCase=function(){var e=Ee.apply(Je,arguments);return e.length===0?it(this):xn(this,function(t,r){return r.indexOf(t)!==-1},e,"")},n.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ee.apply(Je,arguments);return e.length===0?it(this):xn(this,function(t,r){return r.some(function(i){return t.indexOf(i)===0})},e,He)},n.prototype.anyOf=function(){var e=this,t=Ee.apply(Je,arguments),r=this._cmp;try{t.sort(r)}catch{return re(this,Ae)}if(t.length===0)return it(this);var i=new this.Collection(this,function(){return ke(t[0],t[t.length-1])});i._ondirectionchange=function(o){r=o==="next"?e._ascending:e._descending,t.sort(r)};var s=0;return i._addAlgorithm(function(o,a,u){for(var l=o.key;r(l,t[s])>0;)if(++s,s===t.length)return a(u),!1;return r(l,t[s])===0?!0:(a(function(){o.continue(t[s])}),!1)}),i},n.prototype.notEqual=function(e){return this.inAnyRange([[cr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},n.prototype.noneOf=function(){var e=Ee.apply(Je,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return re(this,Ae)}var t=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[cr,i]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},n.prototype.inAnyRange=function(e,t){var r=this,i=this._cmp,s=this._ascending,o=this._descending,a=this._min,u=this._max;if(e.length===0)return it(this);if(!e.every(function(w){return w[0]!==void 0&&w[1]!==void 0&&s(w[0],w[1])<=0}))return re(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",O.InvalidArgument);var l=!t||t.includeLowers!==!1,p=t&&t.includeUppers===!0;function g(w,S){for(var E=0,T=w.length;E<T;++E){var A=w[E];if(i(S[0],A[1])<0&&i(S[1],A[0])>0){A[0]=a(A[0],S[0]),A[1]=u(A[1],S[1]);break}}return E===T&&w.push(S),w}var f=s;function h(w,S){return f(w[0],S[0])}var d;try{d=e.reduce(g,[]),d.sort(h)}catch{return re(this,Ae)}var m=0,y=p?function(w){return s(w,d[m][1])>0}:function(w){return s(w,d[m][1])>=0},b=l?function(w){return o(w,d[m][0])>0}:function(w){return o(w,d[m][0])>=0};function _(w){return!y(w)&&!b(w)}var v=y,x=new this.Collection(this,function(){return ke(d[0][0],d[d.length-1][1],!l,!p)});return x._ondirectionchange=function(w){w==="next"?(v=y,f=s):(v=b,f=o),d.sort(h)},x._addAlgorithm(function(w,S,E){for(var T=w.key;v(T);)if(++m,m===d.length)return S(E),!1;return _(T)?!0:(r._cmp(T,d[m][1])===0||r._cmp(T,d[m][0])===0||S(function(){f===s?w.continue(d[m][0]):w.continue(d[m][1])}),!1)}),x},n.prototype.startsWithAnyOf=function(){var e=Ee.apply(Je,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?it(this):this.inAnyRange(e.map(function(t){return[t,t+He]})):re(this,"startsWithAnyOf() only works with strings")},n}();function Ru(n){return Bt(ds.prototype,function(t,r,i){this.db=n,this._ctx={table:t,index:r===":id"?null:r,or:i};var s=n._deps.indexedDB;if(!s)throw new O.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=function(o,a){return s.cmp(a,o)},this._max=function(o,a){return s.cmp(o,a)>0?o:a},this._min=function(o,a){return s.cmp(o,a)<0?o:a},this._IDBKeyRange=n._deps.IDBKeyRange})}function ve(n){return W(function(e){return Ct(e),n(e.target.error),!1})}function Ct(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var It="storagemutated",Pe="x-storagemutated-1",Ne=Rt(null,It),Bu=function(){function n(){}return n.prototype._lock=function(){return vt(!I.global),++this._reculock,this._reculock===1&&!I.global&&(I.lockOwnerFor=this),this},n.prototype._unlock=function(){if(vt(!I.global),--this._reculock==0)for(I.global||(I.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{nt(e[1],e[0])}catch{}}return this},n.prototype._locked=function(){return this._reculock&&I.lockOwnerFor!==this},n.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(vt(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new O.DatabaseClosed(i);case"MissingAPIError":throw new O.MissingAPI(i.message,i);default:throw new O.OpenFailed(i)}if(!this.active)throw new O.TransactionInactive;return vt(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=W(function(s){Ct(s),t._reject(e.error)}),e.onabort=W(function(s){Ct(s),t.active&&t._reject(new O.Abort(e.error)),t.active=!1,t.on("abort").fire(s)}),e.oncomplete=W(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Ne.storagemutated.fire(e.mutatedParts)}),this},n.prototype._promise=function(e,t,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return $(new O.ReadOnly("Transaction is readonly"));if(!this.active)return $(new O.TransactionInactive);if(this._locked())return new R(function(o,a){i._blockedFuncs.push([function(){i._promise(e,t,r).then(o,a)},I])});if(r)return Le(function(){var o=new R(function(a,u){i._lock();var l=t(a,u,i);l&&l.then&&l.then(a,u)});return o.finally(function(){return i._unlock()}),o._lib=!0,o});var s=new R(function(o,a){var u=t(o,a,i);u&&u.then&&u.then(o,a)});return s._lib=!0,s},n.prototype._root=function(){return this.parent?this.parent._root():this},n.prototype.waitFor=function(e){var t=this._root(),r=R.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return r});else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new R(function(o,a){r.then(function(u){return t._waitingQueue.push(W(o.bind(null,u)))},function(u){return t._waitingQueue.push(W(a.bind(null,u)))}).finally(function(){t._waitingFor===s&&(t._waitingFor=null)})})},n.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new O.Abort))},n.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(le(t,e))return t[e];var r=this.schema[e];if(!r)throw new O.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i},n}();function Cu(n){return Bt(Bu.prototype,function(t,r,i,s,o){var a=this;this.db=n,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Rt(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new R(function(u,l){a._resolve=u,a._reject=l}),this._completion.then(function(){a.active=!1,a.on.complete.fire()},function(u){var l=a.active;return a.active=!1,a.on.error.fire(u),a.parent?a.parent._reject(u):l&&a.idbtrans&&a.idbtrans.abort(),$(u)})})}function gr(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+ps(e)}}function ps(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function gs(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:ki(t,function(r){return[r.name,r]})}}function Iu(n){return n.length===1?n[0]:n}var Dt=function(n){try{return n.only([[]]),Dt=function(){return[[]]},[[]]}catch{return Dt=function(){return He},He}};function mr(n){return n==null?function(){}:typeof n=="string"?Du(n):function(e){return Te(e,n)}}function Du(n){var e=n.split(".");return e.length===1?function(t){return t[n]}:function(t){return Te(t,n)}}function ms(n){return[].slice.call(n)}var Ou=0;function Ot(n){return n==null?":id":typeof n=="string"?n:"["+n.join("+")+"]"}function Lu(n,e,t){function r(g,f){var h=ms(g.objectStoreNames);return{schema:{name:g.name,tables:h.map(function(d){return f.objectStore(d)}).map(function(d){var m=d.keyPath,y=d.autoIncrement,b=X(m),_=m==null,v={},x={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:_,compound:b,keyPath:m,autoIncrement:y,unique:!0,extractKey:mr(m)},indexes:ms(d.indexNames).map(function(w){return d.index(w)}).map(function(w){var S=w.name,E=w.unique,T=w.multiEntry,A=w.keyPath,C=X(A),N={name:S,compound:C,keyPath:A,unique:E,multiEntry:T,extractKey:mr(A)};return v[Ot(A)]=N,N}),getIndexByKeyPath:function(w){return v[Ot(w)]}};return v[":id"]=x.primaryKey,m!=null&&(v[Ot(m)]=x.primaryKey),x})},hasGetAll:h.length>0&&"getAll"in f.objectStore(h[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(g){if(g.type===3)return null;if(g.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var f=g.lower,h=g.upper,d=g.lowerOpen,m=g.upperOpen,y=f===void 0?h===void 0?null:e.upperBound(h,!!m):h===void 0?e.lowerBound(f,!!d):e.bound(f,h,!!d,!!m);return y}function s(g){var f=g.name;function h(y){var b=y.trans,_=y.type,v=y.keys,x=y.values,w=y.range;return new Promise(function(S,E){S=W(S);var T=b.objectStore(f),A=T.keyPath==null,C=_==="put"||_==="add";if(!C&&_!=="delete"&&_!=="deleteRange")throw new Error("Invalid operation type: "+_);var N=(v||x||{length:1}).length;if(v&&x&&v.length!==x.length)throw new Error("Given keys array must have same length as given values array.");if(N===0)return S({numFailures:0,failures:{},results:[],lastResult:void 0});var U,k=[],Y=[],L=0,se=function(me){++L,Ct(me)};if(_==="deleteRange"){if(w.type===4)return S({numFailures:L,failures:Y,results:[],lastResult:void 0});w.type===3?k.push(U=T.clear()):k.push(U=T.delete(i(w)))}else{var fe=C?A?[x,v]:[x,null]:[v,null],Ie=fe[0],ge=fe[1];if(C)for(var oe=0;oe<N;++oe)k.push(U=ge&&ge[oe]!==void 0?T[_](Ie[oe],ge[oe]):T[_](Ie[oe])),U.onerror=se;else for(var oe=0;oe<N;++oe)k.push(U=T[_](Ie[oe])),U.onerror=se}var De=function(me){var ct=me.target.result;k.forEach(function(de,Ht){return de.error!=null&&(Y[Ht]=de.error)}),S({numFailures:L,failures:Y,results:_==="delete"?v:k.map(function(de){return de.result}),lastResult:ct})};U.onerror=function(me){se(me),De(me)},U.onsuccess=De})}function d(y){var b=y.trans,_=y.values,v=y.query,x=y.reverse,w=y.unique;return new Promise(function(S,E){S=W(S);var T=v.index,A=v.range,C=b.objectStore(f),N=T.isPrimaryKey?C:C.index(T.name),U=x?w?"prevunique":"prev":w?"nextunique":"next",k=_||!("openKeyCursor"in N)?N.openCursor(i(A),U):N.openKeyCursor(i(A),U);k.onerror=ve(E),k.onsuccess=W(function(Y){var L=k.result;if(!L){S(null);return}L.___id=++Ou,L.done=!1;var se=L.continue.bind(L),fe=L.continuePrimaryKey;fe&&(fe=fe.bind(L));var Ie=L.advance.bind(L),ge=function(){throw new Error("Cursor not started")},oe=function(){throw new Error("Cursor not stopped")};L.trans=b,L.stop=L.continue=L.continuePrimaryKey=L.advance=ge,L.fail=W(E),L.next=function(){var De=this,me=1;return this.start(function(){return me--?De.continue():De.stop()}).then(function(){return De})},L.start=function(De){var me=new Promise(function(de,Ht){de=W(de),k.onerror=ve(Ht),L.fail=Ht,L.stop=function(mo){L.stop=L.continue=L.continuePrimaryKey=L.advance=oe,de(mo)}}),ct=function(){if(k.result)try{De()}catch(de){L.fail(de)}else L.done=!0,L.start=function(){throw new Error("Cursor behind last entry")},L.stop()};return k.onsuccess=W(function(de){k.onsuccess=ct,ct()}),L.continue=se,L.continuePrimaryKey=fe,L.advance=Ie,ct(),me},S(L)},E)})}function m(y){return function(b){return new Promise(function(_,v){_=W(_);var x=b.trans,w=b.values,S=b.limit,E=b.query,T=S===1/0?void 0:S,A=E.index,C=E.range,N=x.objectStore(f),U=A.isPrimaryKey?N:N.index(A.name),k=i(C);if(S===0)return _({result:[]});if(y){var Y=w?U.getAll(k,T):U.getAllKeys(k,T);Y.onsuccess=function(Ie){return _({result:Ie.target.result})},Y.onerror=ve(v)}else{var L=0,se=w||!("openKeyCursor"in U)?U.openCursor(k):U.openKeyCursor(k),fe=[];se.onsuccess=function(Ie){var ge=se.result;if(!ge)return _({result:fe});if(fe.push(w?ge.value:ge.primaryKey),++L===S)return _({result:fe});ge.continue()},se.onerror=ve(v)}})}}return{name:f,schema:g,mutate:h,getMany:function(y){var b=y.trans,_=y.keys;return new Promise(function(v,x){v=W(v);for(var w=b.objectStore(f),S=_.length,E=new Array(S),T=0,A=0,C,N=function(L){var se=L.target;(E[se._pos]=se.result)!=null,++A===T&&v(E)},U=ve(x),k=0;k<S;++k){var Y=_[k];Y!=null&&(C=w.get(_[k]),C._pos=k,C.onsuccess=N,C.onerror=U,++T)}T===0&&v(E)})},get:function(y){var b=y.trans,_=y.key;return new Promise(function(v,x){v=W(v);var w=b.objectStore(f),S=w.get(_);S.onsuccess=function(E){return v(E.target.result)},S.onerror=ve(x)})},query:m(u),openCursor:d,count:function(y){var b=y.query,_=y.trans,v=b.index,x=b.range;return new Promise(function(w,S){var E=_.objectStore(f),T=v.isPrimaryKey?E:E.index(v.name),A=i(x),C=A?T.count(A):T.count();C.onsuccess=W(function(N){return w(N.target.result)}),C.onerror=ve(S)})}}}var o=r(n,t),a=o.schema,u=o.hasGetAll,l=a.tables.map(function(g){return s(g)}),p={};return l.forEach(function(g){return p[g.name]=g}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(g){var f=p[g];if(!f)throw new Error("Table '"+g+"' not found");return p[g]},MIN_KEY:-1/0,MAX_KEY:Dt(e),schema:a}}function zu(n,e){return e.reduce(function(t,r){var i=r.create;return P(P({},t),i(t))},n)}function ku(n,e,t,r){var i=t.IDBKeyRange;t.indexedDB;var s=zu(Lu(e,i,r),n.dbcore);return{dbcore:s}}function yr(n,e){var t=n._novip,r=e.db,i=ku(t._middlewares,r,t._deps,e);t.core=i.dbcore,t.tables.forEach(function(s){var o=s.name;t.core.schema.tables.some(function(a){return a.name===o})&&(s.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=s.core))})}function Sn(n,e,t,r){var i=n._novip;t.forEach(function(s){var o=r[s];e.forEach(function(a){var u=jn(a,s);(!u||"value"in u&&u.value===void 0)&&(a===i.Transaction.prototype||a instanceof i.Transaction?Se(a,s,{get:function(){return this.table(s)},set:function(l){Oi(this,s,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):a[s]=new i.Table(s,o))})})}function vr(n,e){var t=n._novip;e.forEach(function(r){for(var i in r)r[i]instanceof t.Table&&delete r[i]})}function Pu(n,e){return n._cfg.version-e._cfg.version}function Nu(n,e,t,r){var i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);var o=s._reject.bind(s),a=I.transless||I;Le(function(){I.trans=s,I.transless=a,e===0?(H(i).forEach(function(u){wr(t,u,i[u].primKey,i[u].indexes)}),yr(n,t),R.follow(function(){return n.on.populate.fire(s)}).catch(o)):Uu(n,e,s,t).catch(o)})}function Uu(n,e,t,r){var i=n._novip,s=[],o=i._versions,a=i._dbSchema=_r(i,i.idbdb,r),u=!1,l=o.filter(function(g){return g._cfg.version>=e});l.forEach(function(g){s.push(function(){var f=a,h=g._cfg.dbschema;xr(i,f,r),xr(i,h,r),a=i._dbSchema=h;var d=ys(f,h);d.add.forEach(function(x){wr(r,x[0],x[1].primKey,x[1].indexes)}),d.change.forEach(function(x){if(x.recreate)throw new O.Upgrade("Not yet support for changing primary key");var w=r.objectStore(x.name);x.add.forEach(function(S){return br(w,S)}),x.change.forEach(function(S){w.deleteIndex(S.name),br(w,S)}),x.del.forEach(function(S){return w.deleteIndex(S)})});var m=g._cfg.contentUpgrade;if(m&&g._cfg.version>e){yr(i,r),t._memoizedTables={},u=!0;var y=Pi(h);d.del.forEach(function(x){y[x]=f[x]}),vr(i,[i.Transaction.prototype]),Sn(i,[i.Transaction.prototype],H(y),y),t.schema=y;var b=Gn(m);b&&tt();var _,v=R.follow(function(){if(_=m(t),_&&b){var x=Me.bind(null,null);_.then(x,x)}});return _&&typeof _.then=="function"?R.resolve(_):v.then(function(){return _})}}),s.push(function(f){if(!u||!pu){var h=g._cfg.dbschema;Vu(h,f)}vr(i,[i.Transaction.prototype]),Sn(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),t.schema=i._dbSchema})});function p(){return s.length?R.resolve(s.shift()(t.idbtrans)).then(p):R.resolve()}return p().then(function(){Fu(a,r)})}function ys(n,e){var t={del:[],add:[],change:[]},r;for(r in n)e[r]||t.del.push(r);for(r in e){var i=n[r],s=e[r];if(!i)t.add.push([r,s]);else{var o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!yn)o.recreate=!0,t.change.push(o);else{var a=i.idxByName,u=s.idxByName,l=void 0;for(l in a)u[l]||o.del.push(l);for(l in u){var p=a[l],g=u[l];p?p.src!==g.src&&o.change.push(g):o.add.push(g)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}}return t}function wr(n,e,t,r){var i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(function(s){return br(i,s)}),i}function Fu(n,e){H(n).forEach(function(t){e.db.objectStoreNames.contains(t)||wr(e,t,n[t].primKey,n[t].indexes)})}function Vu(n,e){[].slice.call(e.db.objectStoreNames).forEach(function(t){return n[t]==null&&e.db.deleteObjectStore(t)})}function br(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function _r(n,e,t){var r={},i=nn(e.objectStoreNames,0);return i.forEach(function(s){for(var o=t.objectStore(s),a=o.keyPath,u=gr(ps(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),l=[],p=0;p<o.indexNames.length;++p){var g=o.index(o.indexNames[p]);a=g.keyPath;var f=gr(g.name,a,!!g.unique,!!g.multiEntry,!1,a&&typeof a!="string",!1);l.push(f)}r[s]=gs(s,u,l)}),r}function ju(n,e,t){var r=n._novip;r.verno=e.version/10;var i=r._dbSchema=_r(r,e,t);r._storeNames=nn(e.objectStoreNames,0),Sn(r,[r._allTables],H(i),i)}function Ku(n,e){var t=_r(n,n.idbdb,e),r=ys(t,n._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function xr(n,e,t){for(var r=n._novip,i=t.db.objectStoreNames,s=0;s<i.length;++s){var o=i[s],a=t.objectStore(o);r._hasGetAll="getAll"in a;for(var u=0;u<a.indexNames.length;++u){var l=a.indexNames[u],p=a.index(l).keyPath,g=typeof p=="string"?p:"["+nn(p).join("+")+"]";if(e[o]){var f=e[o].idxByName[g];f&&(f.name=l,delete e[o].idxByName[g],e[o].idxByName[l]=f)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&K.WorkerGlobalScope&&K instanceof K.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Wu(n){return n.split(",").map(function(e,t){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return gr(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),X(i),t===0)})}var Hu=function(){function n(){}return n.prototype._parseStoresSpec=function(e,t){H(e).forEach(function(r){if(e[r]!==null){var i=Wu(e[r]),s=i.shift();if(s.multi)throw new O.Schema("Primary key cannot be multi-valued");i.forEach(function(o){if(o.auto)throw new O.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new O.Schema("Index must have a name and cannot be an empty string")}),t[r]=gs(r,s,i)}})},n.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?te(this._cfg.storesSource,e):e;var r=t._versions,i={},s={};return r.forEach(function(o){te(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,vr(t,[t._allTables,t,t.Transaction.prototype]),Sn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],H(s),s),t._storeNames=H(s),this},n.prototype.upgrade=function(e){return this._cfg.contentUpgrade=qn(this._cfg.contentUpgrade||V,e),this},n}();function Gu(n){return Bt(Hu.prototype,function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Sr(n,e){var t=n._dbNamesDB;return t||(t=n._dbNamesDB=new Ir(vn,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function Tr(n){return n&&typeof n.databases=="function"}function Qu(n){var e=n.indexedDB,t=n.IDBKeyRange;return Tr(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==vn})}):Sr(e,t).toCollection().primaryKeys()}function $u(n,e){var t=n.indexedDB,r=n.IDBKeyRange;!Tr(t)&&e!==vn&&Sr(t,r).put({name:e}).catch(V)}function qu(n,e){var t=n.indexedDB,r=n.IDBKeyRange;!Tr(t)&&e!==vn&&Sr(t,r).delete(e).catch(V)}function Er(n){return Le(function(){return I.letThrough=!0,n()})}function Yu(){var n=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!n||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Xu(n){var e=n._state,t=n._deps.indexedDB;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?$(e.dbOpenError):n});ye&&(e.openCanceller._stackHolder=Ve()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new O.DatabaseClosed("db.open() was cancelled")}var s=e.dbReadyResolve,o=null,a=!1;return R.race([r,(typeof navigator=="undefined"?R.resolve():Yu()).then(function(){return new R(function(u,l){if(i(),!t)throw new O.MissingAPI;var p=n.name,g=e.autoSchema?t.open(p):t.open(p,Math.round(n.verno*10));if(!g)throw new O.MissingAPI;g.onerror=ve(l),g.onblocked=W(n._fireOnBlocked),g.onupgradeneeded=W(function(f){if(o=g.transaction,e.autoSchema&&!n._options.allowEmptyDB){g.onerror=Ct,o.abort(),g.result.close();var h=t.deleteDatabase(p);h.onsuccess=h.onerror=W(function(){l(new O.NoSuchDatabase("Database "+p+" doesnt exist"))})}else{o.onerror=ve(l);var d=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=d<1,n._novip.idbdb=g.result,Nu(n,d/10,o,l)}},l),g.onsuccess=W(function(){o=null;var f=n._novip.idbdb=g.result,h=nn(f.objectStoreNames);if(h.length>0)try{var d=f.transaction(Iu(h),"readonly");e.autoSchema?ju(n,f,d):(xr(n,n._dbSchema,d),Ku(n,d)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),yr(n,d)}catch{}At.push(n),f.onversionchange=W(function(m){e.vcFired=!0,n.on("versionchange").fire(m)}),f.onclose=W(function(m){n.on("close").fire(m)}),a&&$u(n._deps,p),u()},l)})})]).then(function(){return i(),e.onReadyBeingFired=[],R.resolve(Er(function(){return n.on.ready.fire(n.vip)})).then(function u(){if(e.onReadyBeingFired.length>0){var l=e.onReadyBeingFired.reduce(qn,V);return e.onReadyBeingFired=[],R.resolve(Er(function(){return l(n.vip)})).then(u)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return n}).catch(function(u){e.dbOpenError=u;try{o&&o.abort()}catch{}return r===e.openCanceller&&n._close(),$(u)}).finally(function(){e.openComplete=!0,s()})}function Mr(n){var e=function(o){return n.next(o)},t=function(o){return n.throw(o)},r=s(e),i=s(t);function s(o){return function(a){var u=o(a),l=u.value;return u.done?l:!l||typeof l.then!="function"?X(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return s(e)()}function Ju(n,e,t){var r=arguments.length;if(r<2)throw new O.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var s=Ni(i);return[n,s,t]}function Zu(n,e,t,r,i){return R.resolve().then(function(){var s=I.transless||I,o=n._createTransaction(e,t,n._dbSchema,r),a={trans:o,transless:s};r?o.idbtrans=r.idbtrans:o.create();var u=Gn(i);u&&tt();var l,p=R.follow(function(){if(l=i.call(o,o),l)if(u){var g=Me.bind(null,null);l.then(g,g)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=Mr(l))},a);return(l&&typeof l.then=="function"?R.resolve(l).then(function(g){return o.active?g:$(new O.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):p.then(function(){return l})).then(function(g){return r&&o._resolve(),o._completion.then(function(){return g})}).catch(function(g){return o._reject(g),$(g)})})}function Tn(n,e,t){for(var r=X(n)?n.slice():[n],i=0;i<t;++i)r.push(e);return r}function ec(n){return P(P({},n),{table:function(e){var t=n.table(e),r=t.schema,i={},s=[];function o(m,y,b){var _=Ot(m),v=i[_]=i[_]||[],x=m==null?0:typeof m=="string"?1:m.length,w=y>0,S=P(P({},b),{isVirtual:w,keyTail:y,keyLength:x,extractKey:mr(m),unique:!w&&b.unique});if(v.push(S),S.isPrimaryKey||s.push(S),x>1){var E=x===2?m[0]:m.slice(0,x-1);o(E,y+1,b)}return v.sort(function(T,A){return T.keyTail-A.keyTail}),S}var a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(var u=0,l=r.indexes;u<l.length;u++){var p=l[u];o(p.keyPath,0,p)}function g(m){var y=i[Ot(m)];return y&&y[0]}function f(m,y){return{type:m.type===1?2:m.type,lower:Tn(m.lower,m.lowerOpen?n.MAX_KEY:n.MIN_KEY,y),lowerOpen:!0,upper:Tn(m.upper,m.upperOpen?n.MIN_KEY:n.MAX_KEY,y),upperOpen:!0}}function h(m){var y=m.query.index;return y.isVirtual?P(P({},m),{query:{index:y,range:f(m.query.range,y.keyTail)}}):m}var d=P(P({},t),{schema:P(P({},r),{primaryKey:a,indexes:s,getIndexByKeyPath:g}),count:function(m){return t.count(h(m))},query:function(m){return t.query(h(m))},openCursor:function(m){var y=m.query.index,b=y.keyTail,_=y.isVirtual,v=y.keyLength;if(!_)return t.openCursor(m);function x(w){function S(T){T!=null?w.continue(Tn(T,m.reverse?n.MAX_KEY:n.MIN_KEY,b)):m.unique?w.continue(w.key.slice(0,v).concat(m.reverse?n.MIN_KEY:n.MAX_KEY,b)):w.continue()}var E=Object.create(w,{continue:{value:S},continuePrimaryKey:{value:function(T,A){w.continuePrimaryKey(Tn(T,n.MAX_KEY,b),A)}},primaryKey:{get:function(){return w.primaryKey}},key:{get:function(){var T=w.key;return v===1?T[0]:T.slice(0,v)}},value:{get:function(){return w.value}}});return E}return t.openCursor(h(m)).then(function(w){return w&&x(w)})}});return d}})}var tc={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:ec};function Ar(n,e,t,r){return t=t||{},r=r||"",H(n).forEach(function(i){if(!le(e,i))t[r+i]=void 0;else{var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){var a=Wn(s),u=Wn(o);a!==u?t[r+i]=e[i]:a==="Object"?Ar(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}}),H(e).forEach(function(i){le(n,i)||(t[r+i]=e[i])}),t}function nc(n,e){return e.type==="delete"?e.keys:e.keys||e.values.map(n.extractKey)}var rc={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return P(P({},n),{table:function(e){var t=n.table(e),r=t.schema.primaryKey,i=P(P({},t),{mutate:function(s){var o=I.trans,a=o.table(e).hook,u=a.deleting,l=a.creating,p=a.updating;switch(s.type){case"add":if(l.fire===V)break;return o._promise("readwrite",function(){return g(s)},!0);case"put":if(l.fire===V&&p.fire===V)break;return o._promise("readwrite",function(){return g(s)},!0);case"delete":if(u.fire===V)break;return o._promise("readwrite",function(){return g(s)},!0);case"deleteRange":if(u.fire===V)break;return o._promise("readwrite",function(){return f(s)},!0)}return t.mutate(s);function g(d){var m=I.trans,y=d.keys||nc(r,d);if(!y)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?P(P({},d),{keys:y}):P({},d),d.type!=="delete"&&(d.values=Vn([],d.values,!0)),d.keys&&(d.keys=Vn([],d.keys,!0)),ic(t,d,y).then(function(b){var _=y.map(function(v,x){var w=b[x],S={onerror:null,onsuccess:null};if(d.type==="delete")u.fire.call(S,v,w,m);else if(d.type==="add"||w===void 0){var E=l.fire.call(S,v,d.values[x],m);v==null&&E!=null&&(v=E,d.keys[x]=v,r.outbound||pe(d.values[x],r.keyPath,v))}else{var T=Ar(w,d.values[x]),A=p.fire.call(S,T,v,w,m);if(A){var C=d.values[x];Object.keys(A).forEach(function(N){le(C,N)?C[N]=A[N]:pe(C,N,A[N])})}}return S});return t.mutate(d).then(function(v){for(var x=v.failures,w=v.results,S=v.numFailures,E=v.lastResult,T=0;T<y.length;++T){var A=w?w[T]:y[T],C=_[T];A==null?C.onerror&&C.onerror(x[T]):C.onsuccess&&C.onsuccess(d.type==="put"&&b[T]?d.values[T]:A)}return{failures:x,results:w,numFailures:S,lastResult:E}}).catch(function(v){return _.forEach(function(x){return x.onerror&&x.onerror(v)}),Promise.reject(v)})})}function f(d){return h(d.trans,d.range,1e4)}function h(d,m,y){return t.query({trans:d,values:!1,query:{index:r,range:m},limit:y}).then(function(b){var _=b.result;return g({type:"delete",keys:_,trans:d}).then(function(v){return v.numFailures>0?Promise.reject(v.failures[0]):_.length<y?{failures:[],numFailures:0,lastResult:void 0}:h(d,P(P({},m),{lower:_[_.length-1],lowerOpen:!0}),y)})})}}});return i}})}};function ic(n,e,t){return e.type==="add"?Promise.resolve([]):n.getMany({trans:e.trans,keys:t,cache:"immutable"})}function vs(n,e,t){try{if(!e||e.keys.length<n.length)return null;for(var r=[],i=0,s=0;i<e.keys.length&&s<n.length;++i)ne(e.keys[i],n[s])===0&&(r.push(t?wt(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch{return null}}var sc={stack:"dbcore",level:-1,create:function(n){return{table:function(e){var t=n.table(e);return P(P({},t),{getMany:function(r){if(!r.cache)return t.getMany(r);var i=vs(r.keys,r.trans._cache,r.cache==="clone");return i?R.resolve(i):t.getMany(r).then(function(s){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?wt(s):s},s})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),t.mutate(r)}})}}}},Rr;function Br(n){return!("from"in n)}var Re=function(n,e){if(this)te(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0});else{var t=new Re;return n&&"d"in n&&te(t,n),t}};Ye(Re.prototype,(Rr={add:function(n){return En(this,n),this},addKey:function(n){return Lt(this,n,n),this},addKeys:function(n){var e=this;return n.forEach(function(t){return Lt(e,t,t)}),this}},Rr[Hn]=function(){return Cr(this)},Rr));function Lt(n,e,t){var r=ne(e,t);if(!isNaN(r)){if(r>0)throw RangeError();if(Br(n))return te(n,{from:e,to:t,d:1});var i=n.l,s=n.r;if(ne(t,n.from)<0)return i?Lt(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},ws(n);if(ne(e,n.to)>0)return s?Lt(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},ws(n);ne(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),ne(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);var o=!n.r;i&&!n.l&&En(n,i),s&&o&&En(n,s)}}function En(n,e){function t(r,i){var s=i.from,o=i.to,a=i.l,u=i.r;Lt(r,s,o),a&&t(r,a),u&&t(r,u)}Br(e)||t(n,e)}function oc(n,e){var t=Cr(e),r=t.next();if(r.done)return!1;for(var i=r.value,s=Cr(n),o=s.next(i.from),a=o.value;!r.done&&!o.done;){if(ne(a.from,i.to)<=0&&ne(a.to,i.from)>=0)return!0;ne(i.from,a.from)<0?i=(r=t.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Cr(n){var e=Br(n)?null:{s:0,n};return{next:function(t){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&ne(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||ne(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function ws(n){var e,t,r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var s=i==="r"?"l":"r",o=P({},n),a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],o[i]=a[s],n[s]=o,o.d=bs(o)}n.d=bs(n)}function bs(n){var e=n.r,t=n.l;return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}var ac={stack:"dbcore",level:0,create:function(n){var e=n.schema.name,t=new Re(n.MIN_KEY,n.MAX_KEY);return P(P({},n),{table:function(r){var i=n.table(r),s=i.schema,o=s.primaryKey,a=o.extractKey,u=o.outbound,l=P(P({},i),{mutate:function(f){var h=f.trans,d=h.mutatedParts||(h.mutatedParts={}),m=function(E){var T="idb://"+e+"/"+r+"/"+E;return d[T]||(d[T]=new Re)},y=m(""),b=m(":dels"),_=f.type,v=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],x=v[0],w=v[1],S=f.trans._cache;return i.mutate(f).then(function(E){if(X(x)){_!=="delete"&&(x=E.results),y.addKeys(x);var T=vs(x,S);!T&&_!=="add"&&b.addKeys(x),(T||w)&&uc(m,s,T,w)}else if(x){var A={from:x.lower,to:x.upper};b.add(A),y.add(A)}else y.add(t),b.add(t),s.indexes.forEach(function(C){return m(C.name).add(t)});return E})}}),p=function(f){var h,d,m=f.query,y=m.index,b=m.range;return[y,new Re((h=b.lower)!==null&&h!==void 0?h:n.MIN_KEY,(d=b.upper)!==null&&d!==void 0?d:n.MAX_KEY)]},g={get:function(f){return[o,new Re(f.key)]},getMany:function(f){return[o,new Re().addKeys(f.keys)]},count:p,query:p,openCursor:p};return H(g).forEach(function(f){l[f]=function(h){var d=I.subscr;if(d){var m=function(S){var E="idb://"+e+"/"+r+"/"+S;return d[E]||(d[E]=new Re)},y=m(""),b=m(":dels"),_=g[f](h),v=_[0],x=_[1];if(m(v.name||"").add(x),!v.isPrimaryKey)if(f==="count")b.add(t);else{var w=f==="query"&&u&&h.values&&i.query(P(P({},h),{values:!1}));return i[f].apply(this,arguments).then(function(S){if(f==="query"){if(u&&h.values)return w.then(function(C){var N=C.result;return y.addKeys(N),S});var E=h.values?S.result.map(a):S.result;h.values?y.addKeys(E):b.addKeys(E)}else if(f==="openCursor"){var T=S,A=h.values;return T&&Object.create(T,{key:{get:function(){return b.addKey(T.primaryKey),T.key}},primaryKey:{get:function(){var C=T.primaryKey;return b.addKey(C),C}},value:{get:function(){return A&&y.addKey(T.primaryKey),T.value}}})}return S})}}return i[f].apply(this,arguments)}}),l}})}};function uc(n,e,t,r){function i(s){var o=n(s.name||"");function a(l){return l!=null?s.extractKey(l):null}var u=function(l){return s.multiEntry&&X(l)?l.forEach(function(p){return o.addKey(p)}):o.addKey(l)};(t||r).forEach(function(l,p){var g=t&&a(t[p]),f=r&&a(r[p]);ne(g,f)!==0&&(g!=null&&u(g),f!=null&&u(f))})}e.indexes.forEach(i)}var Ir=function(){function n(e,t){var r=this;this._middlewares={},this.verno=0;var i=n.dependencies;this._options=t=P({addons:n.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};var s=t.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:V,dbReadyPromise:null,cancelOpen:V,openCanceller:null,autoSchema:!0};o.dbReadyPromise=new R(function(a){o.dbReadyResolve=a}),o.openCanceller=new R(function(a,u){o.cancelOpen=u}),this._state=o,this.name=e,this.on=Rt(this,"populate","blocked","versionchange","close",{ready:[qn,V]}),this.on.ready.subscribe=Li(this.on.ready.subscribe,function(a){return function(u,l){n.vip(function(){var p=r._state;if(p.openComplete)p.dbOpenError||R.resolve().then(u),l&&a(u);else if(p.onReadyBeingFired)p.onReadyBeingFired.push(u),l&&a(u);else{a(u);var g=r;l||a(function f(){g.on.ready.unsubscribe(u),g.on.ready.unsubscribe(f)})}})}}),this.Collection=xu(this),this.Table=yu(this),this.Transaction=Cu(this),this.Version=Gu(this),this.WhereClause=Ru(this),this.on("versionchange",function(a){a.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(a){!a.newVersion||a.newVersion<a.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+a.oldVersion/10)}),this._maxKey=Dt(t.IDBKeyRange),this._createTransaction=function(a,u,l,p){return new r.Transaction(a,u,l,r._options.chromeTransactionDurability,p)},this._fireOnBlocked=function(a){r.on("blocked").fire(a),At.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(a)})},this.use(tc),this.use(rc),this.use(ac),this.use(sc),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(function(a){return a(r)})}return n.prototype.version=function(e){if(isNaN(e)||e<.1)throw new O.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new O.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),t.push(r),t.sort(Pu),r.stores({}),this._state.autoSchema=!1,r)},n.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new R(function(r,i){if(t._state.openComplete)return i(new O.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen){i(new O.DatabaseClosed);return}t.open().catch(V)}t._state.dbReadyPromise.then(r,i)}).then(e)},n.prototype.use=function(e){var t=e.stack,r=e.create,i=e.level,s=e.name;s&&this.unuse({stack:t,name:s});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:r,level:i==null?10:i,name:s}),o.sort(function(a,u){return a.level-u.level}),this},n.prototype.unuse=function(e){var t=e.stack,r=e.name,i=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(s){return i?s.create!==i:r?s.name!==r:!1})),this},n.prototype.open=function(){return Xu(this)},n.prototype._close=function(){var e=this._state,t=At.indexOf(this);if(t>=0&&At.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new R(function(r){e.dbReadyResolve=r}),e.openCanceller=new R(function(r,i){e.cancelOpen=i})},n.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new O.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},n.prototype.delete=function(){var e=this,t=arguments.length>0,r=this._state;return new R(function(i,s){var o=function(){e.close();var a=e._deps.indexedDB.deleteDatabase(e.name);a.onsuccess=W(function(){qu(e._deps,e.name),i()}),a.onerror=ve(s),a.onblocked=e._fireOnBlocked};if(t)throw new O.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},n.prototype.backendDB=function(){return this.idbdb},n.prototype.isOpen=function(){return this.idbdb!==null},n.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},n.prototype.hasFailed=function(){return this._state.dbOpenError!==null},n.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(n.prototype,"tables",{get:function(){var e=this;return H(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),n.prototype.transaction=function(){var e=Ju.apply(this,arguments);return this._transaction.apply(this,e)},n.prototype._transaction=function(e,t,r){var i=this,s=I.trans;(!s||s.db!==this||e.indexOf("!")!==-1)&&(s=null);var o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var a,u;try{if(u=t.map(function(p){var g=p instanceof i.Table?p.name:p;if(typeof g!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return g}),e=="r"||e===lr)a=lr;else if(e=="rw"||e==hr)a=hr;else throw new O.InvalidArgument("Invalid transaction mode: "+e);if(s){if(s.mode===lr&&a===hr)if(o)s=null;else throw new O.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s&&u.forEach(function(p){if(s&&s.storeNames.indexOf(p)===-1)if(o)s=null;else throw new O.SubTransaction("Table "+p+" not included in parent transaction.")}),o&&s&&!s.active&&(s=null)}}catch(p){return s?s._promise(null,function(g,f){f(p)}):$(p)}var l=Zu.bind(null,this,a,u,s,r);return s?s._promise(a,l,"lock"):I.trans?nt(I.transless,function(){return i._whenReady(l)}):this._whenReady(l)},n.prototype.table=function(e){if(!le(this._allTables,e))throw new O.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},n}(),cc=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",lc=function(){function n(e){this._subscribe=e}return n.prototype.subscribe=function(e,t,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:t,complete:r}:e)},n.prototype[cc]=function(){return this},n}();function _s(n,e){return H(e).forEach(function(t){var r=n[t]||(n[t]=new Re);En(r,e[t])}),n}function xs(n){return new lc(function(e){var t=Gn(n);function r(h){t&&tt();var d=function(){return Le(n,{subscr:h,trans:null})},m=I.trans?nt(I.transless,d):d();return t&&m.then(Me,Me),m}var i=!1,s={},o={},a={get closed(){return i},unsubscribe:function(){i=!0,Ne.storagemutated.unsubscribe(g)}};e.start&&e.start(a);var u=!1,l=!1;function p(){return H(o).some(function(h){return s[h]&&oc(s[h],o[h])})}var g=function(h){_s(s,h),p()&&f()},f=function(){if(!(u||i)){s={};var h={},d=r(h);l||(Ne(It,g),l=!0),u=!0,Promise.resolve(d).then(function(m){u=!1,!i&&(p()?f():(s={},o=h,e.next&&e.next(m)))},function(m){u=!1,e.error&&e.error(m),a.unsubscribe()})}};return f(),a})}var Dr;try{Dr={indexedDB:K.indexedDB||K.mozIndexedDB||K.webkitIndexedDB||K.msIndexedDB,IDBKeyRange:K.IDBKeyRange||K.webkitIDBKeyRange}}catch{Dr={indexedDB:null,IDBKeyRange:null}}var Qe=Ir;Ye(Qe,P(P({},sn),{delete:function(n){var e=new Qe(n,{addons:[]});return e.delete()},exists:function(n){return new Qe(n,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return Qu(Qe.dependencies).then(n)}catch{return $(new O.MissingAPI)}},defineClass:function(){function n(e){te(this,e)}return n},ignoreTransaction:function(n){return I.trans?nt(I.transless,n):n()},vip:Er,async:function(n){return function(){try{var e=Mr(n.apply(this,arguments));return!e||typeof e.then!="function"?R.resolve(e):e}catch(t){return $(t)}}},spawn:function(n,e,t){try{var r=Mr(n.apply(t,e||[]));return!r||typeof r.then!="function"?R.resolve(r):r}catch(i){return $(i)}},currentTransaction:{get:function(){return I.trans||null}},waitFor:function(n,e){var t=R.resolve(typeof n=="function"?Qe.ignoreTransaction(n):n).timeout(e||6e4);return I.trans?I.trans.waitFor(t):t},Promise:R,debug:{get:function(){return ye},set:function(n){Fi(n,n==="dexie"?function(){return!0}:os)}},derive:Xe,extend:te,props:Ye,override:Li,Events:Rt,on:Ne,liveQuery:xs,extendObservabilitySet:_s,getByKeyPath:Te,setByKeyPath:pe,delByKeyPath:Va,shallowClone:Pi,deepClone:wt,getObjectDiff:Ar,cmp:ne,asap:zi,minKey:cr,addons:[],connections:At,errnames:qa,dependencies:Dr,semVer:is,version:is.split(".").map(function(n){return parseInt(n)}).reduce(function(n,e,t){return n+e/Math.pow(10,t*2)})}));Qe.maxKey=Dt(Qe.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(Ne(It,function(n){if(!Be){var e;yn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Pe,!0,!0,n)):e=new CustomEvent(Pe,{detail:n}),Be=!0,dispatchEvent(e),Be=!1}}),addEventListener(Pe,function(n){var e=n.detail;Be||Mn(e)}));function Mn(n){var e=Be;try{Be=!0,Ne.storagemutated.fire(n)}finally{Be=e}}var Be=!1;if(typeof BroadcastChannel!="undefined"){var Ss=new BroadcastChannel(Pe);Ne(It,function(n){Be||Ss.postMessage(n)}),Ss.onmessage=function(n){n.data&&Mn(n.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){Ne(It,function(n){try{Be||(typeof localStorage!="undefined"&&localStorage.setItem(Pe,JSON.stringify({trig:Math.random(),changedParts:n})),typeof self.clients=="object"&&Vn([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:Pe,changedParts:n})}))}catch{}}),addEventListener("storage",function(n){if(n.key===Pe){var e=JSON.parse(n.newValue);e&&Mn(e.changedParts)}});var Ts=self.document&&navigator.serviceWorker;Ts&&Ts.addEventListener("message",hc)}function hc(n){var e=n.data;e&&e.type===Pe&&Mn(e.changedParts)}R.rejectionMapper=Xa;Fi(ye,os);function An(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Es=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),Ms=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);Ms&&parseFloat(Ms[1]);const fc="3.1.4";function we(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Or={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document},dc=Or.global||Or.self||Or.window||{},Lr=typeof process!="object"||String(process)!=="[object process]"||process.browser,zr=typeof importScripts=="function",pc=typeof window!="undefined"&&typeof window.orientation!="undefined",As=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);As&&parseFloat(As[1]);function z(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}class gc{constructor(e,t){z(this,"name",void 0),z(this,"workerThread",void 0),z(this,"isRunning",void 0),z(this,"result",void 0),z(this,"_resolve",void 0),z(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){we(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){we(this.isRunning),this.isRunning=!1,this._reject(e)}}const kr=new Map;function mc(n){we(n.source&&!n.url||!n.source&&n.url);let e=kr.get(n.source||n.url);return e||(n.url&&(e=yc(n.url),kr.set(n.url,e)),n.source&&(e=Rs(n.source),kr.set(n.source,e))),we(e),e}function yc(n){if(!n.startsWith("http"))return n;const e=vc(n);return Rs(e)}function Rs(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function vc(n){return`try {
  importScripts('`.concat(n,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Bs(n,e=!0,t){const r=t||new Set;if(n){if(Cs(n))r.add(n);else if(Cs(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)Bs(n[i],e,r)}}return t===void 0?Array.from(r):[]}function Cs(n){return n?n instanceof ArrayBuffer||typeof MessagePort!="undefined"&&n instanceof MessagePort||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&n instanceof OffscreenCanvas:!1}const Pr=()=>{};class Is{static isSupported(){return typeof Worker!="undefined"}constructor(e){z(this,"name",void 0),z(this,"source",void 0),z(this,"url",void 0),z(this,"terminated",!1),z(this,"worker",void 0),z(this,"onMessage",void 0),z(this,"onError",void 0),z(this,"_loadableURL","");const{name:t,source:r,url:i}=e;we(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=Pr,this.onError=s=>console.log(s),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=Pr,this.onError=Pr,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Bs(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=mc({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}}class wc{constructor(e){z(this,"name","unnamed"),z(this,"source",void 0),z(this,"url",void 0),z(this,"maxConcurrency",1),z(this,"maxMobileConcurrency",1),z(this,"onDebug",()=>{}),z(this,"reuseWorkers",!0),z(this,"props",{}),z(this,"jobQueue",[]),z(this,"idleQueue",[]),z(this,"count",0),z(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props=Z(Z({},this.props),e),e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new gc(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Is({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return pc?this.maxMobileConcurrency:this.maxConcurrency}}const bc={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class Ce{static isSupported(){return Is.isSupported()}static getWorkerFarm(e={}){return Ce._workerFarm=Ce._workerFarm||new Ce({}),Ce._workerFarm.setProps(e),Ce._workerFarm}constructor(e){z(this,"props",void 0),z(this,"workerPools",new Map),this.props=Z({},bc),this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props=Z(Z({},this.props),e);for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let s=this.workerPools.get(t);return s||(s=new wc({name:t,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}z(Ce,"_workerFarm",void 0);const _c="latest";function xc(n,e={}){const t=e[n.id]||{},r="".concat(n.id,"-worker.js");let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(n.module,"/dist/").concat(r)),!i){let s=n.version;s==="latest"&&(s=_c);const o=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(n.module).concat(o,"/dist/").concat(r)}return we(i),i}function Sc(n,e=fc){we(n,"no worker provided");const t=n.version;return!(!e||!t)}var Tc={},Ec=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Tc});const Mc="3.1.4",Nr={};async function Ds(n,e=null,t={}){return e&&(n=Ac(n,e,t)),Nr[n]=Nr[n]||Rc(n),await Nr[n]}function Ac(n,e,t){if(n.startsWith("http"))return n;const r=t.modules||{};return r[n]?r[n]:Lr?t.CDN?(we(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(Mc,"/dist/libs/").concat(n)):zr?"../src/libs/".concat(n):"modules/".concat(e,"/src/libs/").concat(n):"modules/".concat(e,"/dist/libs/").concat(n)}async function Rc(n){if(n.endsWith("wasm"))return await(await fetch(n)).arrayBuffer();if(!Lr)try{return Ec&&void 0}catch{return null}if(zr)return importScripts(n);const t=await(await fetch(n)).text();return Bc(t,n)}function Bc(n,e){if(!Lr)return;if(zr)return eval.call(dc,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}function Cc(n,e){return Ce.isSupported()?n.worker&&(e==null?void 0:e.worker):!1}async function Ic(n,e,t,r,i){const s=n.id,o=xc(n,t),u=Ce.getWorkerFarm(t).getWorkerPool({name:s,url:o});t=JSON.parse(JSON.stringify(t));const l=await u.startJob("process-on-worker",Dc.bind(null,i));return l.postMessage("process",{input:e,options:t}),await(await l.result).result}async function Dc(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await n(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const u=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function Os(n){return n&&typeof n=="object"&&n.isBuffer}function Oc(n){return Os(n)?new Uint8Array(n.buffer,n.byteOffset,n.length).slice().buffer:n}function Ls(n){if(Os(n))return Oc(n);if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Lc(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function zc(...n){const e=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function kc(n){const e=[];for await(const t of n)e.push(t);return zc(...e)}let Pc="";const zs={};function Nc(n){for(const e in zs)if(n.startsWith(e)){const t=zs[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat(Pc).concat(n)),n}function Uc(n){const e=n&&n.lastIndexOf("/");return e>=0?n.substr(e+1):""}const Fc=n=>typeof n=="boolean",zt=n=>typeof n=="function",kt=n=>n!==null&&typeof n=="object",ks=n=>kt(n)&&n.constructor==={}.constructor,Vc=n=>n&&typeof n[Symbol.iterator]=="function",jc=n=>n&&typeof n[Symbol.asyncIterator]=="function",Pt=n=>typeof Response!="undefined"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,st=n=>typeof Blob!="undefined"&&n instanceof Blob,Kc=n=>n&&typeof n=="object"&&n.isBuffer,Wc=n=>typeof ReadableStream!="undefined"&&n instanceof ReadableStream||kt(n)&&zt(n.tee)&&zt(n.cancel)&&zt(n.getReader),Hc=n=>kt(n)&&zt(n.read)&&zt(n.pipe)&&Fc(n.readable),Ps=n=>Wc(n)||Hc(n),Gc=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qc=/^([-\w.]+\/[-\w.+]+)/;function $c(n){const e=Qc.exec(n);return e?e[1]:n}function Ns(n){const e=Gc.exec(n);return e?e[1]:""}const qc=/\?.*/;function Rn(n){if(Pt(n)){const e=Ur(n.url||""),t=n.headers.get("content-type")||"";return{url:e,type:$c(t)||Ns(e)}}return st(n)?{url:Ur(n.name||""),type:n.type||""}:typeof n=="string"?{url:Ur(n),type:Ns(n)}:{url:"",type:""}}function Yc(n){return Pt(n)?n.headers["content-length"]||-1:st(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}function Ur(n){return n.replace(qc,"")}async function Us(n){if(Pt(n))return n;const e={},t=Yc(n);t>=0&&(e["content-length"]=String(t));const{url:r,type:i}=Rn(n);i&&(e["content-type"]=i);const s=await Zc(n);s&&(e["x-first-bytes"]=s),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function Xc(n){if(!n.ok){const e=await Jc(n);throw new Error(e)}}async function Jc(n){let e="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{const t=n.headers.get("Content-Type");let r=n.statusText;t.includes("application/json")&&(r+=" ".concat(await n.text())),e+=r,e=e.length>60?"".concat(e.slice(60),"..."):e}catch{}return e}async function Zc(n){const e=5;if(typeof n=="string")return"data:,".concat(n.slice(0,e));if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,e),r=el(t);return"data:base64,".concat(r)}return null}function el(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function Fs(n,e){if(typeof n=="string"){n=Nc(n);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(n,t)}return await Us(n)}function tl(n){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process!="undefined"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=n||e;return!!(t&&t.indexOf("Electron")>=0)}function Nt(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||tl()}const Bn={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document,process:typeof process=="object"&&process},Cn=Bn.window||Bn.self||Bn.global,Ut=Bn.process||{},Vs=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source";Nt();function nl(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class rl{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";z(this,"storage",void 0),z(this,"id",void 0),z(this,"config",{}),this.storage=nl(r),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function il(n){let e;return n<10?e="".concat(n.toFixed(2),"ms"):n<100?e="".concat(n.toFixed(1),"ms"):n<1e3?e="".concat(n.toFixed(0),"ms"):e="".concat((n/1e3).toFixed(2),"s"),e}function sl(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-n.length,0);return"".concat(" ".repeat(t)).concat(n)}function Fr(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>r&&(t=Math.min(t,r/n.width));const s=n.width*t,o=n.height*t,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let In;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(In||(In={}));function js(n){return typeof n=="string"?In[n.toUpperCase()]||In.WHITE:n}function ol(n,e,t){return!Nt&&typeof n=="string"&&(e&&(e=js(e),n="[".concat(e,"m").concat(n,"[39m")),t&&(e=js(t),n="[".concat(t+10,"m").concat(n,"[49m"))),n}function al(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t);for(const i of r)typeof n[i]=="function"&&(e.find(s=>i===s)||(n[i]=n[i].bind(n)))}function Dn(n,e){if(!n)throw new Error(e||"Assertion failed")}function ot(){let n;if(Nt&&"performance"in Cn){var e,t;n=Cn==null||(e=Cn.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Ut){var r;const i=Ut==null||(r=Ut.hrtime)===null||r===void 0?void 0:r.call(Ut);n=i[0]*1e3+i[1]/1e6}else n=Date.now();return n}const at={debug:Nt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ul={enabled:!0,level:0};function he(){}const Ks={},Ws={once:!0};class Hs{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};z(this,"id",void 0),z(this,"VERSION",Vs),z(this,"_startTs",ot()),z(this,"_deltaTs",ot()),z(this,"_storage",void 0),z(this,"userData",{}),z(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new rl("__probe-".concat(this.id,"__"),ul),this.userData={},this.timeStamp("".concat(this.id," started")),al(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ot()-this._startTs).toPrecision(10))}getDelta(){return Number((ot()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Dn(e,t)}warn(e){return this._getLogFunction(0,e,at.warn,arguments,Ws)}error(e){return this._getLogFunction(0,e,at.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,at.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,at.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return this._getLogFunction(e,t,at.debug||at.info,arguments,Ws)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||he,r&&[r],{tag:fl(t)}):he}image(e){let{logLevel:t,priority:r,image:i,message:s="",scale:o=1}=e;return this._shouldLog(t||r)?Nt?hl({image:i,message:s,scale:o}):ll({image:i,message:s,scale:o}):he}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||he)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=Qs({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||he)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Gs(e)}_getLogFunction(e,t,r,i,s){if(this._shouldLog(e)){s=Qs({logLevel:e,message:t,args:i,opts:s}),r=r||s.method,Dn(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=ot();const o=s.tag||s.message;if(s.once)if(!Ks[o])Ks[o]=ot();else return he;return t=cl(this.id,s.message,s),r.bind(console,t,...s.args)}return he}}z(Hs,"VERSION",Vs);function Gs(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Dn(Number.isFinite(e)&&e>=0),e}function Qs(n){const{logLevel:e,message:t}=n;n.logLevel=Gs(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return Dn(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function cl(n,e,t){if(typeof e=="string"){const r=t.time?sl(il(t.total)):"";e=t.time?"".concat(n,": ").concat(r,"  ").concat(e):"".concat(n,": ").concat(e),e=ol(e,t.color,t.background)}return e}function ll(n){let{image:e,message:t="",scale:r=1}=n,i=null;try{i=module.require("asciify-image")}catch{}return i?()=>i(e,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then(s=>console.log(s)):he}function hl(n){let{image:e,message:t="",scale:r=1}=n;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Fr(s,t,r);console.log(...o)},s.src=e,he}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Fr(e,t,r)),he;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Fr(s,t,r)),s.src=e.toDataURL(),he}return he}function fl(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const $s=new Hs({id:"loaders.gl"});class dl{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class pl{constructor(){z(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const qs={fetch:null,mimeType:void 0,nothrow:!1,log:new pl,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},gl={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ys(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}const Xs=()=>{const n=Ys();return n.globalOptions=n.globalOptions||Z({},qs),n.globalOptions};function ml(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],yl(n,t),wl(e,n,r)}function Js(n,e){const t=Xs(),r=n||t;return typeof r.fetch=="function"?r.fetch:kt(r.fetch)?i=>Fs(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:Fs}function yl(n,e){Zs(n,null,qs,gl,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Zs(r,t.id,i,s,e)}}function Zs(n,e,t,r,i){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in n){const u=!e&&kt(n[a]),l=a==="baseUri"&&!e,p=a==="workerUrl"&&e;if(!(a in t)&&!l&&!p){if(a in r)$s.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(r[a],"'"))();else if(!u){const g=vl(a,i);$s.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(g))()}}}}function vl(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(n===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const o=s.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(r=r||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return r}function wl(n,e,t){const r=n.options||{},i=Z({},r);return bl(i,t),i.log===null&&(i.log=new dl),eo(i,Xs()),eo(i,e),i}function eo(n,e){for(const t in e)if(t in e){const r=e[t];ks(r)&&ks(n[t])?n[t]=Z(Z({},n[t]),e[t]):n[t]=e[t]}}function bl(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Vr(n){var e;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((e=n)===null||e===void 0?void 0:e.extensions)):!1}function to(n){var e,t;An(n,"null loader"),An(Vr(n),"invalid loader");let r;return Array.isArray(n)&&(r=n[1],n=n[0],n=Ln(Z({},n),{options:Z(Z({},n.options),r)})),((e=n)!==null&&e!==void 0&&e.parseTextSync||(t=n)!==null&&t!==void 0&&t.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const _l=()=>{const n=Ys();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function xl(){return _l()}const Sl=/\.([^.]+)$/;async function Tl(n,e=[],t,r){if(!ro(n))return null;let i=no(n,e,Ln(Z({},t),{nothrow:!0}),r);if(i)return i;if(st(n)&&(n=await n.slice(0,10).arrayBuffer(),i=no(n,e,t,r)),!i&&!(t!=null&&t.nothrow))throw new Error(io(n));return i}function no(n,e=[],t,r){if(!ro(n))return null;if(e&&!Array.isArray(e))return to(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...xl()),Ml(i);const s=El(n,i,t,r);if(!s&&!(t!=null&&t.nothrow))throw new Error(io(n));return s}function El(n,e,t,r){const{url:i,type:s}=Rn(n),o=i||(r==null?void 0:r.url);let a=null;return t!=null&&t.mimeType&&(a=jr(e,t==null?void 0:t.mimeType)),a=a||Al(e,o),a=a||jr(e,s),a=a||Bl(e,n),a=a||jr(e,t==null?void 0:t.fallbackMimeType),a}function ro(n){return!(n instanceof Response&&n.status===204)}function io(n){const{url:e,type:t}=Rn(n);let r="No valid loader found (";r+=e?"".concat(Uc(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const i=n?Dl(n):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function Ml(n){for(const e of n)to(e)}function Al(n,e){const t=e&&Sl.exec(e),r=t&&t[1];return r?Rl(n,r):null}function Rl(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function jr(n,e){for(const t of n)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function Bl(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(Cl(e,t))return t}else if(ArrayBuffer.isView(e)){if(so(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&so(e,0,t))return t;return null}function Cl(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function so(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>Il(n,e,t,i))}function Il(n,e,t,r){if(r instanceof ArrayBuffer)return Lc(r,n,r.byteLength);switch(typeof r){case"function":return r(n,t);case"string":const i=Kr(n,e,r.length);return r===i;default:return!1}}function Dl(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Kr(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Kr(n,0,e):""}function Kr(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const Ol=256*1024;function*Ll(n,e){const t=(e==null?void 0:e.chunkSize)||Ol;let r=0;const i=new TextEncoder;for(;r<n.length;){const s=Math.min(n.length-r,t),o=n.slice(r,r+s);r+=s,yield i.encode(o)}}const zl=256*1024;function*kl(n,e={}){const{chunkSize:t=zl}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),s=new ArrayBuffer(i),o=new Uint8Array(n,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const Pl=1024*1024;async function*Nl(n,e){const t=(e==null?void 0:e.chunkSize)||Pl;let r=0;for(;r<n.size;){const i=r+t,s=await n.slice(r,i).arrayBuffer();r=i,yield s}}function oo(n,e){return Es?Ul(n,e):Fl(n)}async function*Ul(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:s,value:o}=await i;if(s)return;yield Ls(o)}}catch{t.releaseLock()}}async function*Fl(n,e){for await(const t of n)yield Ls(t)}function Vl(n,e){if(typeof n=="string")return Ll(n,e);if(n instanceof ArrayBuffer)return kl(n,e);if(st(n))return Nl(n,e);if(Ps(n))return oo(n,e);if(Pt(n))return oo(n.body,e);throw new Error("makeIterator")}const ao="Cannot convert supplied data type";function jl(n,e,t){if(e.text&&typeof n=="string")return n;if(Kc(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(ao)}async function Kl(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return jl(n,e);if(st(n)&&(n=await Us(n)),Pt(n)){const i=n;return await Xc(i),e.binary?await i.arrayBuffer():await i.text()}if(Ps(n)&&(n=Vl(n,t)),Vc(n)||jc(n))return kc(n);throw new Error(ao)}function Wl(n,e,t=null){if(t)return t;const r=Z({fetch:Js(e,n)},n);return Array.isArray(r.loaders)||(r.loaders=null),r}function Hl(n,e){if(!e&&n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function Wr(n,e,t,r){we(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Vr(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const{url:i}=Rn(n),o=Hl(e,r),a=await Tl(n,o,t);return a?(t=ml(t,a,o,i),r=Wl({url:i,parse:Wr,loaders:o},t,r),await Gl(a,n,t,r)):null}async function Gl(n,e,t,r){if(Sc(n),e=await Kl(e,n,t),n.parseTextSync&&typeof e=="string")return t.dataType="text",n.parseTextSync(e,t,r,n);if(Cc(n,t))return await Ic(n,e,t,r,Wr);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,r,n);if(n.parse)return await n.parse(e,t,r,n);throw we(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}async function Ql(n,e,t,r){!Array.isArray(e)&&!Vr(e)&&(t=e,e=void 0);const i=Js(t);let s=n;return typeof n=="string"&&(s=await i(n)),st(n)&&(s=await i(n)),await Wr(s,e,t)}const $l="3.1.4",{_parseImageNode:ql}=globalThis,Hr=typeof Image!="undefined",Gr=typeof ImageBitmap!="undefined",Yl=Boolean(ql),Qr=Es?!0:Yl;function Xl(n){switch(n){case"auto":return Gr||Hr||Qr;case"imagebitmap":return Gr;case"image":return Hr;case"data":return Qr;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}function Jl(){if(Gr)return"imagebitmap";if(Hr)return"image";if(Qr)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Zl(n){const e=th(n);if(!e)throw new Error("Not an image");return e}function eh(n){switch(Zl(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function th(n){return typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?"imagebitmap":typeof Image!="undefined"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const nh=/^data:image\/svg\+xml/,rh=/\.svg((\?|#).*)?$/;function $r(n){return n&&(nh.test(n)||rh.test(n))}function ih(n,e){if($r(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return uo(n,e)}function uo(n,e){if($r(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function co(n,e,t){const r=ih(n,t),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await sh(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function sh(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=s=>i(new Error("Could not load image ".concat(n,": ").concat(s)))}catch(s){i(s)}})}const oh={};let lo=!0;async function ah(n,e,t){let r;$r(t)?r=await co(n,e,t):r=uo(n,t);const i=e&&e.imagebitmap;return await uh(r,i)}async function uh(n,e=null){if((ch(e)||!lo)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),lo=!1}return await createImageBitmap(n)}function ch(n){for(const e in n||oh)return!1;return!0}const be=!1,Ft=!0;function ho(n){const e=Vt(n);return lh(e)||dh(e)||hh(e)||fh(e)}function lh(n){const e=Vt(n);return e.byteLength>=24&&e.getUint32(0,be)===2303741511?{mimeType:"image/png",width:e.getUint32(16,be),height:e.getUint32(20,be)}:null}function hh(n){const e=Vt(n);return e.byteLength>=10&&e.getUint32(0,be)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ft),height:e.getUint16(8,Ft)}:null}function fh(n){const e=Vt(n);return e.byteLength>=14&&e.getUint16(0,be)===16973&&e.getUint32(2,Ft)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ft),height:e.getUint32(22,Ft)}:null}function dh(n){const e=Vt(n);if(!(e.byteLength>=3&&e.getUint16(0,be)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=ph();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,be);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,be),width:e.getUint16(s+7,be)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,be)}return null}function ph(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:n,sofMarkers:e}}function Vt(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function gh(n,e){const{mimeType:t}=ho(n)||{},r=globalThis._parseImageNode;return An(r),await r(n,t)}async function mh(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},o=yh(i);let a;switch(o){case"imagebitmap":a=await ah(n,e,s);break;case"image":a=await co(n,e,s);break;case"data":a=await gh(n);break;default:An(!1)}return i==="data"&&(a=eh(a)),a}function yh(n){switch(n){case"auto":case"data":return Jl();default:return Xl(n),n}}const vh=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],wh=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],bh={image:{type:"auto",decode:!0}},_h={id:"image",module:"images",name:"Images",version:$l,mimeTypes:wh,extensions:vh,parse:mh,tests:[n=>Boolean(ho(new DataView(n)))],options:bh},xh="3.1.4",fo="3.1.4",Sh="https://unpkg.com/@loaders.gl/textures@".concat(fo,"/dist/libs/basis_encoder.wasm"),Th="https://unpkg.com/@loaders.gl/textures@".concat(fo,"/dist/libs/basis_encoder.js");let qr;async function Eh(n){const e=n.modules||{};return e.basisEncoder?e.basisEncoder:(qr=qr||Mh(n),await qr)}async function Mh(n){let e=null,t=null;return[e,t]=await Promise.all([await Ds(Th,"textures",n),await Ds(Sh,"textures",n)]),e=e||globalThis.BASIS,await Ah(e,t)}function Ah(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{n(t).then(i=>{const{BasisFile:s,KTX2File:o,initializeBasis:a,BasisEncoder:u}=i;a(),r({BasisFile:s,KTX2File:o,BasisEncoder:u})})})}async function Rh(n,e={}){const{useSRGB:t=!1,qualityLevel:r=10,encodeUASTC:i=!1,mipmaps:s=!1}=e,{BasisEncoder:o}=await Eh(e),a=new o;try{const u=new Uint8Array(n.width*n.height*4);a.setCreateKTX2File(!0),a.setKTX2UASTCSupercompression(!0),a.setKTX2SRGBTransferFunc(!0),a.setSliceSourceImage(0,n.data,n.width,n.height,!1),a.setPerceptual(t),a.setMipSRGB(t),a.setQualityLevel(r),a.setUASTC(i),a.setMipGen(s);const l=a.encode(u);return u.subarray(0,l).buffer}catch(u){throw console.error("Basis Universal Supercompressed GPU Texture encoder Error: ",u),u}finally{a.delete()}}const Bh={name:"Basis Universal Supercompressed GPU Texture",id:"ktx2-basis-supercompressed-texture",module:"textures",version:xh,extensions:["ktx2"],options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1},encode:Rh};class Ch extends Ir{constructor(e){super(e);c(this,"textures");this.version(1).stores({textures:"&hash, lastUsedTime"})}}const ti=class{constructor(e="web-layer-cache"){c(this,"_textureStore");c(this,"_textureUrls",new Map);c(this,"_textureSubscriptions",new Map);c(this,"_layerStateData",new Map);this._textureStore=new Ch(e)}getLayerStateData(e){let t=this._layerStateData.get(e);return t||(t={bounds:new Fe,margin:new $e,renderAttempts:0},this._layerStateData.set(e,t)),t.textureHash&&(t.textureUrl=this.getTextureURL(t.textureHash)),t}async updateTexture(e,t){return new Promise(r=>{t.toBlob(async i=>{if(!i)return r(null);try{const s=await Ql(i,_h,{image:{type:"data"}}),o=await Bh.encode(s,{}),a=await this._textureStore.textures.get(e)||{hash:e,lastUsedTime:Date.now(),texture:void 0};a.texture=o,this._textureUrls.set(e,URL.createObjectURL(new Blob([o],{type:"image/ktx2"}))),this._textureStore.textures.put(a)}finally{r(null)}})})}async requestTextureData(e){if(!this._textureSubscriptions.has(e)){const t=xs(()=>this._textureStore.textures.get(e)).subscribe(r=>{if(r&&r.texture){const i=this._textureUrls.get(e);i&&URL.revokeObjectURL(i),this._textureUrls.set(e,URL.createObjectURL(new Blob([r.texture],{type:"image/ktx2"})))}});this._textureSubscriptions.set(e,t)}return this._textureStore.textures.get(e)}getTextureURL(e){return this._textureSubscriptions.has(e)||this.requestTextureData(e),this._textureUrls.get(e)}};let Yr=ti;c(Yr,"instance",new ti);const Ih=new TextEncoder,ie=class{constructor(e,t){c(this,"id");c(this,"needsRefresh",!0);c(this,"needsRemoval",!1);c(this,"pseudoStates",{hover:!1,active:!1,focus:!1,target:!1});c(this,"svgImage",new Image);c(this,"parentLayer");c(this,"childLayers",[]);c(this,"pixelRatio");c(this,"_desiredStateHash","");c(this,"_rasterizingStateHash","");c(this,"_currentStateHash","");c(this,"_svgSrc","");c(this,"_svgDocument","");c(this,"_hashingCanvas",document.createElement("canvas"));c(this,"_domMetrics",{bounds:new Fe,padding:new $e,margin:new $e,border:new $e});c(this,"textureUrl");c(this,"bounds",new Fe);c(this,"margin",new $e);c(this,"serializationReplacer",e=>{var s;if(this.element===e)return;const t=e,r=(s=t.tagName)==null?void 0:s.toLowerCase();if(r==="style"||r==="link")return"";const i=M.layers.get(t);if(i){const o=i._domMetrics.bounds;let a="";const u=`box-sizing:border-box;max-width:${o.width+1}px;max-height:${o.height+1}px;min-width:${o.width}px;min-height:${o.height}px;visibility:hidden`;let l=!1;for(const g of i.element.attributes)g.name!=="src"&&(g.name=="style"?(a+=mt(g.name,g.value+";"+u),l=!0):a+=mt(g.name,g.value));l||(a+=mt("style",u));const p=t.tagName.toLowerCase();return`<${p} ${a}></${p}>`}});this.element=e,this.eventCallback=t,M.layers.set(e,this),this.id=e.getAttribute(M.ELEMENT_UID_ATTRIBUTE)||M.generateElementUID(),e.setAttribute(M.ELEMENT_UID_ATTRIBUTE,this.id),e.setAttribute(M.LAYER_ATTRIBUTE,""),this.parentLayer=M.getClosestLayer(this.element,!1),this.eventCallback("layercreated",{target:e}),this._hashingCanvas.width=30,this._hashingCanvas.height=30}get depth(){let e=0,t=this;for(;t.parentLayer;)t=t.parentLayer,e++;return e}get rootLayer(){let e=this;for(;e.parentLayer;)e=e.parentLayer;return e}traverseParentLayers(e){const t=this.parentLayer;t&&(t.traverseParentLayers(e),e(t))}traverseLayers(e){e(this),this.traverseChildLayers(e)}traverseChildLayers(e){for(const t of this.childLayers)t.traverseLayers(e)}update(){if(this._currentStateHash){const e=ie.CACHE.getLayerStateData(this._currentStateHash);this.bounds.copy(e.bounds),this.margin.copy(e.margin),this.textureUrl!==e.textureUrl&&(this.textureUrl=e.textureUrl,this.eventCallback("layerpainted",{target:this.element}))}else{const e=this._domMetrics;this.bounds.copy(e.bounds),this.margin.copy(e.margin)}}refresh(){if(!this._currentStateHash){const e=this._domMetrics;gt(this.element,e.bounds,this.parentLayer&&this.parentLayer.element),Bi(this.element,e.margin)}this.needsRefresh=!1,this._updateParentAndChildLayers(),M.addToSerializeQueue(this)}_updateParentAndChildLayers(){const e=this.element,t=this.childLayers,r=t.slice(),i=this.parentLayer;this.parentLayer=M.getClosestLayer(this.element,!1),i!==this.parentLayer&&(this.parentLayer&&this.parentLayer.childLayers.push(this),this.eventCallback("layermoved",{target:e})),t.length=0,tn(e,this._tryConvertElementToWebLayer,this);for(const s of r)M.getClosestLayer(s.element,!1)||(s.needsRemoval=!0,t.push(s))}_tryConvertElementToWebLayer(e){if(this.needsRemoval)return!1;const t=e,r=getComputedStyle(t);if(t.getAttribute(M.ELEMENT_UID_ATTRIBUTE)||t.setAttribute(M.ELEMENT_UID_ATTRIBUTE,M.generateElementUID()),t.hasAttribute(M.LAYER_ATTRIBUTE)||t.nodeName==="VIDEO"||r.transform!=="none"){let o=M.layers.get(t);return o||(o=new ie(t,this.eventCallback)),this.childLayers.push(o),!1}return!0}async serialize(){var s;const e=this.element;if(e.nodeName==="VIDEO")return;const t=this._domMetrics;gt(e,t.bounds,(s=this.parentLayer)==null?void 0:s.element),Bi(e,t.margin);let{width:r,height:i}=t.bounds;if(r+=Math.max(t.margin.left,0)+Math.max(t.margin.right,0),i+=Math.max(t.margin.top,0)+Math.max(t.margin.bottom,0),r*i>0){Aa(e,t.padding),Ma(e,t.border);const o=M.attributeHTML(M.ELEMENT_UID_ATTRIBUTE,""+this.id),u=getComputedStyle(e).display==="inline";M.updateInputAttributes(e);const l=this._getParentsHTML(e);l[0]=l[0].replace("html","html "+M.RENDERING_DOCUMENT_ATTRIBUTE+'="" ');const p=await M.getAllEmbeddedStyles(e);let g=await ka(e,this.serializationReplacer);g=g.replace(o,`${o} ${M.RENDERING_ATTRIBUTE}="" ${u?`${M.RENDERING_INLINE_ATTRIBUTE}="" `:" "} `+M.getPsuedoAttributes(this.pseudoStates));const f='<svg width="'+r+'" height="'+i+`" xmlns="http://www.w3.org/2000/svg"><defs><style type="text/css"><![CDATA[
`+p.join(`
`)+']]></style></defs><foreignObject x="0" y="0" width="'+(r+1)+'" height="'+(i+1)+'">'+l[0]+g+l[1]+"</foreignObject></svg>",h=this._svgDocument=f,d=this._desiredStateHash=M.arrayBufferToBase64(Fn.exports.hash(Ih.encode(h)))+"?w="+r+";h="+i;this._currentStateHash=d,console.log("serialized "+d);const m=ie.CACHE.getLayerStateData(d);if(m.bounds.copy(t.bounds),m.margin.copy(t.margin),console.log(t.bounds),m.renderAttempts>=ie.MINIMUM_RENDER_ATTEMPTS&&m.textureHash)return;M.addToRasterizeQueue(this)}else this.bounds.copy(t.bounds),this.margin.copy(t.margin)}async rasterize(){return new Promise((e,t)=>{const r=()=>{M.addToRenderQueue(this),this.svgImage.onload=null,e()};this.svgImage.onload=()=>{setTimeout(r,10)},this.svgImage.onerror=i=>{t(i)},this._rasterizingStateHash=this._desiredStateHash,this.svgImage.src=this._svgSrc="data:image/svg+xml;utf8,"+encodeURIComponent(this._svgDocument)})}async render(){if(!this.svgImage.complete||this.svgImage.currentSrc!==this.svgImage.src){setTimeout(()=>M.addToRenderQueue(this),100);return}const e=this._rasterizingStateHash,t=ie.CACHE.getLayerStateData(e);let{width:r,height:i}=t.bounds,{left:s,top:o,right:a,bottom:u}=t.margin;const l=Math.max(r+s+a,1),p=Math.max(i+o+u,1),g=this._hashingCanvas;let f=g.width,h=g.height;const d=g.getContext("2d");d.clearRect(0,0,f,h),d.imageSmoothingEnabled=!1,d.drawImage(this.svgImage,0,0,l,p,0,0,f,h);const m=d.getImageData(0,0,f,h).data,y=M.arrayBufferToBase64(Fn.exports.hash(new Uint8Array(m))),b=t.textureHash;if(t.textureHash=y,b!==y&&(t.renderAttempts=0),t.renderAttempts++,t.renderAttempts>ie.MINIMUM_RENDER_ATTEMPTS){this._desiredStateHash===this._rasterizingStateHash&&!ie.CACHE.getTextureURL(this._desiredStateHash)&&(this._currentStateHash=this._desiredStateHash);return}setTimeout(()=>M.addToRenderQueue(this),(500+Math.random()*1e3)*2^t.renderAttempts);const _=await ie.CACHE.requestTextureData(y);if(b===y&&(_==null?void 0:_.texture))return;const v=this.pixelRatio||parseFloat(this.element.getAttribute(M.PIXEL_RATIO_ATTRIBUTE))||window.devicePixelRatio,x=ie.canvasPool.pop()||document.createElement("canvas");let w=x.width=l*v,S=x.height=p*v;const E=x.getContext("2d");E.imageSmoothingEnabled=!1,E.clearRect(0,0,w,S),E.drawImage(this.svgImage,0,0,l,p,0,0,w,S),ie.CACHE.updateTexture(y,x).then(()=>{ie.canvasPool.push(x)})}_getParentsHTML(e){const t=[],r=[],i=this._domMetrics;let s=e.parentElement;s||(s=document.documentElement);do{let o=s.tagName.toLowerCase(),a=" ",u="";for(const g of s.attributes){const f=Ci(g.value);if(g.name==="style"){u=f;continue}a+=`${g.name}="${f}" `}const l="<"+o+(o==="html"?` xmlns="http://www.w3.org/1999/xhtml" style="--x-width:${i.bounds.width}px;--x-height:${i.bounds.height}px;--x-inline-top:${i.border.top+i.margin.top+i.padding.top}px; ${u}" `:` style="${u}" ${M.RENDERING_PARENT_ATTRIBUTE}="" `)+a+" >";t.unshift(l);const p="</"+o+">";if(r.push(p),o=="html")break}while(s=s!==document.documentElement?s.parentElement||document.documentElement:null);return[t.join(""),r.join("")]}};let jt=ie;c(jt,"CACHE",new Yr),c(jt,"MINIMUM_RENDER_ATTEMPTS",3),c(jt,"canvasPool",[]);const Dh=self.ResizeObserver||Fo;function Oh(n,e){if(document.contains(n))return n;const t=document.createElement("div");return t.setAttribute(M.RENDERING_CONTAINER_ATTRIBUTE,""),t.style.visibility="hidden",t.style.pointerEvents="none",t.style.touchAction="none",t.attachShadow({mode:"open"}).appendChild(n),document.documentElement.appendChild(t),n}const Lh=new F,zh=new F;new TextDecoder;Promise.resolve();const D=class{static get ELEMENT_UID_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-uid"}static get HOVER_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-hover"}static get ACTIVE_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-active"}static get FOCUS_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-focus"}static get TARGET_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-target"}static get LAYER_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-layer"}static get PIXEL_RATIO_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-pixel-ratio"}static get RENDERING_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering"}static get RENDERING_PARENT_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-parent"}static get RENDERING_CONTAINER_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-container"}static get RENDERING_INLINE_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-inline"}static get RENDERING_DOCUMENT_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-document"}static generateElementUID(){return""+this._nextUID++}static getPsuedoAttributes(e){return`${e.hover?`${this.HOVER_ATTRIBUTE}="" `:" "}${e.focus?`${this.FOCUS_ATTRIBUTE}="" `:" "}${e.active?`${this.ACTIVE_ATTRIBUTE}="" `:" "}${e.target?`${this.TARGET_ATTRIBUTE}="" `:" "}`}static initRootNodeObservation(e){const t=e.ownerDocument,r=e.getRootNode(),i="head"in r?r.head:r;if(this.rootNodeObservers.get(r))return;const s=this.containerStyleElement=t.createElement("style");t.head.appendChild(s),s.innerHTML=`
      [${D.RENDERING_CONTAINER_ATTRIBUTE}] {
        all: initial;
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0px;
      }
    `;const o=`
    [${D.RENDERING_DOCUMENT_ATTRIBUTE}] * {
      transform: none !important;
    }

    [${D.RENDERING_ATTRIBUTE}], [${D.RENDERING_ATTRIBUTE}] * {
      visibility: visible !important;
      /* the following is a hack for Safari; 
      without some kind of css filter active, 
      any box-shadow effect will fail to rasterize properly */
      filter: opacity(1);
    }
    
    [${D.RENDERING_ATTRIBUTE}] [${D.LAYER_ATTRIBUTE}], [${D.RENDERING_ATTRIBUTE}] [${D.LAYER_ATTRIBUTE}] * {
      visibility: hidden !important;
    }

    [${D.RENDERING_ATTRIBUTE}] {
      position: relative !important;
      top: 0 !important;
      left: 0 !important;
      float: left !important; /* prevent margin-collapse in SVG foreign-element for Webkit */
      box-sizing:border-box;
      min-width:var(--x-width);
      min-height:var(--x-height);
    }
    
    [${D.RENDERING_INLINE_ATTRIBUTE}] {
      top: var(--x-inline-top) !important;
      width:auto !important;
    }

    [${D.RENDERING_PARENT_ATTRIBUTE}] {
      transform: none !important;
      left: 0 !important;
      top: 0 !important;
      margin: 0 !important;
      border:0 !important;
      border-radius:0 !important;
      width: 100% !important;
      height:100% !important;
      padding:0 !important;
      visibility:hidden !important;
      filter:none !important;
    }
    
    [${D.RENDERING_PARENT_ATTRIBUTE}]::before, [${D.RENDERING_PARENT_ATTRIBUTE}]::after {
      content:none !important;
      box-shadow:none !important;
    }
    `,a=t.createElement("style");if(a.textContent=o,i.append(a),r===t){let f="";const h=()=>{if(f!=window.location.hash&&window.location.hash)try{this.targetElement=r.querySelector(window.location.hash)}catch{}f=window.location.hash};window.addEventListener("hashchange",h,!1),h(),window.addEventListener("focusin",d=>{this.focusElement=d.target},!1),window.addEventListener("focusout",d=>{this.focusElement=null},!1),window.addEventListener("load",d=>{u()})}const u=()=>{for(const[f,h]of this.layers)h.needsRefresh=!0},l=f=>{var h=f.nodeName.toUpperCase();p.indexOf(h)!==-1&&f.addEventListener("load",u)},p=["STYLE","LINK"],g=new MutationObserver(f=>{for(const h of f){p.indexOf(h.target.nodeName.toUpperCase())!==-1&&u();for(const d of h.addedNodes)l(d)}});g.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),this.rootNodeObservers.set(r,g)}static addToSerializeQueue(e){this.serializeQueue.indexOf(e)===-1&&this.serializeQueue.push(e)}static addToRasterizeQueue(e){this.rasterizeQueue.indexOf(e)===-1&&this.rasterizeQueue.push(e)}static addToRenderQueue(e){this.renderQueue.indexOf(e)===-1&&this.renderQueue.push(e)}static _runTasks(){D.tasksPending=!1;const e=D.serializeQueue,t=D.rasterizeQueue,r=D.renderQueue,i=D.TASK_SYNC_MAX_TIME/2;let s=performance.now();for(;r.length&&performance.now()-s<i;)r.shift().render();for(s=performance.now();e.length&&performance.now()-s<i;)e.shift().serialize();t.length&&D.rasterizeTaskCount<D.TASK_ASYNC_MAX_COUNT&&(D.rasterizeTaskCount++,t.shift().rasterize().finally(()=>{D.rasterizeTaskCount--}))}static scheduleTasksIfNeeded(){this.tasksPending||D.serializeQueue.length===0&&D.renderQueue.length===0&&(D.rasterizeQueue.length===0||D.rasterizeTaskCount===D.TASK_ASYNC_MAX_COUNT)||(this.tasksPending=!0,D.scheduleIdle(D._runTasks))}static scheduleIdle(e){setTimeout(e,1)}static setLayerNeedsRefresh(e){e.needsRefresh=!0}static createLayerTree(e,t,r){if(D.getClosestLayer(e))throw new Error("A root WebLayer for the given element already exists");Oh(e),D.initRootNodeObservation(e);const i=new MutationObserver(D._handleMutations);this.mutationObservers.set(e,i),this.startMutationObserver(e);const s=new Dh(a=>{for(const u of a){const l=this.getClosestLayer(u.target);l.traverseLayers(D.setLayerNeedsRefresh),l.traverseParentLayers(D.setLayerNeedsRefresh)}});s.observe(e),this.resizeObservers.set(e,s),e.addEventListener("input",this._triggerRefresh,{capture:!0}),e.addEventListener("keydown",this._triggerRefresh,{capture:!0}),e.addEventListener("submit",this._triggerRefresh,{capture:!0}),e.addEventListener("change",this._triggerRefresh,{capture:!0}),e.addEventListener("focus",this._triggerRefresh,{capture:!0}),e.addEventListener("blur",this._triggerRefresh,{capture:!0}),e.addEventListener("transitionend",this._triggerRefresh,{capture:!0});const o=new jt(e,r);return this.rootLayers.set(e,o),o}static disposeLayer(e){this.rootLayers.has(e.element)&&(this.rootLayers.delete(e.element),this.mutationObservers.get(e.element).disconnect(),this.mutationObservers.delete(e.element),this.resizeObservers.get(e.element).disconnect(),this.resizeObservers.delete(e.element),e.element.removeEventListener("input",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("keydown",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("submit",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("change",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("focus",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("blur",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("transitionend",this._triggerRefresh,{capture:!0}))}static getClosestLayer(e,t=!0){let r=t?e:e.parentElement;const i=r==null?void 0:r.closest(`[${D.LAYER_ATTRIBUTE}]`);if(!i){const s=(e==null?void 0:e.getRootNode()).host;if(s)return this.getClosestLayer(s,t)}return this.layers.get(i)}static parseCSSTransform(e,t,r,i,s=new F){const o=e.transform,a=e.transformOrigin;if(o.indexOf("matrix(")==0){s.identity();var u=o.substring(7,o.length-1).split(", ").map(parseFloat);s.elements[0]=u[0],s.elements[1]=u[1],s.elements[4]=u[2],s.elements[5]=u[3],s.elements[12]=u[4],s.elements[13]=u[5]}else if(o.indexOf("matrix3d(")==0){var u=o.substring(9,o.length-1).split(", ").map(parseFloat);s.fromArray(u)}else return null;s.elements[0]===0&&(s.elements[0]=1e-15),s.elements[5]===0&&(s.elements[5]=1e-15),s.elements[10]===0&&(s.elements[10]=1e-15),s.elements[12]*=i,s.elements[13]*=i*-1;var l=a.split(" ").map(parseFloat),p=(l[0]-t/2)*i,g=(l[1]-r/2)*i*-1,f=l[2]||0,h=Lh.identity().makeTranslation(-p,-g,-f),d=zh.identity().makeTranslation(p,g,f);for(const m of s.elements)if(isNaN(m))return null;return s.premultiply(d).multiply(h)}static pauseMutationObservers(){const e=D.mutationObservers.values();for(const t of e)D._handleMutations(t.takeRecords()),t.disconnect()}static resumeMutationObservers(){for(const[e]of D.mutationObservers)this.startMutationObserver(e)}static startMutationObserver(e){D.mutationObservers.get(e).observe(e,{attributes:!0,childList:!0,subtree:!0,characterData:!0,characterDataOldValue:!0,attributeOldValue:!0})}static _addDynamicPseudoClassRules(e){const t=e.styleSheets;for(let s=0;s<t.length;s++)try{const o=t[s],a=o.cssRules;if(!a)continue;const u=[];for(var r=0;r<a.length;r++){a[r].cssText.indexOf(":hover")>-1&&u.push(a[r].cssText.replace(new RegExp(":hover","g"),`[${D.HOVER_ATTRIBUTE}]`)),a[r].cssText.indexOf(":active")>-1&&u.push(a[r].cssText.replace(new RegExp(":active","g"),`[${D.ACTIVE_ATTRIBUTE}]`)),a[r].cssText.indexOf(":focus")>-1&&u.push(a[r].cssText.replace(new RegExp(":focus","g"),`[${D.FOCUS_ATTRIBUTE}]`)),a[r].cssText.indexOf(":target")>-1&&u.push(a[r].cssText.replace(new RegExp(":target","g"),`[${D.TARGET_ATTRIBUTE}]`));var i=u.indexOf(a[r].cssText);i>-1&&u.splice(i,1)}for(var r=0;r<u.length;r++)o.insertRule(u[r])}catch{}}static arrayBufferToBase64(e){for(var t="",r=e.byteLength,i=0;i<r;i++)t+=String.fromCharCode(e[i]);return window.btoa(t)}static attributeCSS(e,t){return t?`[${e}]=${t}`:`[${e}]`}static attributeHTML(e,t){return t?`${e}="${t}"`:`${e}=""`}static async generateEmbeddedCSS(e,t){let r;const i=[];t=t.replace(new RegExp(":hover","g"),this.attributeCSS(this.HOVER_ATTRIBUTE)),t=t.replace(new RegExp(":active","g"),this.attributeCSS(this.ACTIVE_ATTRIBUTE)),t=t.replace(new RegExp(":focus","g"),this.attributeCSS(this.FOCUS_ATTRIBUTE)),t=t.replace(new RegExp(":target","g"),this.attributeCSS(this.TARGET_ATTRIBUTE));const s=RegExp(/(@import.*?["']([^"']+)["'].*?|url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\))/gi);for(;r=s.exec(t);){const a=!!r[2]?"type/css":void 0,u=r[2]||r[3];i.push(this.getDataURL(new URL(u,e).href,a).then(l=>{t=t.replace(u,l)}))}return await Promise.all(i),t}static async getAllEmbeddedStyles(e){const t=e.getRootNode(),r=this.embeddedStyles.get(t)||new Map;this.embeddedStyles.set(t,r);const i=Array.from(t.querySelectorAll("style, link[type='text/css'], link[rel='stylesheet']")),s=e.getRootNode()instanceof ShadowRoot;for(const o of i)r.has(o)||r.set(o,new Promise(a=>{if(o.tagName.toLowerCase()==="style")a(o.textContent||"");else{const u=o;a(this.getEmbeddedCSS(u.href))}}).then(a=>{const u=RegExp(/@font-face[^{]*{([^{}]|{[^{}]*})*}/gi),l=a.match(u);if(s&&l)for(const p of l){if(this.fontStyles.has(p))continue;const g=document.createElement("style");g.innerHTML=l.reduce((f,h)=>h+`

`+f,""),document.head.appendChild(g),this.fontStyles.set(p,g),r.set(g,Promise.resolve(""))}return this.generateEmbeddedCSS(window.location.href,a)}));return Promise.all(r.values())}static deleteEmbeddedStyle(e){const t=e.getRootNode(),r=this.embeddedStyles.get(t);r==null||r.delete(e)}static async getDataURL(e,t){if(e.startsWith("data"))return e;if(this.dataURLMap.has(e))return this.dataURLMap.get(e);const r=new Promise(async i=>{const s=await fetch(e,t?{headers:{accept:t}}:void 0),o=s.headers.get("content-type");if(o=="text/css"){const a=await this.generateEmbeddedCSS(e,await s.text());this.embeddedCSSMap.set(e,a),i("data:"+o+";base64,"+window.btoa(a))}else{const a=new Uint8Array(await s.arrayBuffer());i("data:"+o+";base64,"+this.arrayBufferToBase64(a))}});return this.dataURLMap.set(e,r),r}static async getEmbeddedCSS(e){if(this.embeddedCSSMap.has(e))return this.embeddedCSSMap.get(e);const t=await fetch(e,{headers:{accept:"text/css"}}),r=await this.generateEmbeddedCSS(e,await t.text());return this.embeddedCSSMap.set(e,r),this.embeddedCSSMap.get(e)}static updateInputAttributes(e){e.matches("input")&&this._updateInputAttribute(e);for(const t of e.getElementsByTagName("input"))this._updateInputAttribute(t)}static _updateInputAttribute(e){e.hasAttribute("checked")?e.checked||e.removeAttribute("checked"):e.checked&&e.setAttribute("checked",""),e.getAttribute("value")!==e.value&&e.setAttribute("value",e.value)}static isBlankImage(e){return!new Uint32Array(e.buffer).some(r=>r!==0)}};let M=D;c(M,"ATTRIBUTE_PREFIX","xr"),c(M,"_nextUID",0),c(M,"serializer",new XMLSerializer),c(M,"rootLayers",new Map),c(M,"layers",new Map),c(M,"mutationObservers",new Map),c(M,"resizeObservers",new Map),c(M,"serializeQueue",[]),c(M,"rasterizeQueue",[]),c(M,"renderQueue",[]),c(M,"focusElement",null),c(M,"activeElement",null),c(M,"targetElement",null),c(M,"rootNodeObservers",new Map),c(M,"containerStyleElement"),c(M,"TASK_ASYNC_MAX_COUNT",2),c(M,"TASK_SYNC_MAX_TIME",200),c(M,"rasterizeTaskCount",0),c(M,"tasksPending",!1),c(M,"_handleMutations",e=>{for(const t of e){if(t.type==="attributes"&&t.target.getAttribute(t.attributeName)===t.oldValue||t.type==="characterData"&&t.target.data===t.oldValue)continue;const r=t.target.nodeType===Node.ELEMENT_NODE?t.target:t.target.parentElement;if(!r)continue;const i=D.getClosestLayer(r);if(!!i){if(t.type==="attributes"&&t.attributeName==="class"){const s=t.oldValue?t.oldValue:"",o=t.target.className;if(s===o)continue}i.parentLayer?i.parentLayer.traverseChildLayers(D.setLayerNeedsRefresh):i.traverseLayers(D.setLayerNeedsRefresh)}}}),c(M,"_triggerRefresh",async e=>{const t=D.getClosestLayer(e.target);t&&(t.parentLayer?t.parentLayer.traverseChildLayers(D.setLayerNeedsRefresh):t.traverseLayers(D.setLayerNeedsRefresh))}),c(M,"embeddedStyles",new Map),c(M,"fontStyles",new Map),c(M,"dataURLMap",new Map),c(M,"embeddedCSSMap",new Map);const Xr=Symbol("ON_BEFORE_UPDATE"),Jr=new Qt,kh=new Vo,Kt=class extends $t{constructor(e,t){super();c(this,"_camera");c(this,"_webLayer");c(this,"_localZ",0);c(this,"_viewZ",0);c(this,"_renderZ",0);c(this,"_videoTexture");c(this,"textures",new Set);c(this,"contentMesh",new si(Kt.GEOMETRY,new oi({side:Wo,depthWrite:!1,transparent:!0,alphaTest:.001,opacity:1})));c(this,"_boundsMesh",new si(Kt.GEOMETRY,new oi({visible:!1})));c(this,"cursor",new $t);c(this,"depthMaterial",new Ho({depthPacking:Go,alphaTest:.001}));c(this,"domLayout",new $t);c(this,"domSize",new Qt(1,1,1));c(this,"bounds",new Fe);c(this,"margin",new $e);c(this,"childWebLayers",[]);c(this,"shouldApplyDOMLayout","auto");this.element=e,this.options=t,this.name=e.id,this._webLayer=M.getClosestLayer(e),e.layer=this,this.add(this.contentMesh),this.add(this._boundsMesh),this.cursor.visible=!1,this.matrixAutoUpdate=!0,this.contentMesh.matrixAutoUpdate=!0,this.contentMesh.visible=!1,this.contentMesh.customDepthMaterial=this.depthMaterial,this.contentMesh.onBeforeRender=(r,i,s)=>{this._camera=s},this._boundsMesh.matrixAutoUpdate=!0,this.options.manager.layersByElement.set(this.element,this),this.options.manager.layersByMesh.set(this.contentMesh,this)}static shouldApplyDOMLayout(e){const t=e.shouldApplyDOMLayout;return t==="always"||t===!0?!0:t==="never"||t===!1?!1:!!(t==="auto"&&e.parentWebLayer&&e.parent===e.parentWebLayer)}get currentTexture(){const e=this.options.manager;if(this._webLayer.element.tagName==="VIDEO"){const i=this._webLayer.element;let s=this._videoTexture;return s||(s=new Ko(i),s.wrapS=qt,s.wrapT=qt,s.minFilter=ii,e.textureEncoding&&(s.encoding=e.textureEncoding),this._videoTexture=s),s}const t=this._webLayer.textureUrl;let r=t?e.getTexture(t,this):void 0;return r&&this.textures.add(r),r}get pseudoStates(){return this._webLayer.pseudoStates}get depth(){return this._webLayer.depth}get index(){return this.parentWebLayer?this.parentWebLayer.childWebLayers.indexOf(this):0}get needsRefresh(){return this._webLayer.needsRefresh}setNeedsRefresh(){this._webLayer.traverseLayers(M.setLayerNeedsRefresh)}get needsRemoval(){return this._webLayer.needsRemoval}get parentWebLayer(){return this._webLayer.parentLayer&&this.options.manager.layersByElement.get(this._webLayer.parentLayer.element)}refresh(e=!1){var t;this._webLayer.refresh(),this.childWebLayers.length=0;for(const r of this._webLayer.childLayers){const i=this.options.manager.layersByElement.get((t=M.getClosestLayer(r.element))==null?void 0:t.element);!i||(this.childWebLayers.push(i),e&&i.refresh(e))}this._refreshVideoBounds()}updateLayout(){if(this._updateDOMLayout(),this._camera){this._localZ=Math.abs(Jr.setFromMatrixPosition(this.matrix).z+Jr.setFromMatrixPosition(this.contentMesh.matrix).z),this._viewZ=Math.abs(this.contentMesh.getWorldPosition(Jr).applyMatrix4(this._camera.matrixWorldInverse).z);let e=this.parentWebLayer?this.parentWebLayer._renderZ:this._viewZ;this._localZ<.001?this._renderZ=e:this._renderZ=this._viewZ,this.contentMesh.renderOrder=(this.options.renderOrderOffset||0)+(1-Math.log(this._renderZ+1)/Math.log(this._camera.far+1))+(this.depth+this.index*.001)*1e-7}}updateContent(){const e=this.contentMesh,t=this.currentTexture,r=e.material;if(t&&t.image&&r.map!==t){const o=this.contentMesh.scale,a=Math.abs(o.x*this.scale.x/o.y*this.scale.y),u=this.domSize.x/this.domSize.y;Math.abs(u-a)<1e3&&(r.map=t,this.depthMaterial.map=t,r.needsUpdate=!0,t.needsUpdate=!0,this.depthMaterial.needsUpdate=!0)}r.transparent=!0;const s=e.material.opacity<.005;s?e.visible=!1:e.material.map&&(e.visible=!0),this.needsRemoval&&s&&(this.parent&&this.parent.remove(this),this.dispose())}get container(){return this.options.manager.layersByElement.get(this._webLayer.rootLayer.element)}[Xr](){}_doUpdate(){this[Xr](),this._webLayer.update(),this.updateContent(),this.updateLayout(),Kt.shouldApplyDOMLayout(this)&&(this.position.copy(this.domLayout.position),this.quaternion.copy(this.domLayout.quaternion),this.scale.copy(this.domLayout.scale)),this.contentMesh.position.set(0,0,0),this.contentMesh.scale.copy(this.domSize),this.contentMesh.quaternion.set(0,0,0,1),this._boundsMesh.position.set(0,0,0),this._boundsMesh.scale.copy(this.domSize),this._boundsMesh.quaternion.set(0,0,0,1),this.needsRefresh&&this.options.autoRefresh!==!1&&this.refresh(),M.scheduleTasksIfNeeded()}update(e=!1){e?this.traverseLayersPreOrder(this._doUpdate):this._doUpdate()}querySelector(e){var r;const t=this.element.querySelector(e)||((r=this.element.shadowRoot)==null?void 0:r.querySelector(e));if(t)return this.options.manager.layersByElement.get(t)}traverseLayerAncestors(e){const t=this.parentWebLayer;t&&(t.traverseLayerAncestors(e),e.call(this,t))}traverseLayersPreOrder(e){if(e.call(this,this)===!1)return!1;for(const t of this.childWebLayers)if(t.traverseLayersPreOrder(e)===!1)return!1;return!0}traverseLayersPostOrder(e){for(const t of this.childWebLayers)if(t.traverseLayersPostOrder(e)===!1)return!1;return e.call(this,this)||!0}dispose(){M.disposeLayer(this._webLayer),this.options.manager.disposeLayer(this);for(const e of this.childWebLayers)e.dispose()}_refreshVideoBounds(){if(this.element.nodeName==="VIDEO"){const e=this.element,t=this.currentTexture,r=getComputedStyle(this.element),{objectFit:i}=r,{width:s,height:o}=this.bounds.copy(this._webLayer.bounds),{videoWidth:a,videoHeight:u}=e,l=a/u,p=s/o;switch(t.center.set(.5,.5),i){case"none":t.repeat.set(s/a,o/u).clampScalar(0,1);break;case"contain":case"scale-down":if(t.repeat.set(1,1),p>l){const g=this.bounds.height*l||0;this.bounds.left+=(this.bounds.width-g)/2,this.bounds.width=g}else{const g=this.bounds.width/l||0;this.bounds.top+=(this.bounds.height-g)/2,this.bounds.height=g}break;case"cover":if(t.repeat.set(s/a,o/u),p<l){const g=this.bounds.height*l||0;this.bounds.left+=(this.bounds.width-g)/2,this.bounds.width=g}else{const g=this.bounds.width/l||0;this.bounds.top+=(this.bounds.height-g)/2,this.bounds.height=g}break;default:case"fill":t.repeat.set(1,1);break}}}_updateDOMLayout(){if(this.needsRemoval)return;const{bounds:e,margin:t}=this._webLayer;if(!e||!t)return;this.domLayout.position.set(0,0,0),this.domLayout.scale.set(1,1,1),this.domLayout.quaternion.set(0,0,0,1);const r=this.element.nodeName==="VIDEO",i=r?this.bounds:this.bounds.copy(e),s=r?this.margin:this.margin.copy(t),o=i.width+s.left+s.right,a=i.height+s.top+s.bottom,u=i.width,l=i.height,p=1/this.options.manager.pixelsPerUnit;this.domSize.set(Math.max(p*(u+s.left+s.right),1e-5),Math.max(p*(l+s.top+s.bottom),1e-5),1);const g=this.parentWebLayer;if(!g)return;const f=g.bounds,h=g.margin,d=f.width+h.left+h.right,m=f.height+h.bottom+h.top,y=-d/2+h.left,b=m/2-h.top;this.domLayout.position.set(p*(y+o/2+i.left-s.left),p*(b-a/2-i.top+s.top),0);const _=getComputedStyle(this.element),v=_.transform;if(v&&v!=="none"){const x=M.parseCSSTransform(_,i.width,i.height,p,kh);x&&(this.domLayout.updateMatrix(),this.domLayout.matrix.multiply(x),this.domLayout.matrix.decompose(this.domLayout.position,this.domLayout.quaternion,this.domLayout.scale))}}};let Zr=Kt;c(Zr,"GEOMETRY",new jo(1,1,2,2));const Wt=class{constructor(){c(this,"textureEncoding",Qo);c(this,"texturesByUrl",new Map);c(this,"layersUsingTexture",new WeakMap);c(this,"textureLoader",new $o);c(this,"layersByElement",new WeakMap);c(this,"layersByMesh",new WeakMap);c(this,"pixelsPerUnit",1e3);this.textureLoader.setTranscoderPath("https://unpkg.com/@loaders.gl/textures@3.1.4/dist/libs/")}static initialize(e){Wt.instance=new Wt,Wt.instance.textureLoader.detectSupport(e)}getTexture(e,t){var s;const r=this.texturesByUrl.get(e);if(r!=="pending"){if(r)return t&&((s=this.layersUsingTexture.get(r))==null||s.add(t)),r;this.texturesByUrl.set(e,"pending"),this.textureLoader.load(e,o=>{o.wrapS=qt,o.wrapT=qt,o.minFilter=ii,o.encoding=this.textureEncoding,this.texturesByUrl.set(e,o),this.layersUsingTexture.set(o,new Set)},()=>{},()=>{this.texturesByUrl.delete(e)})}}disposeLayer(e){for(const t of e.textures){const r=this.layersUsingTexture.get(t);r.delete(e),r.size===0&&t.dispose()}}};let ei=Wt;c(ei,"instance");const po=new Qt,go=new Qt,Ph=new Fe,Nh=new Fe;class jh extends $t{constructor(e,t={}){super();c(this,"options");c(this,"rootLayer");c(this,"_interactionRays",[]);c(this,"_raycaster",new qo);c(this,"_hitIntersections",[]);c(this,"_previousHoverLayers",new Set);c(this,"_contentMeshes",[]);c(this,"_prepareHitTest",e=>{e.pseudoStates.hover&&this._previousHoverLayers.add(e),e.cursor.visible=!1,e.pseudoStates.hover=!1,this._contentMeshes.push(e.contentMesh)});t.manager||(t.manager=ei.instance),this.options=t;const r=typeof e=="string"?Ba(e):e;M.createLayerTree(r,t,(i,{target:s})=>{var o,a,u,l,p,g;if(i==="layercreated"){const f=new Zr(s,this.options);s===r?(f[Xr]=()=>this._updateInteractions(),this.rootLayer=f,this.add(f)):(o=f.parentWebLayer)==null||o.add(f),(u=(a=this.options).onLayerCreate)==null||u.call(a,f)}else if(i==="layerpainted"){const f=M.layers.get(s),h=this.options.manager.layersByElement.get(f.element);(p=(l=this.options).onLayerPaint)==null||p.call(l,h)}else if(i==="layermoved"){const f=this.options.manager.layersByElement.get(s);(g=f.parentWebLayer)==null||g.add(f)}}),this.refresh(),this.update()}get interactionRays(){return this._interactionRays}set interactionRays(e){this._interactionRays=e}update(){this.rootLayer.update(!0)}refresh(){this.rootLayer.refresh(!0)}querySelector(e){return this.rootLayer.querySelector(e)}get contentMesh(){return this.rootLayer.contentMesh}_intersectionSort(e,t){const r=e.object.parent,i=t.object.parent;return r.depth!==i.depth?i.depth-r.depth:i.index-r.index}_updateInteractions(){const e=this._previousHoverLayers;e.clear(),this._contentMeshes.length=0,this.rootLayer.traverseLayersPreOrder(this._prepareHitTest);for(const t of this._interactionRays){"isObject3D"in t&&t.isObject3D?this._raycaster.ray.set(t.getWorldPosition(po),t.getWorldDirection(go).negate()):this._raycaster.ray.copy(t),this._hitIntersections.length=0;const r=this._raycaster.intersectObjects(this._contentMeshes,!1,this._hitIntersections);r.sort(this._intersectionSort);const i=r[0];if(i){const s=i.object.parent;s.cursor.position.copy(i.point),s.cursor.visible=!0,s.pseudoStates.hover=!0,e.has(s)||s.setNeedsRefresh()}}for(const t of e)t.pseudoStates.hover||t.setNeedsRefresh()}hitTest(e){const t=this._raycaster,r=this._hitIntersections,i=this.options.manager.layersByMesh;"isObject3D"in e&&e.isObject3D?this._raycaster.ray.set(e.getWorldPosition(po),e.getWorldDirection(go).negate()):this._raycaster.ray.copy(e),r.length=0,t.intersectObject(this,!0,r),r.sort(this._intersectionSort);for(const s of r){const o=i.get(s.object);if(!o)continue;const a=gt(o.element,Ph);if(!a.width||!a.height)continue;let u=o.element;const l=s.uv.x*a.width,p=(1-s.uv.y)*a.height;return tn(o.element,g=>{if(!u.contains(g))return!1;const f=gt(g,Nh),h=f.left-a.left,d=f.top-a.top,{width:m,height:y}=f,b=h+m,_=d+y;return l>h&&l<b&&p>d&&p<_?(u=g,!0):!1}),{layer:o,intersection:s,target:u}}}}export{Pn as Q,xa as S,ue as V,jh as W,Zo as a,kn as b,Ea as c,ei as d,Vh as e,bi as f};
